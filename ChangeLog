------------------------------------------------------------------------
r1049 | knu | 2004-12-26 06:08:29 +0900 (Sun, 26 Dec 2004) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Reverse the condition to check if custom MAKE_ARGS is specified.

Submitted by:	Max Laier <max@love2party.net>

------------------------------------------------------------------------
r1048 | knu | 2004-12-26 00:54:12 +0900 (Sun, 26 Dec 2004) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb

When INDEX is not found, try "make fetchindex" first, then try "make
index".

------------------------------------------------------------------------
r1047 | knu | 2004-12-26 00:35:21 +0900 (Sun, 26 Dec 2004) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.sh

s/echo //

------------------------------------------------------------------------
r1046 | knu | 2004-12-24 05:11:54 +0900 (Fri, 24 Dec 2004) | 1 line
Changed paths:
   M /trunk/Makefile

Fix ChangeLog generation, this time.
------------------------------------------------------------------------
r1045 | knu | 2004-12-24 05:07:40 +0900 (Fri, 24 Dec 2004) | 1 line
Changed paths:
   M /trunk/Makefile

Fix ChangeLog generation.
------------------------------------------------------------------------
r1044 | knu | 2004-12-24 05:00:31 +0900 (Fri, 24 Dec 2004) | 1 line
Changed paths:
   M /trunk/Makefile

Generate ChangeLog in English.
------------------------------------------------------------------------
r1043 | knu | 2004-12-24 03:50:36 +0900 (Fri, 24 Dec 2004) | 3 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/lib/portsdb.rb

Add portsdb -F, which calls make fetchindex internally to update the
ports index file.

------------------------------------------------------------------------
r1042 | knu | 2004-12-20 05:34:46 +0900 (Mon, 20 Dec 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

Fix double free.

------------------------------------------------------------------------
r1041 | knu | 2004-12-14 08:59:06 +0900 (Tue, 14 Dec 2004) | 6 lines
Changed paths:
   M /trunk/bin/portupgrade

- Make -fP properly reinstall an installed package using a binary
  package.

- Do not use a binary package when custom MAKE_ARGS or -m option is
  defined, unless -PP is specified.

------------------------------------------------------------------------
r1040 | knu | 2004-12-14 08:55:47 +0900 (Tue, 14 Dec 2004) | 1 line
Changed paths:
   M /trunk/bin/pkg_glob.1

Fix a typo.
------------------------------------------------------------------------
r1039 | knu | 2004-12-14 08:55:06 +0900 (Tue, 14 Dec 2004) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Make sure that a library does not shadow itself.

------------------------------------------------------------------------
r1038 | knu | 2004-10-18 23:59:09 +0900 (Mon, 18 Oct 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Use Object#class instead of Object#type.

------------------------------------------------------------------------
r1037 | knu | 2004-08-08 03:47:36 +0900 (Sun, 08 Aug 2004) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.sh

rcNG'ify.

------------------------------------------------------------------------
r1036 | knu | 2004-07-20 20:53:06 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   D /trunk/.cvsignore
   D /trunk/bin/.cvsignore
   D /trunk/etc/.cvsignore
   D /trunk/lib/.cvsignore

Remove obsolete .cvsignore files.

------------------------------------------------------------------------
r1035 | knu | 2004-07-20 20:52:37 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/Makefile

Clean up ChangeLog stuff.

------------------------------------------------------------------------
r1034 | knu | 2004-07-20 20:46:12 +0900 (Tue, 20 Jul 2004) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix a regex pattern for `uname -rm'.  \D* does not work as expected in
this case.

------------------------------------------------------------------------
r1033 | knu | 2004-07-20 20:42:08 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/lib

Add ignore patterns.

------------------------------------------------------------------------
r1032 | knu | 2004-07-20 20:41:48 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/bin
   M /trunk/etc

Add ignore patterns.

------------------------------------------------------------------------
r1031 | knu | 2004-07-20 20:40:51 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/bin

Add ignore patterns.

------------------------------------------------------------------------
r1030 | knu | 2004-07-20 20:39:35 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk

Add ignore patterns.

------------------------------------------------------------------------
r1029 | knu | 2004-07-20 20:38:57 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/Makefile

Switch over to Subversion.

------------------------------------------------------------------------
r1028 | knu | 2004-07-20 20:14:02 +0900 (Tue, 20 Jul 2004) | 2 lines
Changed paths:
   M /trunk/Makefile
   M /trunk/Makefile.compat
   M /trunk/Makefile.inc
   M /trunk/README
   M /trunk/bin/Makefile
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkg_sort.1
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portcvsweb
   M /trunk/bin/portcvsweb.1
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/etc/Makefile
   M /trunk/etc/pkgtools.conf
   M /trunk/etc/pkgtools.conf.5
   M /trunk/etc/pkgtools.sh
   M /trunk/etc/status-pkg.sh
   M /trunk/lib/Makefile
   M /trunk/lib/pkg.rb
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgmisc.rb
   M /trunk/lib/pkgsqldb.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/pkgtsort.rb
   M /trunk/lib/pkgversion.rb
   M /trunk/lib/portinfo.rb
   M /trunk/lib/ports.rb
   M /trunk/lib/portsdb.rb
   M /trunk/misc/Makefile
   M /trunk/misc/Makefile.inc
   M /trunk/misc/bash/Makefile
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/tcsh/Makefile
   M /trunk/misc/tcsh/complete.sample
   M /trunk/misc/zsh/Makefile
   M /trunk/tests/test_pkgdb.rb
   M /trunk/tests/test_pkginfo.rb
   M /trunk/tests/test_pkgtsort.rb
   M /trunk/tests/test_pkgversion.rb
   M /trunk/tests/test_portinfo.rb
   M /trunk/tests/test_portsdb.rb

Switch over to Subversion keyword tag expansion.

------------------------------------------------------------------------
r1027 | knu | 2004-07-15 21:20:03 +0900 (Thu, 15 Jul 2004) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix the regexp for uname(1) output to support DragonFly BSD.

Submitted by:	Hiten Pandya <hmp@freebsd.org> (slightly modified)

------------------------------------------------------------------------
r1026 | knu | 2004-07-15 21:15:11 +0900 (Thu, 15 Jul 2004) | 4 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1

Fix a punctuation typo.

Submitted by:	Guido Falsi <mad@madpilot.net>

------------------------------------------------------------------------
r1025 | knu | 2004-07-13 01:29:33 +0900 (Tue, 13 Jul 2004) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Work around the bdb bug.

------------------------------------------------------------------------
r1024 | knu | 2004-07-07 04:58:15 +0900 (Wed, 07 Jul 2004) | 7 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a bug with -P when there are more than one binary package file for
a package to install or upgrade.

PR:		ports/68598
Submitted by:	Victor Prylipko <vic@liniya.ru>
Bug traced by:	Andrew Bliznak <andrew@ort.lviv.net>

------------------------------------------------------------------------
r1023 | knu | 2004-07-02 13:24:28 +0900 (Fri, 02 Jul 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Make sure that hash is not nil before calling each().

------------------------------------------------------------------------
r1022 | knu | 2004-07-01 01:51:46 +0900 (Thu, 01 Jul 2004) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Make -PP/--use-packages-only work better, just as I originally
intended.  Now packages are correctly identified using pkg_info(1),
"LATEST_LINK" files are also detected.  Related informational messages
have also been improved.

------------------------------------------------------------------------
r1021 | knu | 2004-07-01 01:40:54 +0900 (Thu, 01 Jul 2004) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Properly rename a "latest link" file with a full package name with
version part.

------------------------------------------------------------------------
r1020 | knu | 2004-07-01 01:24:12 +0900 (Thu, 01 Jul 2004) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/lib/pkgtools.rb

Move identify_pkg() to pkgtools.rb.

------------------------------------------------------------------------
r1019 | knu | 2004-07-01 01:23:35 +0900 (Thu, 01 Jul 2004) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb

Permit extra fields of INDEX.

------------------------------------------------------------------------
r1018 | knu | 2004-07-01 01:22:35 +0900 (Thu, 01 Jul 2004) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Fix latest_link().  The condition was reversed!

------------------------------------------------------------------------
r1017 | knu | 2004-06-14 22:03:23 +0900 (Mon, 14 Jun 2004) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Improve and unify the method for pattern matching in MAKE_ARGS,
BEFOREBUILD, BEFOREDEINSTALL and AFTERINSTALL variables.

This should fix some cases where it looks like MAKE_ARGS entries are
ignored.

------------------------------------------------------------------------
r1016 | knu | 2004-05-29 05:28:43 +0900 (Sat, 29 May 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgversion.rb

Fix handling of padded zero's.

------------------------------------------------------------------------
r1015 | knu | 2004-05-27 15:00:51 +0900 (Thu, 27 May 2004) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Indicate some pieces of information on what is going on in the process
title.

------------------------------------------------------------------------
r1014 | knu | 2004-05-27 14:59:32 +0900 (Thu, 27 May 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Add setproctitle().

------------------------------------------------------------------------
r1013 | knu | 2004-05-27 14:26:53 +0900 (Thu, 27 May 2004) | 2 lines
Changed paths:
   M /trunk/bin/portversion

Make a generated script accept additional arguments for portupgrade(1).

------------------------------------------------------------------------
r1012 | knu | 2004-05-27 14:05:33 +0900 (Thu, 27 May 2004) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion

Massive message improvement. (I hope..)

------------------------------------------------------------------------
r1011 | knu | 2004-05-27 13:08:35 +0900 (Thu, 27 May 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

pkg_site_mirror(): Use pointyhat.FreeBSD.org instead of bento and beta.

------------------------------------------------------------------------
r1010 | knu | 2004-05-15 02:22:09 +0900 (Sat, 15 May 2004) | 2 lines
Changed paths:
   M /trunk/COPYING
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkgdb
   M /trunk/bin/portcvsweb
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/pkgtsort.rb

Update Copyright years.

------------------------------------------------------------------------
r1009 | knu | 2004-03-25 06:46:49 +0900 (Thu, 25 Mar 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix a leftover Fixnum.

------------------------------------------------------------------------
r1008 | knu | 2004-03-25 06:28:45 +0900 (Thu, 25 Mar 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgversion.rb
   M /trunk/tests/test_pkgversion.rb

Ignore padded 0's.

------------------------------------------------------------------------
r1007 | knu | 2004-03-25 06:11:48 +0900 (Thu, 25 Mar 2004) | 7 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb

- Replace the PkgResult constants with symbols.

- Show a summary of how many packages were upgraded, ignored, skipped
  and failed after listing results.

  Requested by:	netchild

------------------------------------------------------------------------
r1006 | knu | 2004-03-25 05:11:08 +0900 (Thu, 25 Mar 2004) | 4 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgversion.rb
   M /trunk/tests/test_pkgversion.rb

Ruby 1.8-ism.
  - Object#type -> Object#class
  - TypeError -> ArgumentError (partially)

------------------------------------------------------------------------
r1005 | knu | 2004-03-25 05:09:30 +0900 (Thu, 25 Mar 2004) | 2 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

Update libtool_pkgname.

------------------------------------------------------------------------
r1004 | knu | 2004-02-08 17:22:23 +0900 (Sun, 08 Feb 2004) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Use stdout/stderr redirection rather than calling script(1) when stdin
is not a tty.

------------------------------------------------------------------------
r1003 | knu | 2004-02-08 17:21:57 +0900 (Sun, 08 Feb 2004) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

make_describe_pass[12] were obsoleted.

------------------------------------------------------------------------
r1002 | knu | 2004-02-08 17:21:28 +0900 (Sun, 08 Feb 2004) | 3 lines
Changed paths:
   M /trunk/bin/Makefile
   D /trunk/bin/make_describe_pass1
   D /trunk/bin/make_describe_pass2
   M /trunk/lib/portsdb.rb

Use the canonical way to generate INDEX now that "make index" is fast
enough and the alternative method now does not work properly.

------------------------------------------------------------------------
r1001 | knu | 2004-02-08 17:19:15 +0900 (Sun, 08 Feb 2004) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Properly pass logfile to uninstall_pkg().

------------------------------------------------------------------------
r1000 | knu | 2004-01-13 11:51:35 +0900 (Tue, 13 Jan 2004) | 2 lines
Changed paths:
   M /trunk/bin/make_describe_pass1
   M /trunk/bin/make_describe_pass2

Take EXTRACT_DEPENDS into account.

------------------------------------------------------------------------
r999 | knu | 2004-01-13 11:50:48 +0900 (Tue, 13 Jan 2004) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb.1

Fix typos and grammos.

Submitted by:	Jens Schweikhardt <schweikh@schweikhardt.net>

------------------------------------------------------------------------
r998 | knu | 2003-10-25 19:41:18 +0900 (Sat, 25 Oct 2003) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Fix another occurrence of "pacakge".

------------------------------------------------------------------------
r997 | knu | 2003-10-25 18:42:46 +0900 (Sat, 25 Oct 2003) | 5 lines
Changed paths:
   M /trunk/README
   M /trunk/etc/pkgtools.conf.5

More typo fixes.

FreeBSD PR:	ports/57349
Submitted by:	Oliver Eikemeier <eikemeier@fillmore-labs.com>

------------------------------------------------------------------------
r996 | knu | 2003-10-19 20:56:34 +0900 (Sun, 19 Oct 2003) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Sleep for 3 seconds between stop and start in restart.

------------------------------------------------------------------------
r995 | knu | 2003-08-31 23:04:48 +0900 (Sun, 31 Aug 2003) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb.1

Fix typos: pacakges -> packages

Submitted by:	Oliver Eikemeier <eikemeier@fillmore-labs.com>

------------------------------------------------------------------------
r994 | knu | 2003-07-23 21:23:05 +0900 (Wed, 23 Jul 2003) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkgdb
   M /trunk/bin/portsclean
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/portsdb.rb

If pkg_* is found in $PREFIX/sbin, use them instead of ones in
/usr/sbin.

------------------------------------------------------------------------
r993 | knu | 2003-07-22 14:25:24 +0900 (Tue, 22 Jul 2003) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix -q by properly initializing necessary variables in
init_pkgtools_global() instead of load_config().

------------------------------------------------------------------------
r992 | knu | 2003-07-22 14:15:35 +0900 (Tue, 22 Jul 2003) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb

As the MOVED file is getting bigger and bigger, do not cache the
entries in memory but look it up every time needed.

------------------------------------------------------------------------
r991 | knu | 2003-07-20 06:39:31 +0900 (Sun, 20 Jul 2003) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Show how to specify multipart arguments in one MAKE_ARG entry.

FreeBSD PR:	ports/54631
Submitted by:	Bruce M Simpson <bms@spc.org>

------------------------------------------------------------------------
r990 | knu | 2003-07-20 06:18:48 +0900 (Sun, 20 Jul 2003) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Some servers like bento transfer packages files uncompressed, so add a
workaround for this.

------------------------------------------------------------------------
r989 | knu | 2003-04-27 06:22:47 +0900 (Sun, 27 Apr 2003) | 3 lines
Changed paths:
   M /trunk/bin/portsclean

Ruby 1.8's open() {} fails in error if the stream is closed when the
block ends.  I just hope that the zombie problem is already gone.

------------------------------------------------------------------------
r988 | knu | 2003-04-27 06:20:37 +0900 (Sun, 27 Apr 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

The variable "line" should be defined outside the block.

------------------------------------------------------------------------
r987 | knu | 2003-04-27 06:19:44 +0900 (Sun, 27 Apr 2003) | 5 lines
Changed paths:
   M /trunk/bin/make_describe_pass1

COMMENTFILE is deprecated.  Weird.  I thought I committed these
changes long long ago.

Submitted by:	Jean-Yves Lefort <jylefort@brutele.be>.

------------------------------------------------------------------------
r986 | knu | 2003-04-22 14:35:20 +0900 (Tue, 22 Apr 2003) | 2 lines
Changed paths:
   M /trunk/bin/make_describe_pass1
   M /trunk/bin/pkgdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkgtools.rb

Do not explicitly close streams when open(){} automatically does it.

------------------------------------------------------------------------
r985 | knu | 2003-04-22 14:05:59 +0900 (Tue, 22 Apr 2003) | 4 lines
Changed paths:
   M /trunk/bin/portsclean

Fix a typo and unbreak portsclean -P.

Submitted by:	Olivier Tharan <olive@oban.frmug.org>

------------------------------------------------------------------------
r984 | knu | 2003-04-20 07:11:18 +0900 (Sun, 20 Apr 2003) | 4 lines
Changed paths:
   M /trunk/bin/make_describe_pass2

Fix the COMMENT support.

Submitted by:	Frerich Raabe <frerich.raabe@gmx.de>

------------------------------------------------------------------------
r983 | knu | 2003-03-28 17:26:54 +0900 (Fri, 28 Mar 2003) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Fix a missing assignment.

------------------------------------------------------------------------
r982 | knu | 2003-03-23 17:17:27 +0900 (Sun, 23 Mar 2003) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Fix a finger'o.

------------------------------------------------------------------------
r981 | knu | 2003-03-10 17:51:18 +0900 (Mon, 10 Mar 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Set OS_PKGBRANCH to "<n>-stable" for PRERELEASE, RC, ALPHA, BETA, etc.

------------------------------------------------------------------------
r980 | knu | 2003-03-10 02:20:51 +0900 (Mon, 10 Mar 2003) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf.5

Rephrase a paragraph.

PR:		ports/49042
Submitted by:	Chris Pepper <pepper@rockefeller.edu>

------------------------------------------------------------------------
r979 | knu | 2003-03-09 16:09:20 +0900 (Sun, 09 Mar 2003) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Apply grammar fixes.

PR:		ports/49041
Submitted by:	Chris Pepper <pepper@reppep.com>

------------------------------------------------------------------------
r978 | knu | 2003-03-08 15:55:50 +0900 (Sat, 08 Mar 2003) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob

Fix BEFOREDEINSTALL facilities.

------------------------------------------------------------------------
r977 | knu | 2003-03-08 15:15:26 +0900 (Sat, 08 Mar 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Require "features/ruby18/enumerable", for any? is a ruby 1.8 feature.

------------------------------------------------------------------------
r976 | knu | 2003-03-06 14:56:03 +0900 (Thu, 06 Mar 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Run AFTERINSTALL commands after restoring a failed upgrade.

------------------------------------------------------------------------
r975 | knu | 2003-03-05 12:24:03 +0900 (Wed, 05 Mar 2003) | 8 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Introduce a BEFOREDEINSTALL knob.

Deprecate rc_file() and rc_files(), and provide enabled_rc_scripts()
and disabled_rc_scripts() instead.

Provide cmd_start_rc(), cmd_stop_rc(), and cmd_enable_rc() in addition
to cmd_restart_rc() and cmd_disable_rc().

------------------------------------------------------------------------
r974 | knu | 2003-03-05 12:21:53 +0900 (Wed, 05 Mar 2003) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob

Introduce a BEFOREDEINSTALL knob.

------------------------------------------------------------------------
r973 | knu | 2003-03-03 03:02:52 +0900 (Mon, 03 Mar 2003) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Add new utility functions: startup_files(), cmd_restart_rc() and
cmd_disable_rc().  rc_file() is being obsoleted. (still available)

Update examples.

------------------------------------------------------------------------
r972 | knu | 2003-03-03 03:00:52 +0900 (Mon, 03 Mar 2003) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

-A/-B: Remove ;'s and spaces at the beginning of each command line to
stop sh(1) from issuing a syntax error.

-A/-B: Omit running null commands.

------------------------------------------------------------------------
r971 | knu | 2003-02-28 04:20:50 +0900 (Fri, 28 Feb 2003) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb

Add a missing comma and unbreak the cyclic dependency fixer.

Submitted by:	ITO Tsuyoshi <tsuyoshi@is.s.u-tokyo.ac.jp>

------------------------------------------------------------------------
r970 | knu | 2003-02-26 14:45:07 +0900 (Wed, 26 Feb 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Always skip '.' and '..'.

------------------------------------------------------------------------
r969 | knu | 2003-02-26 14:44:47 +0900 (Wed, 26 Feb 2003) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

INDEX.local would be a better name for a locally generated INDEX.

------------------------------------------------------------------------
r968 | knu | 2003-02-18 11:33:59 +0900 (Tue, 18 Feb 2003) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb

PortsDB#glob() can return an empty array.

Reported by:	"Daniel M. Zimmerman" <dmz@tffenterprises.com>

------------------------------------------------------------------------
r967 | knu | 2003-02-18 05:41:24 +0900 (Tue, 18 Feb 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Update the WARNINGS section to match the reality.

------------------------------------------------------------------------
r966 | knu | 2003-02-18 05:00:57 +0900 (Tue, 18 Feb 2003) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix bogus next's.

Reported by:	Larry Rosenman <ler@lerctr.org>

------------------------------------------------------------------------
r965 | knu | 2003-02-17 01:23:57 +0900 (Mon, 17 Feb 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Make a forgotten replacement of variables.

------------------------------------------------------------------------
r964 | knu | 2003-02-17 00:11:32 +0900 (Mon, 17 Feb 2003) | 5 lines
Changed paths:
   M /trunk/bin/pkgdb

Treat bsdpan-* packages specially; set their origins to those of p5-*
where possible.

Requested by:	nik

------------------------------------------------------------------------
r963 | knu | 2003-02-17 00:10:21 +0900 (Mon, 17 Feb 2003) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix modify_origin(): Properly add a new origin line if no origin is
recorded.

------------------------------------------------------------------------
r962 | knu | 2003-02-16 20:31:02 +0900 (Sun, 16 Feb 2003) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Improve the packages support: When installing a binary package,
automatically detect and install ports/packages it depends on.

------------------------------------------------------------------------
r961 | knu | 2003-02-16 02:24:15 +0900 (Sun, 16 Feb 2003) | 4 lines
Changed paths:
   M /trunk/bin/make_describe_pass1

Replace COMMENT with COMMENTFILE.

Submitted by:	Jean-Yves Lefort <jylefort@brutele.be>

------------------------------------------------------------------------
r960 | knu | 2003-02-04 15:20:35 +0900 (Tue, 04 Feb 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Update the usage: add -l and -L.

------------------------------------------------------------------------
r959 | knu | 2003-02-04 15:18:24 +0900 (Tue, 04 Feb 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Catch up with the change of -L.

------------------------------------------------------------------------
r958 | knu | 2003-02-01 07:44:57 +0900 (Sat, 01 Feb 2003) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgmisc.rb
   M /trunk/lib/pkgtools.rb

Introduce PkgResult and PkgResultSet classes.

------------------------------------------------------------------------
r957 | knu | 2003-01-30 12:01:21 +0900 (Thu, 30 Jan 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Chase the bento site hierarchy change.

------------------------------------------------------------------------
r956 | knu | 2003-01-27 03:37:36 +0900 (Mon, 27 Jan 2003) | 4 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Update the description of MAKE_ARGS.

Replace an obsolete example with a new one.

------------------------------------------------------------------------
r955 | knu | 2003-01-27 03:21:02 +0900 (Mon, 27 Jan 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Clean up config_commandtable().

------------------------------------------------------------------------
r954 | knu | 2003-01-26 21:32:18 +0900 (Sun, 26 Jan 2003) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Update examples.

------------------------------------------------------------------------
r953 | knu | 2003-01-26 21:32:02 +0900 (Sun, 26 Jan 2003) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Utilize the optional second argument of config_make_args().

------------------------------------------------------------------------
r952 | knu | 2003-01-26 21:30:47 +0900 (Sun, 26 Jan 2003) | 5 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

- Use Set where convenient.

- Make MAKE_ARGS more intelligent.  Now understands something like
  'ruby18-*' => 'RUBY_VER=1.8'.

------------------------------------------------------------------------
r951 | knu | 2003-01-23 23:10:43 +0900 (Thu, 23 Jan 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

Enumerable#partition is not used any more.

------------------------------------------------------------------------
r950 | knu | 2003-01-20 07:03:12 +0900 (Mon, 20 Jan 2003) | 2 lines
Changed paths:
   A /trunk/lib/pkgsqldb.rb

Prototype implementation of SQLite backed pkgdb.

------------------------------------------------------------------------
r949 | knu | 2003-01-20 02:27:17 +0900 (Mon, 20 Jan 2003) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Switch from ftools to fileutils.

------------------------------------------------------------------------
r948 | knu | 2003-01-15 16:36:12 +0900 (Wed, 15 Jan 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix a trivial and harmless typo.

------------------------------------------------------------------------
r947 | knu | 2003-01-15 16:35:39 +0900 (Wed, 15 Jan 2003) | 2 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

Use ruby-shim's implementation.

------------------------------------------------------------------------
r946 | knu | 2002-12-31 05:06:49 +0900 (Tue, 31 Dec 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsclean.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1

Fix tag misuses.

------------------------------------------------------------------------
r945 | knu | 2002-12-31 02:29:06 +0900 (Tue, 31 Dec 2002) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Fix a typo.

------------------------------------------------------------------------
r944 | knu | 2002-12-24 22:08:13 +0900 (Tue, 24 Dec 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

realpath(3) may return NULL, so delegate to File.expand_path() in such
a case.

------------------------------------------------------------------------
r943 | knu | 2002-12-23 03:51:04 +0900 (Mon, 23 Dec 2002) | 3 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Rename -L/--log-prefix to -L/--log-file and make it accept a printf(3)
style format.

------------------------------------------------------------------------
r942 | knu | 2002-12-23 03:50:57 +0900 (Mon, 23 Dec 2002) | 12 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Change the meaning of -D/--distclean.  When specified once, delete
failed distfiles and retry if checksum fails.  When specified twice,
do "make distclean" before each fetch or build.

Make -F/--fetch-only call make checksum/checksum-recursive instead of
make fetch/fetch-recursive.

Rename -l/--log-results to -l/--results-file.

Rename -L/--log-prefix to -L/--log-file and make it accept a printf(3)
style format.

------------------------------------------------------------------------
r941 | knu | 2002-12-23 03:31:45 +0900 (Mon, 23 Dec 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Define unlink_file().

------------------------------------------------------------------------
r940 | knu | 2002-12-23 03:31:21 +0900 (Mon, 23 Dec 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Store and look for file names after resolving symlinks using
realpath(3).

------------------------------------------------------------------------
r939 | knu | 2002-12-23 03:29:22 +0900 (Mon, 23 Dec 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

Implement File::realpath() using Ruby/DL.

------------------------------------------------------------------------
r938 | knu | 2002-12-23 03:28:40 +0900 (Mon, 23 Dec 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Add PortsDB#dist_dir.

------------------------------------------------------------------------
r937 | knu | 2002-12-16 15:26:43 +0900 (Mon, 16 Dec 2002) | 5 lines
Changed paths:
   M /trunk/bin/portsclean

Handle sequences of /'s in ldconfig -r output.

FreeBSD PR:	ports/46162
Submitted by:	Lev A. Serebryakov <lev@serebryakov.spb.ru>

------------------------------------------------------------------------
r936 | knu | 2002-12-16 15:21:24 +0900 (Mon, 16 Dec 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Use gsub instead of tr_s, since tr_s is not multibyte aware.

------------------------------------------------------------------------
r935 | knu | 2002-12-13 18:05:34 +0900 (Fri, 13 Dec 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Update comment.

add_origin() and delete_origin() are supposed to be private.

------------------------------------------------------------------------
r934 | knu | 2002-12-11 03:25:30 +0900 (Wed, 11 Dec 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Make automatic dependency fixing based on DEPORIGIN work better.

------------------------------------------------------------------------
r933 | knu | 2002-12-09 03:06:20 +0900 (Mon, 09 Dec 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb

Introduce a "fixme" cookie file not to invoke pkgdb -aF unnecessarily.

------------------------------------------------------------------------
r932 | knu | 2002-12-08 20:20:46 +0900 (Sun, 08 Dec 2002) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Add new variables: USE_PKGS and USE_PKGS_ONLY.

Requested by:	Jeff Penn <jeff@jrpenn.demon.co.uk>

------------------------------------------------------------------------
r931 | knu | 2002-12-08 06:30:09 +0900 (Sun, 08 Dec 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Use PortsDB#{make_var,my_portdir}.

------------------------------------------------------------------------
r930 | knu | 2002-12-08 06:27:45 +0900 (Sun, 08 Dec 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Add Portsdb#{my_port,my_portdir}.

------------------------------------------------------------------------
r929 | knu | 2002-12-08 06:13:50 +0900 (Sun, 08 Dec 2002) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Add a new method PortsDB#make_var and use it everywhere.

Recognize INDEXFILE defaulting to 'INDEX'.

------------------------------------------------------------------------
r928 | knu | 2002-12-07 20:32:05 +0900 (Sat, 07 Dec 2002) | 2 lines
Changed paths:
   M /trunk/Makefile
   M /trunk/README
   A /trunk/tests/test_all.rb
   M /trunk/tests/test_pkgdb.rb
   M /trunk/tests/test_pkginfo.rb
   M /trunk/tests/test_pkgtsort.rb
   M /trunk/tests/test_pkgversion.rb
   M /trunk/tests/test_portinfo.rb
   M /trunk/tests/test_portsdb.rb

Switch to Test::Unit.

------------------------------------------------------------------------
r927 | knu | 2002-11-29 09:46:46 +0900 (Fri, 29 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Add Hungarian and Portuguese.

------------------------------------------------------------------------
r926 | knu | 2002-11-20 16:20:13 +0900 (Wed, 20 Nov 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Convert an extended RE to a basic RE and do not rely on sed(1)'s
having -E.

Pointed out by: nork@FreeBSD.org

------------------------------------------------------------------------
r925 | knu | 2002-11-19 13:53:50 +0900 (Tue, 19 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Better retrying logic and an informational message for install_data().

------------------------------------------------------------------------
r924 | knu | 2002-11-19 04:23:43 +0900 (Tue, 19 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Use the MOVED information also for fixing @pkgdep and DEORIGIN.

------------------------------------------------------------------------
r923 | knu | 2002-11-19 04:03:21 +0900 (Tue, 19 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb

Auto-fix the origins of moved ports listed in MOVED. (just ORIGIN, not
DEPORIGIN for now)

------------------------------------------------------------------------
r922 | knu | 2002-11-19 03:31:19 +0900 (Tue, 19 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/lib/pkgtools.rb

Trash subst_file() and add filter_file() instead.

------------------------------------------------------------------------
r921 | knu | 2002-11-19 00:33:51 +0900 (Tue, 19 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/lib/pkgtools.rb

Introduce a new utility function: modify_origin().

------------------------------------------------------------------------
r920 | knu | 2002-11-18 22:38:46 +0900 (Mon, 18 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Add MOVED suport to pkgdb(1).  Currently interactive fix only.

------------------------------------------------------------------------
r919 | knu | 2002-11-18 22:36:08 +0900 (Mon, 18 Nov 2002) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Complete the MOVED parser.  Remove PkgDB#moved_map and add new
methods: PkgDB#moved_entries and PkgDB#trace_moved(port) instead.

------------------------------------------------------------------------
r918 | knu | 2002-11-18 17:30:01 +0900 (Mon, 18 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Use sudo as necessary in saving log files also.

------------------------------------------------------------------------
r917 | knu | 2002-11-18 17:29:04 +0900 (Mon, 18 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Use sudo in installing a file after trying as the current user first.

------------------------------------------------------------------------
r916 | knu | 2002-11-16 05:48:26 +0900 (Sat, 16 Nov 2002) | 5 lines
Changed paths:
   M /trunk/bin/pkgdb

When pointing out a missing origin, show the name of the package in
question.

Suggested by:	Genesys on EFnet

------------------------------------------------------------------------
r915 | knu | 2002-11-16 05:45:51 +0900 (Sat, 16 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

This regexp is meant to match against line.

------------------------------------------------------------------------
r914 | knu | 2002-11-14 20:30:08 +0900 (Thu, 14 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Skip the check for origin duplicates when in automatic mode.

------------------------------------------------------------------------
r913 | knu | 2002-11-13 12:55:07 +0900 (Wed, 13 Nov 2002) | 3 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

Catch up with the latest specification of PkgDB#strip which now
accepts port origins and rejects ambiguous and bogus input.

------------------------------------------------------------------------
r912 | knu | 2002-11-13 04:26:29 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Make sure to waitpid terminated processes immediately.

------------------------------------------------------------------------
r911 | knu | 2002-11-13 04:18:29 +0900 (Wed, 13 Nov 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

An attempt to eliminate grep(1) zombies - make sure to waitpid the
popen'd process immediately after the job is done.

------------------------------------------------------------------------
r910 | knu | 2002-11-13 04:11:51 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Do not trap SIGCHLD.

------------------------------------------------------------------------
r909 | knu | 2002-11-13 03:10:13 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Check return status of hardly failing commands also.

------------------------------------------------------------------------
r908 | knu | 2002-11-13 02:52:13 +0900 (Wed, 13 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/misc/zsh/_pkgtools

-Q suppresses stdout output and -QQ does for stderr in addition.
(Formerly the order was stderr -> stdout)

------------------------------------------------------------------------
r907 | knu | 2002-11-13 02:42:24 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Implement PortsDB#moved_map which parses ports/MOVED.

------------------------------------------------------------------------
r906 | knu | 2002-11-13 02:40:26 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Use -QQ to avoid calling /bin/sh.

------------------------------------------------------------------------
r905 | knu | 2002-11-13 02:39:57 +0900 (Wed, 13 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portcvsweb

Call fetch(1) with -q instead of appending ">/dev/null" to avoid using
/bin/sh.

------------------------------------------------------------------------
r904 | knu | 2002-11-13 02:39:03 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Use -Q and reduce /bin/sh calls.

------------------------------------------------------------------------
r903 | knu | 2002-11-13 02:38:34 +0900 (Wed, 13 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgtools

Implement -Q/--quiet for internal use.

------------------------------------------------------------------------
r902 | knu | 2002-11-13 01:55:26 +0900 (Wed, 13 Nov 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkgdb
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/pkgtools.rb

Handle SIGCHLD and wait for children to avoid zombies.

Submitted by:	lioux@FreeBSD.org

------------------------------------------------------------------------
r901 | knu | 2002-11-09 16:00:20 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Add install_data().  Use install(1) to install data files.

------------------------------------------------------------------------
r900 | knu | 2002-11-09 13:52:51 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Allow specifying a directory after -L.

------------------------------------------------------------------------
r899 | knu | 2002-11-09 03:42:31 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Reorder the progress messages added in the last commit..

------------------------------------------------------------------------
r898 | knu | 2002-11-09 03:33:56 +0900 (Sat, 09 Nov 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Again, redirect pkgdb -aF's stderr to /dev/null to hide the message:
"** You do not own /var/db/pkg. (use -f to force)"

------------------------------------------------------------------------
r897 | knu | 2002-11-09 03:21:37 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Auto-fix dependencies before creating a package.

------------------------------------------------------------------------
r896 | knu | 2002-11-09 03:15:40 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1

Add --autofix, which is a shorthand of --auto --fix (-aF).

------------------------------------------------------------------------
r895 | knu | 2002-11-09 03:10:15 +0900 (Sat, 09 Nov 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Add an option "force" to PkgDB#autofix.

Do not redirect pkgdb -aF's stderr to /dev/null.

------------------------------------------------------------------------
r894 | knu | 2002-11-09 02:30:21 +0900 (Sat, 09 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/etc/pkgtools.conf

Add a new configuration variable: ALT_PKGDEP, which defines
alternative dependencies, used by pkgdb -F/-aF.

------------------------------------------------------------------------
r893 | knu | 2002-11-09 02:18:30 +0900 (Sat, 09 Nov 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob.1
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/portinfo.rb

Allow a regular expression pattern against origins as pkgname glob
pattern.  For example, 'pkg_info ':(japanese|chinese|korean)/' works
as would expected now.

------------------------------------------------------------------------
r892 | knu | 2002-11-09 02:01:37 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob.1

Now patterns like 'lang/*' is allowed as a pkgname glob.

------------------------------------------------------------------------
r891 | knu | 2002-11-09 01:56:53 +0900 (Sat, 09 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Add PkgDB#match?.

------------------------------------------------------------------------
r890 | knu | 2002-11-09 01:50:18 +0900 (Sat, 09 Nov 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Allow a ports (origin) glob pattern as pkgname glob pattern.  For
example, now "pkg_glob 'lang/*'" and "portupgrade lang/ruby" works as
would be expected.

------------------------------------------------------------------------
r889 | knu | 2002-11-06 21:27:13 +0900 (Wed, 06 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Get portupgrade -s to work again.

------------------------------------------------------------------------
r888 | knu | 2002-11-05 06:52:49 +0900 (Tue, 05 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/portsdb.rb

Make these work with ruby 1.7.

------------------------------------------------------------------------
r887 | knu | 2002-11-04 08:09:16 +0900 (Mon, 04 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Sync with the latest "processlogs" script.

------------------------------------------------------------------------
r886 | knu | 2002-11-04 04:45:14 +0900 (Mon, 04 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgtools

Rename -g/--go-on to -k/--keep-going, on the (vague) analogy of
make(1).

------------------------------------------------------------------------
r885 | knu | 2002-11-03 06:22:21 +0900 (Sun, 03 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Properly support deletion of a @pkgdep.

------------------------------------------------------------------------
r884 | knu | 2002-11-01 08:26:11 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgdb.rb

Disregard a package if it has a file named "+IGNOREME" in the package
directory.

------------------------------------------------------------------------
r883 | knu | 2002-11-01 08:07:24 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

D'oh, get modify_pkgdep() working again.  egrep(1) doesn't support \s,
but [[:space:]].

------------------------------------------------------------------------
r882 | knu | 2002-11-01 07:56:57 +0900 (Fri, 01 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix a silly bug.. missing origin == nil, not true.

------------------------------------------------------------------------
r881 | knu | 2002-11-01 07:44:19 +0900 (Fri, 01 Nov 2002) | 7 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Prepare a new constant OS_PKGBRANCH, which is set to a release/branch
name that is suitable for specifying a FTP packages directory, and
make pkg_site_mirror() use it.

FreeBSD PR:	ports/43265
Submitted by:	Andriy Gapon <avg@icyb.net.ua>

------------------------------------------------------------------------
r880 | knu | 2002-11-01 07:28:33 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portsclean

Improve messages.  Use the word "shadow" to say that a library hides
another one with the same name.

------------------------------------------------------------------------
r879 | knu | 2002-11-01 05:58:36 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Restore the previous feature of update_pkgdep().  Do not touch
+CONTENTS if it does not contain the wanted pattern.

------------------------------------------------------------------------
r878 | knu | 2002-11-01 05:48:19 +0900 (Fri, 01 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb

Rename grep_file() to grep_q_file().

------------------------------------------------------------------------
r877 | knu | 2002-11-01 05:46:29 +0900 (Fri, 01 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Sync with ports/Tools/portbuild/scripts/processlogs.

------------------------------------------------------------------------
r876 | knu | 2002-11-01 05:03:34 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Pass the origin to update_pkgdep() so it can properly update
DEPORIGIN's of installed packages.

------------------------------------------------------------------------
r875 | knu | 2002-11-01 04:59:20 +0900 (Fri, 01 Nov 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Make {modify,update}_pkgdep() accept an optional origin.

------------------------------------------------------------------------
r874 | knu | 2002-11-01 04:57:57 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb

Make sure to initialize variables before directly invoking
fix_db_phase2().

------------------------------------------------------------------------
r873 | knu | 2002-11-01 03:01:06 +0900 (Fri, 01 Nov 2002) | 5 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb

Move modify_pkgdep() from pkgdb to pkgtools.rb.

Reimplement update_pkgdep().  Now DEPORIGIN is taken care of, although
the routine got slower when +CONTENTS is very big.

------------------------------------------------------------------------
r872 | knu | 2002-11-01 01:56:10 +0900 (Fri, 01 Nov 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Sync with reality.

------------------------------------------------------------------------
r871 | knu | 2002-11-01 01:55:48 +0900 (Fri, 01 Nov 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not bother with +REQUIRED_BY files when pkgdb -aF reconstructs them
all.

------------------------------------------------------------------------
r870 | knu | 2002-11-01 01:03:27 +0900 (Fri, 01 Nov 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not redirect stderr to /dev/null when calling portsclean -L.  Now
the pkgdb updater's indicator appears properly.

Do the timestamp hack in install_{port,pkg} too.

------------------------------------------------------------------------
r869 | knu | 2002-10-31 21:13:20 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Check if perl is available before using it.

------------------------------------------------------------------------
r868 | knu | 2002-10-31 21:09:42 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/portsclean
   M /trunk/lib/pkgtools.rb

Autoload the readline library.

------------------------------------------------------------------------
r867 | knu | 2002-10-31 21:09:21 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Ignore unpaired DEPORIGIN.

------------------------------------------------------------------------
r866 | knu | 2002-10-31 06:20:07 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Run pkgdb -aF at closing.

------------------------------------------------------------------------
r865 | knu | 2002-10-31 06:19:00 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Avoid running pkgdb when unneeded.

------------------------------------------------------------------------
r864 | knu | 2002-10-31 06:03:56 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Make prompt_*() less verbose when $verbose is false.

------------------------------------------------------------------------
r863 | knu | 2002-10-31 06:03:10 +0900 (Thu, 31 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Make pkgdb(1) less verbose when -v is not specified.

------------------------------------------------------------------------
r862 | knu | 2002-10-30 02:54:17 +0900 (Wed, 30 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgmisc.rb

Fix shellwords(): Do not interpret \ as meta-character in '...'.

------------------------------------------------------------------------
r861 | knu | 2002-10-29 17:13:57 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/lib/pkgtools.rb

Make prompt_*() look at $automatic instead of $interactive.

------------------------------------------------------------------------
r860 | knu | 2002-10-29 16:14:33 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Automatically run "pkgdb -aF" before recursing dependencies.

------------------------------------------------------------------------
r859 | knu | 2002-10-29 15:47:04 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgtools

Support pkgdb's -a option.

------------------------------------------------------------------------
r858 | knu | 2002-10-29 15:45:56 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb.1

Describe -a/--auto.

------------------------------------------------------------------------
r857 | knu | 2002-10-29 15:45:28 +0900 (Tue, 29 Oct 2002) | 6 lines
Changed paths:
   M /trunk/bin/pkgdb

Use DEPORIGIN information.

Add a new option: -a/--auto.

Split fix_dependencies() into several functions.

------------------------------------------------------------------------
r856 | knu | 2002-10-29 15:29:11 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Suggest using libchk(1) to help manually clean out lib/compat/pkg.

------------------------------------------------------------------------
r855 | knu | 2002-10-29 15:26:36 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Make prompt_*() aware of the value of $interactive.

------------------------------------------------------------------------
r854 | knu | 2002-10-29 13:03:36 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Try .tgz first on FreeBSD 4.x and prior.

------------------------------------------------------------------------
r853 | knu | 2002-10-29 13:02:57 +0900 (Tue, 29 Oct 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Give PkgDB#pkgdep the ability to read DEPORIGIN.

------------------------------------------------------------------------
r852 | knu | 2002-10-19 23:20:23 +0900 (Sat, 19 Oct 2002) | 5 lines
Changed paths:
   M /trunk/bin/portversion.1

Fix a typo.

FreeBSD PR:	ports/43723
Submitted by:	april <april@starwhack.net>

------------------------------------------------------------------------
r851 | knu | 2002-10-19 23:19:53 +0900 (Sat, 19 Oct 2002) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Time the whole session also.

Requested by:	nork@FreeBSD.org

------------------------------------------------------------------------
r850 | knu | 2002-09-21 16:16:22 +0900 (Sat, 21 Sep 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a bug where portupgrade creates packages in a wrong directory.
This was introduced in the previous commit...

Submitted by:	"Dmitry A. Panov" <redfox@Fluffy.Khv.RU>

------------------------------------------------------------------------
r849 | knu | 2002-09-21 07:23:56 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb

Make portcvsweb <pkgname> work when it is an obsoleted package.

------------------------------------------------------------------------
r848 | knu | 2002-09-21 02:09:06 +0900 (Sat, 21 Sep 2002) | 7 lines
Changed paths:
   M /trunk/README

- State that lang/ruby-devel is the alternative to lang/ruby +
  lang/ruby16-shim-ruby18.

- State that devel/ruby-testunit is the successor to devel/ruby-unit.

- Drop sysutils/pkg_tarup.

------------------------------------------------------------------------
r847 | knu | 2002-09-21 02:02:11 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/COPYING

Update years.

------------------------------------------------------------------------
r846 | knu | 2002-09-21 02:01:28 +0900 (Sat, 21 Sep 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/portsdb.rb

Move pkg_sufx from PkgDB to PortsDB where it should belong in the
first place.

------------------------------------------------------------------------
r845 | knu | 2002-09-21 01:45:25 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Source _bsd_pkg.

------------------------------------------------------------------------
r844 | knu | 2002-09-21 01:34:39 +0900 (Sat, 21 Sep 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Use pkg_create(1) -b instead of pkg_tarup(1) to package already
installed packages.  PKG_SUFX is refered to.

------------------------------------------------------------------------
r843 | knu | 2002-09-21 01:33:02 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/tcsh/complete.sample

Exit pkg_tarup, enter pkg_create.

------------------------------------------------------------------------
r842 | knu | 2002-09-21 01:32:30 +0900 (Sat, 21 Sep 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Exit pkg_tarup, enter add pkg_create.

Implement PkgDB#pkg_sufx.

------------------------------------------------------------------------
r841 | knu | 2002-09-21 01:30:51 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/Makefile
   D /trunk/misc/zsh/_pkg_tarup

Drop pkg_tarup(1) support.

------------------------------------------------------------------------
r840 | knu | 2002-09-21 01:30:27 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Remove the part that was integrated into the zsh distribution.

------------------------------------------------------------------------
r839 | knu | 2002-09-21 00:42:09 +0900 (Sat, 21 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

`pkg_create -P' takes pkgnames, not a file.

------------------------------------------------------------------------
r838 | knu | 2002-09-21 00:31:09 +0900 (Sat, 21 Sep 2002) | 3 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Drop pkg_tarup(1) support and add definitions for pkg_create(1),
pkg_delete(1) and pkg_info(1).

------------------------------------------------------------------------
r837 | knu | 2002-09-20 03:31:29 +0900 (Fri, 20 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Fix a stupid typo: s/@command/@comment/

------------------------------------------------------------------------
r836 | knu | 2002-09-15 22:03:43 +0900 (Sun, 15 Sep 2002) | 3 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Make MAKE_ARGS accept a proc.
[Suggested by:	Alan Eldridge <ports@geeksrus.net>]

------------------------------------------------------------------------
r835 | knu | 2002-09-12 03:29:28 +0900 (Thu, 12 Sep 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Now that lang/ruby_static is updated, these tools should work with it
as well as lang/ruby_static-devel.

------------------------------------------------------------------------
r834 | knu | 2002-09-07 13:56:11 +0900 (Sat, 07 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix timer messages.

------------------------------------------------------------------------
r833 | knu | 2002-09-07 13:55:50 +0900 (Sat, 07 Sep 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Unbreak delete_origin().

------------------------------------------------------------------------
r832 | knu | 2002-09-07 02:58:29 +0900 (Sat, 07 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Show times when -v/--verbose is specified.

------------------------------------------------------------------------
r831 | knu | 2002-09-07 02:57:48 +0900 (Sat, 07 Sep 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Add simple timing functions.

------------------------------------------------------------------------
r830 | knu | 2002-09-06 22:41:12 +0900 (Fri, 06 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Support `pkgdb -o pkgname[=origin]'.

------------------------------------------------------------------------
r829 | knu | 2002-09-06 22:40:28 +0900 (Fri, 06 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Extend pkgdb(1)'s -o so it can also modify a port's origin.

------------------------------------------------------------------------
r828 | knu | 2002-09-06 22:39:12 +0900 (Fri, 06 Sep 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Functionize add_origin() and delete_origin(), and complete
set_origin().

------------------------------------------------------------------------
r827 | knu | 2002-09-06 19:21:45 +0900 (Fri, 06 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Raise an error when an empty pkgname is given with -s.

------------------------------------------------------------------------
r826 | knu | 2002-09-06 18:32:53 +0900 (Fri, 06 Sep 2002) | 3 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Teach how to complete `pkgdb -s /from/to/'.  Since bash 2.05's `-o space'
does not seem to work at all, the option is not specified yet.

------------------------------------------------------------------------
r825 | knu | 2002-09-06 17:53:20 +0900 (Fri, 06 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Complete the pkgdb -s completion..

------------------------------------------------------------------------
r824 | knu | 2002-09-06 17:39:06 +0900 (Fri, 06 Sep 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Teach how to complete `pkgdb -s /from/to/'.

------------------------------------------------------------------------
r823 | knu | 2002-09-04 02:46:53 +0900 (Wed, 04 Sep 2002) | 3 lines
Changed paths:
   M /trunk/README

devel/ruby-fnmatch, devel/ruby-uri, devel/ruby-optparse
-> lang/ruby16-shim-ruby18

------------------------------------------------------------------------
r822 | knu | 2002-09-02 21:59:47 +0900 (Mon, 02 Sep 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1

Add a cross reference to libchk(1).

------------------------------------------------------------------------
r821 | knu | 2002-09-02 06:19:18 +0900 (Mon, 02 Sep 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix the regexp for uname output so it can parse such as
"5.0-CURRENT-YYYYMMDD-JPSNAP".
[Spotted by:	will@FreeBSD.org]

------------------------------------------------------------------------
r820 | knu | 2002-08-30 21:46:11 +0900 (Fri, 30 Aug 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb

Add more command failure checks in case sudo fails.

------------------------------------------------------------------------
r819 | knu | 2002-08-30 21:27:18 +0900 (Fri, 30 Aug 2002) | 4 lines
Changed paths:
   M /trunk/bin/portsclean

Do not mix stderr output from make(1) with stdout.

Submitted by:	Jos Backus <jos@catnook.com>

------------------------------------------------------------------------
r818 | knu | 2002-08-28 19:52:19 +0900 (Wed, 28 Aug 2002) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Always build backup packages as root.

Spotted by:	Stijn Hoop <stijn@win.tue.nl>

------------------------------------------------------------------------
r817 | knu | 2002-08-28 19:51:18 +0900 (Wed, 28 Aug 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Add {,x}backquote{,!}().

------------------------------------------------------------------------
r816 | knu | 2002-08-09 20:30:54 +0900 (Fri, 09 Aug 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Let NO_IGNORE negate IGNORE.

[FreeBSD PR:	ports/41467]
[Suggested by:	Alan Eldridge <ports@geeksrus.net>]

------------------------------------------------------------------------
r815 | knu | 2002-08-05 19:45:49 +0900 (Mon, 05 Aug 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Provide a couple of new utility functions, deorigin(origin) and
rc_file(origin_or_pkgname).

------------------------------------------------------------------------
r814 | knu | 2002-08-05 19:45:45 +0900 (Mon, 05 Aug 2002) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Provide a couple of new utility functions, deorigin(origin) and
rc_file(origin_or_pkgname).

Fix an example and provide some more examples.

------------------------------------------------------------------------
r813 | knu | 2002-08-05 15:34:04 +0900 (Mon, 05 Aug 2002) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Introduce OS_PATCHLEVEL and exclude `-p#' from OS_RELEASE.

FreeBSD PR:	ports/40375
Submitted by:	Andriy Gapon <agapon@excite.com> (partly)

------------------------------------------------------------------------
r812 | knu | 2002-08-05 07:46:15 +0900 (Mon, 05 Aug 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Add support for .tbz files.

------------------------------------------------------------------------
r811 | knu | 2002-08-05 07:32:47 +0900 (Mon, 05 Aug 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Add support for .tbz files.

Slightly fix messages.

------------------------------------------------------------------------
r810 | knu | 2002-08-05 05:37:53 +0900 (Mon, 05 Aug 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Make portsclean -P/--pkgclean aware of bzip2'd packages.

------------------------------------------------------------------------
r809 | knu | 2002-08-04 18:11:21 +0900 (Sun, 04 Aug 2002) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Look for *.tbz too.

------------------------------------------------------------------------
r808 | knu | 2002-07-16 20:42:23 +0900 (Tue, 16 Jul 2002) | 2 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

Update libtool's version number.

------------------------------------------------------------------------
r807 | knu | 2002-07-15 21:24:55 +0900 (Mon, 15 Jul 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Do not fail in error when a non-installed package is specified with -o.

------------------------------------------------------------------------
r806 | knu | 2002-07-06 18:40:59 +0900 (Sat, 06 Jul 2002) | 2 lines
Changed paths:
   M /trunk/lib/Makefile

Avoid a ruby 1.7 warning.

------------------------------------------------------------------------
r805 | knu | 2002-07-06 18:23:36 +0900 (Sat, 06 Jul 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Avoid a ruby 1.7 warning.

------------------------------------------------------------------------
r804 | knu | 2002-07-06 18:18:05 +0900 (Sat, 06 Jul 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Avoid a ruby 1.7 warning.

------------------------------------------------------------------------
r803 | knu | 2002-06-23 23:28:23 +0900 (Sun, 23 Jun 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Use the xsystem() family and show better error messages.

------------------------------------------------------------------------
r802 | knu | 2002-06-23 23:27:26 +0900 (Sun, 23 Jun 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Add x{system,sudo,script}{,!}, which raise CommandFailedError when a given
command fails.

------------------------------------------------------------------------
r801 | knu | 2002-06-23 21:27:47 +0900 (Sun, 23 Jun 2002) | 2 lines
Changed paths:
   M /trunk/Makefile.compat

Unbreak.

------------------------------------------------------------------------
r800 | knu | 2002-06-12 19:01:05 +0900 (Wed, 12 Jun 2002) | 2 lines
Changed paths:
   M /trunk/Makefile.compat

Sync with CURRENT's bsd.files.mk.

------------------------------------------------------------------------
r799 | knu | 2002-06-12 18:46:04 +0900 (Wed, 12 Jun 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/misc/zsh/_pkgtools

Clarify that -c/--collate is disabled by -f/--force.

Prompted by:	parv <parv@pair.com>

------------------------------------------------------------------------
r798 | knu | 2002-06-12 18:21:10 +0900 (Wed, 12 Jun 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob

Unbreak pkg_deinstall -c by removing a leftover variable reference.

Reported by:	Tod McQuillin <devin@spamcop.net>

------------------------------------------------------------------------
r797 | knu | 2002-06-12 13:45:46 +0900 (Wed, 12 Jun 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_sort

Warn of each package entry that's not installed.

------------------------------------------------------------------------
r796 | knu | 2002-06-12 13:41:53 +0900 (Wed, 12 Jun 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_sort

Do not print an empty line if no valid entry is given.

------------------------------------------------------------------------
r795 | knu | 2002-06-12 13:39:57 +0900 (Wed, 12 Jun 2002) | 7 lines
Changed paths:
   M /trunk/bin/pkgdb.1

Fix typos and improve phrases.

Remove an incomplete paragraph.

FreeBSD PR:	ports/39183
Submitted by:	Chris Pepper <pepper@rockefeller.edu>

------------------------------------------------------------------------
r794 | knu | 2002-06-12 13:35:50 +0900 (Wed, 12 Jun 2002) | 4 lines
Changed paths:
   M /trunk/bin/portsclean.1

Fix a typo.

Submitted by:	Martijn Koster <mak@greenhills.co.uk>

------------------------------------------------------------------------
r793 | knu | 2002-06-09 03:09:22 +0900 (Sun, 09 Jun 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/portsdb.rb

Switch from ruby-fnmatch to ruby-shim, and from ruby_s to ruby17_s.

------------------------------------------------------------------------
r792 | knu | 2002-04-29 04:56:59 +0900 (Mon, 29 Apr 2002) | 5 lines
Changed paths:
   M /trunk/bin/make_describe_pass1
   M /trunk/lib/portsdb.rb

Make portsdb -U respect PORTS_DBDIR even when it is different than
PORTS_DIR.

Reported by:	Shigeto TAJIMA <tajima@ics.es.osaka-u.ac.jp>

------------------------------------------------------------------------
r791 | knu | 2002-04-29 04:52:50 +0900 (Mon, 29 Apr 2002) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Do not set PKG_PATH in init_pkgtools_global() because that spoils
the user-defined value in pkgtools.conf.

Reported by:	The Anarcat <anarcat@anarcat.dyndns.org>

------------------------------------------------------------------------
r790 | knu | 2002-04-05 21:08:51 +0900 (Fri, 05 Apr 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkginfo.rb

Show the full pkgname as exception message when the version part is
invalid.

------------------------------------------------------------------------
r789 | knu | 2002-04-05 21:06:49 +0900 (Fri, 05 Apr 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a flaw where dependent ports' build/install error was not properly
detected when -s is specified.

Reported by:	Stijn Hoop <stijn@win.tue.nl>

------------------------------------------------------------------------
r788 | knu | 2002-03-30 17:28:45 +0900 (Sat, 30 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

-L: Fix wrong conditions, which was too conservative.

------------------------------------------------------------------------
r787 | knu | 2002-03-30 01:06:58 +0900 (Sat, 30 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

s/next/return/

------------------------------------------------------------------------
r786 | knu | 2002-03-28 14:53:48 +0900 (Thu, 28 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Run mv(1) with -f unless -i is given.

------------------------------------------------------------------------
r785 | knu | 2002-03-27 06:24:29 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portupgrade

Fix wording.

------------------------------------------------------------------------
r784 | knu | 2002-03-27 06:19:16 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Update the descriptions about portsclean -L.

------------------------------------------------------------------------
r783 | knu | 2002-03-27 05:41:55 +0900 (Wed, 27 Mar 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Add another example for -B that runs 'cvs update' for the master
port(s) of a slave port, using 'ports_glob -M'.

Question by:	Ollivier Robert <roberto@FreeBSD.org>

------------------------------------------------------------------------
r782 | knu | 2002-03-27 05:36:06 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix portsclean -L invocation.

------------------------------------------------------------------------
r781 | knu | 2002-03-27 05:20:48 +0900 (Wed, 27 Mar 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Mention that portupgrade(1) now runs `portsclean -L' at the end of
each upgrade.

------------------------------------------------------------------------
r780 | knu | 2002-03-27 05:16:10 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

s/pkgdb/portsclean/

------------------------------------------------------------------------
r779 | knu | 2002-03-27 03:03:37 +0900 (Wed, 27 Mar 2002) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not make (dist)clean and build in one invocation of make(1).  The
latest change over bsd.port.mk broke it.

------------------------------------------------------------------------
r778 | knu | 2002-03-27 00:19:29 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Call portsclean -L at the end of each upgrade.

------------------------------------------------------------------------
r777 | knu | 2002-03-27 00:18:52 +0900 (Wed, 27 Mar 2002) | 3 lines
Changed paths:
   M /trunk/bin/portsclean

Improve -L/--libclean.  Ability to delete duplicate libraries is
added.

------------------------------------------------------------------------
r776 | knu | 2002-03-27 00:16:47 +0900 (Wed, 27 Mar 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Add portsclean to the command path list.

------------------------------------------------------------------------
r775 | knu | 2002-03-21 20:31:53 +0900 (Thu, 21 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/misc/zsh/_pkgtools

Update the description for -P.

------------------------------------------------------------------------
r774 | knu | 2002-03-21 20:30:54 +0900 (Thu, 21 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1

Update the manpage to reflect the last changes.

------------------------------------------------------------------------
r773 | knu | 2002-03-21 20:13:38 +0900 (Thu, 21 Mar 2002) | 8 lines
Changed paths:
   M /trunk/bin/pkg_glob

pkg_deinstall: Show the results more precisely.

pkg_deinstall: Only preserve real FreeBSD shared libraries,
determined by file(1).

pkg_deinstall: Move preserved shared libraries to
$LOCALBASE/lib/compat/pkg.

------------------------------------------------------------------------
r772 | knu | 2002-03-21 04:26:12 +0900 (Thu, 21 Mar 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

It's faster to do uniq first and then sort than doing sort first and
then uniq.

------------------------------------------------------------------------
r771 | knu | 2002-03-20 03:12:29 +0900 (Wed, 20 Mar 2002) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade

If an error is returned from getcwd(), show a better message and abort.

FreeBSD PR:	ports/35893
Submitted by:	Ernst de Haan <znerd@FreeBSD.org>

-N: If multiple ports match a given pattern, list them.

Suggested by:	Will Andrews <will@FreeBSD.org>

------------------------------------------------------------------------
r770 | knu | 2002-03-20 03:02:39 +0900 (Wed, 20 Mar 2002) | 2 lines
Changed paths:
   M /trunk/lib/Makefile

Oops, forgot to commit this.  Reflect the tsort.rb -> pkgtsort.rb rename.

------------------------------------------------------------------------
r769 | knu | 2002-03-13 05:52:18 +0900 (Wed, 13 Mar 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   A /trunk/lib/pkgtsort.rb
   D /trunk/lib/tsort.rb
   A /trunk/tests/test_pkgtsort.rb
   D /trunk/tests/test_tsort.rb

Rename tsort.rb to pkgtsort.rb to avoid conflict with tsort.rb
included in ruby 1.7.

------------------------------------------------------------------------
r768 | knu | 2002-03-13 05:14:29 +0900 (Wed, 13 Mar 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Unbreak PortsDB#masters. (broken when exist?() was changed)

------------------------------------------------------------------------
r767 | knu | 2002-03-06 05:24:18 +0900 (Wed, 06 Mar 2002) | 8 lines
Changed paths:
   M /trunk/lib/portsdb.rb

- Check the file/directory permissions on the INDEX file before
  generating a new INDEX.

Suggested by:	parv <parv_@yahoo.com>

- Make automatic portsdb directory selection in the case of "portsdb
  -fu" too.

------------------------------------------------------------------------
r766 | knu | 2002-03-06 05:21:12 +0900 (Wed, 06 Mar 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsdb

On exception, handle it and exit normally.

------------------------------------------------------------------------
r765 | knu | 2002-02-27 06:25:51 +0900 (Wed, 27 Feb 2002) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Fix the EXTRA_CATEGORIES support that was broken in recent updates.

FreeBSD PR:	ports/35319
Submitted by:	Ryan Davis <ryand-bsd@zenspider.com>

------------------------------------------------------------------------
r764 | knu | 2002-02-27 06:23:20 +0900 (Wed, 27 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb

Add PortInfo#category which returns the port's primary category.

------------------------------------------------------------------------
r763 | knu | 2002-02-27 06:22:43 +0900 (Wed, 27 Feb 2002) | 3 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Add a note that a user must run portsdb -Ufu to reflect values of
EXTRA_CATEGORIES and IGNORE_CATEGORIES.

------------------------------------------------------------------------
r762 | knu | 2002-02-25 06:43:47 +0900 (Mon, 25 Feb 2002) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1

Document updates regarding portsdb.

------------------------------------------------------------------------
r761 | knu | 2002-02-25 05:32:02 +0900 (Mon, 25 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/misc/zsh/_pkgtools

Clarify that the combinations of -rO and -RO is disallowed.

------------------------------------------------------------------------
r760 | knu | 2002-02-25 04:33:24 +0900 (Mon, 25 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Remove INDEX.rbo on portsdb rebuild if it exists.

------------------------------------------------------------------------
r759 | knu | 2002-02-25 03:46:29 +0900 (Mon, 25 Feb 2002) | 9 lines
Changed paths:
   M /trunk/lib/portsdb.rb

- Merge INDEX.rbo into INDEX.db.

- Reduce the size of INDEX.db by half. :)

- Introduce PORTS_DBDRIVER and allow specifying a db driver for the
  portsdb (INDEX.db).

- Switch the default portsdb driver from db1.85 hash to db1.85 btree.

------------------------------------------------------------------------
r758 | knu | 2002-02-24 06:44:58 +0900 (Sun, 24 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Alter a message again.

------------------------------------------------------------------------
r757 | knu | 2002-02-21 14:18:13 +0900 (Thu, 21 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix a typo (replace overkill): abs_db_driver -> abs_db_dir.

------------------------------------------------------------------------
r756 | knu | 2002-02-21 00:16:56 +0900 (Thu, 21 Feb 2002) | 4 lines
Changed paths:
   M /trunk/misc/zsh/_pkgtools

Fix the portinstall (portupgrade -N) completion.

Submitted by:	Olivier Roux <skoot@club-internet.fr>

------------------------------------------------------------------------
r755 | knu | 2002-02-20 14:09:10 +0900 (Wed, 20 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Adjust a message.

------------------------------------------------------------------------
r754 | knu | 2002-02-20 14:07:15 +0900 (Wed, 20 Feb 2002) | 3 lines
Changed paths:
   M /trunk/lib/portinfo.rb

PortsDB::PORTS_DIR is obsoleted; use PortsDB.instance.ports_dir
instead.

------------------------------------------------------------------------
r753 | knu | 2002-02-20 05:33:10 +0900 (Wed, 20 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix a typo: bdb_btree -> bdb1_btree.

------------------------------------------------------------------------
r752 | knu | 2002-02-20 05:30:25 +0900 (Wed, 20 Feb 2002) | 7 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

- Show the db driver (format) on updating/rebuilding.

- Support db driver fallback. (bdb -> bdb1 -> dbm)

- Try bdb1_btree (db 1.85 btree) by default, and if it fails, use dbm
  (db 1.85 hash).

------------------------------------------------------------------------
r751 | knu | 2002-02-20 04:02:12 +0900 (Wed, 20 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Put a space after '[... rebuild needed]'.

------------------------------------------------------------------------
r750 | knu | 2002-02-20 03:30:40 +0900 (Wed, 20 Feb 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/portsdb.rb

Reflect environment variables defined in pkgtools.conf properly.
(Now ENV['PORTS_DBDIR'] is reflected properly)

Reported by:	Mori Kouji <mori@tri.asanuma.co.jp>

------------------------------------------------------------------------
r749 | knu | 2002-02-18 13:59:13 +0900 (Mon, 18 Feb 2002) | 6 lines
Changed paths:
   M /trunk/bin/pkg_sort
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb

Sort packages by build-time dependencies in addition to run-time
dependencies.  This slightly slows sorting down but offers faultless
upgrading.

Inspired by:	ade@FreeBSD.org

------------------------------------------------------------------------
r748 | knu | 2002-02-18 11:18:47 +0900 (Mon, 18 Feb 2002) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgtools

Add the completion definition for portcvsweb(1).

------------------------------------------------------------------------
r747 | knu | 2002-02-18 10:34:31 +0900 (Mon, 18 Feb 2002) | 6 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/bin/portcvsweb.1

Accept a pkgname_glob, a portorigin_glob, and a cvs module alias.

Suppress ident(1)'s error message.

Add -h, -q and -v.

------------------------------------------------------------------------
r746 | knu | 2002-02-15 00:18:00 +0900 (Fri, 15 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb

Remove a debug print.

------------------------------------------------------------------------
r745 | knu | 2002-02-13 20:00:31 +0900 (Wed, 13 Feb 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix a silly bug where PKG_DBDRIVER got always regarded as bdb_btree.

Pointed out by:	many people ;)

------------------------------------------------------------------------
r744 | knu | 2002-02-13 12:39:39 +0900 (Wed, 13 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Allow specifying ENV['PKG_DBDRIVER'] in pkgtools.conf.

------------------------------------------------------------------------
r743 | knu | 2002-02-13 11:00:50 +0900 (Wed, 13 Feb 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portupgrade.1

Add a BUGS entry to note that a user must run pkgdb -fu to rebuild a
corrupt pkgdb.

------------------------------------------------------------------------
r742 | knu | 2002-02-13 10:34:21 +0900 (Wed, 13 Feb 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Add a knob PKG_DBDRIVER={dbm,bdb1_hash,bdb1_btree,bdb_hash,bdb_btree}
to specify an alternative binary database format for pkgdb.

------------------------------------------------------------------------
r741 | knu | 2002-02-13 10:32:17 +0900 (Wed, 13 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Set the default answer to no when a score is under 80%.

------------------------------------------------------------------------
r740 | knu | 2002-02-13 10:20:48 +0900 (Wed, 13 Feb 2002) | 4 lines
Changed paths:
   M /trunk/bin/portcvsweb

Cosmetic.

Use RUBY_PLATFORM instead of calling uname(1).

------------------------------------------------------------------------
r739 | knu | 2002-02-13 07:29:05 +0900 (Wed, 13 Feb 2002) | 6 lines
Changed paths:
   M /trunk/bin/portcvsweb

Invoke browsers with system() instead of exec() so that it will
properly try every browser in turn - exec('/bin/sh', '-c', '..')
may cause an error within /bin/sh but it never returns.

Reported by:	Jimmy Olgeni <olgeni@FreeBSD.org>

------------------------------------------------------------------------
r738 | knu | 2002-02-09 13:30:04 +0900 (Sat, 09 Feb 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Work around a possible bug of the dbm module and keep a pkgdb
from getting insane and rebuilt.  Still under investigation,
but maybe it's time to move to bdb3.x for stability, reliability
and performance...

------------------------------------------------------------------------
r737 | knu | 2002-02-06 21:30:52 +0900 (Wed, 06 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Make portsclean -D remove empty directories as well.

------------------------------------------------------------------------
r736 | knu | 2002-02-04 23:33:51 +0900 (Mon, 04 Feb 2002) | 4 lines
Changed paths:
   M /trunk/Makefile

Clean up make targets.

Switch from .tar.gz to .tar.bzip2.

------------------------------------------------------------------------
r735 | knu | 2002-02-04 23:16:12 +0900 (Mon, 04 Feb 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkgtools.rb

Finally remove unavailable?() checks and always use the pkgdb.

Implement deorigin_glob() and get the unofficial ports' origin glob
expansion to really work.

------------------------------------------------------------------------
r734 | knu | 2002-02-04 22:24:16 +0900 (Mon, 04 Feb 2002) | 3 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkg_sort.1
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1

Change --no-config to --noconfig in order to get the -q option
working.  Since --no-* is a negative form it didn't work as expected.

------------------------------------------------------------------------
r733 | knu | 2002-02-04 20:58:25 +0900 (Mon, 04 Feb 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb

Greatly improve the origin fixing procedure.

Now one can view the CVS history online via the CVSweb!

------------------------------------------------------------------------
r732 | knu | 2002-02-04 20:56:32 +0900 (Mon, 04 Feb 2002) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Allow specifying unofficial ports' origin globs in HOLD_PKGS as well
as package globs.

------------------------------------------------------------------------
r731 | knu | 2002-02-04 20:55:17 +0900 (Mon, 04 Feb 2002) | 9 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

- Make PkgDB#deorigin() expand simple globs.

- Abolish the following message:
	[You have no permission to update the pkgdb -- using a slow method]

  Instead, do either of these: run 'pkgdb -u' via sudo(8) when under
  portupgrade -s, or stop the process immediately with a message that
  the user must run the command as root.

------------------------------------------------------------------------
r730 | knu | 2002-02-04 20:43:39 +0900 (Mon, 04 Feb 2002) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb

Add PortInfo::match?.

------------------------------------------------------------------------
r729 | knu | 2002-02-04 20:43:00 +0900 (Mon, 04 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_sort
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/lib/tsort.rb

Silence the build-time warnings.

------------------------------------------------------------------------
r728 | knu | 2002-02-04 18:45:34 +0900 (Mon, 04 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb.1

Synchronize with the reality.

------------------------------------------------------------------------
r727 | knu | 2002-02-04 18:41:18 +0900 (Mon, 04 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb

Change the default BROWSER value to 'w3m:lynx:links:mozilla:netscape'.

------------------------------------------------------------------------
r726 | knu | 2002-02-04 18:18:11 +0900 (Mon, 04 Feb 2002) | 5 lines
Changed paths:
   M /trunk/bin/pkgdb

Do the origin duplicateness check before checking dependencies and
avoid redoing the origin check.

Inspired by:	KONDOU, Kazuhiro <kazuhiro@alib.jp>

------------------------------------------------------------------------
r725 | knu | 2002-02-01 17:30:50 +0900 (Fri, 01 Feb 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/misc/zsh/_pkgtools

Reword: obsolete package tarballs -> outdated ...

------------------------------------------------------------------------
r724 | knu | 2002-02-01 16:32:06 +0900 (Fri, 01 Feb 2002) | 3 lines
Changed paths:
   M /trunk/misc/zsh/Makefile
   D /trunk/misc/zsh/_pkg_deinstall
   D /trunk/misc/zsh/_pkg_fetch
   D /trunk/misc/zsh/_pkg_glob
   D /trunk/misc/zsh/_pkg_sort
   D /trunk/misc/zsh/_pkgdb
   A /trunk/misc/zsh/_pkgtools
   D /trunk/misc/zsh/_portsclean
   D /trunk/misc/zsh/_portsdb
   D /trunk/misc/zsh/_portupgrade
   D /trunk/misc/zsh/_portversion

Integrate the zsh compdefs into _pkgtools, and fix some bugs and wrong
descriptions.

------------------------------------------------------------------------
r723 | knu | 2002-01-29 17:46:15 +0900 (Tue, 29 Jan 2002) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a bug where portupgrade tried to use a package with a different
origin when the package name is identical to that of what it wants
except for the version part.

------------------------------------------------------------------------
r722 | knu | 2002-01-29 17:42:30 +0900 (Tue, 29 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Properly print a legend.

------------------------------------------------------------------------
r721 | knu | 2002-01-29 12:42:36 +0900 (Tue, 29 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portsdb

Do not print an empty line when the result list is empty.

------------------------------------------------------------------------
r720 | knu | 2002-01-29 01:14:14 +0900 (Tue, 29 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb

Accept possibly removed ports. ("portcvsweb net/ruby-uri" now works)

------------------------------------------------------------------------
r719 | knu | 2002-01-28 08:00:46 +0900 (Mon, 28 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Strip -c/-o's argument of PKG_DBDIR and a trailing slash.

------------------------------------------------------------------------
r718 | knu | 2002-01-28 07:53:51 +0900 (Mon, 28 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Show the reason for rebuilding a package database.

------------------------------------------------------------------------
r717 | knu | 2002-01-28 07:43:43 +0900 (Mon, 28 Jan 2002) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/tcsh/complete.sample
   M /trunk/misc/zsh/_pkg_deinstall

Synchronize definitions with the commands.

------------------------------------------------------------------------
r716 | knu | 2002-01-28 06:55:10 +0900 (Mon, 28 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Oops, sort new_pkgs in the right place.

------------------------------------------------------------------------
r715 | knu | 2002-01-28 06:39:45 +0900 (Mon, 28 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Change ary[-1] to ary.last for readability.

------------------------------------------------------------------------
r714 | knu | 2002-01-28 06:39:13 +0900 (Mon, 28 Jan 2002) | 7 lines
Changed paths:
   M /trunk/bin/pkgdb

Make pkg_which(1) capable of showing multiple file owners.

Make pkgdb(1) -F provide a user an option to unregister stale
packages, in addition to deinstalling them.

Reword: 'remove a package record' -> 'unregister a package', etc. .

------------------------------------------------------------------------
r713 | knu | 2002-01-28 06:33:38 +0900 (Mon, 28 Jan 2002) | 5 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob

Add a new option to pkg_deinstall(1):
    -c, --collate          Check if any of the installed files of each package
                           have been overwritten by other packages, and do not
                           deinstall if any

------------------------------------------------------------------------
r712 | knu | 2002-01-28 04:14:45 +0900 (Mon, 28 Jan 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkginfo.rb

Make new() accept a non-string value.

Make match?() return true when true, instead of other values.  This
should satisfy the new RubyUnit's assert().

------------------------------------------------------------------------
r711 | knu | 2002-01-27 09:01:37 +0900 (Sun, 27 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Update the usage.

------------------------------------------------------------------------
r710 | knu | 2002-01-27 09:00:38 +0900 (Sun, 27 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Record and handle files that are installed by multiple packages.

------------------------------------------------------------------------
r709 | knu | 2002-01-27 08:57:36 +0900 (Sun, 27 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/Makefile
   M /trunk/lib/Makefile

Perform a syntax check on build for each ruby source file.

------------------------------------------------------------------------
r708 | knu | 2002-01-27 07:27:47 +0900 (Sun, 27 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Fix the output format.

------------------------------------------------------------------------
r707 | knu | 2002-01-27 07:12:10 +0900 (Sun, 27 Jan 2002) | 7 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgdb

Add a new option to pkg_which(1):
  -c/--collate PKGNAME
    Show files installed by the given packge that have been
    overwritten by other packages.

Be less verbose unless -v is given.

------------------------------------------------------------------------
r706 | knu | 2002-01-27 07:01:28 +0900 (Sun, 27 Jan 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Sort packages by the installed date before storing installed files.

Bump the DB version.

------------------------------------------------------------------------
r705 | knu | 2002-01-27 06:59:00 +0900 (Sun, 27 Jan 2002) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb

Squeeze series of slashes seen in 'pkg_info -L' output.

------------------------------------------------------------------------
r704 | knu | 2002-01-26 04:42:37 +0900 (Sat, 26 Jan 2002) | 5 lines
Changed paths:
   M /trunk/bin/pkgdb

When pkgdb(1) finds a package with a non-existent or missing origin
which is not required by any other package, ask the user if the
package should be deinstalled.  This will help users delete obsoleted
packages.

------------------------------------------------------------------------
r703 | knu | 2002-01-26 04:14:18 +0900 (Sat, 26 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch.1

D'oh!  I mean PKG_SITES here instead of PKG_PATH!

------------------------------------------------------------------------
r702 | knu | 2002-01-22 17:05:05 +0900 (Tue, 22 Jan 2002) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.sh

Support start/stop/restart.

------------------------------------------------------------------------
r701 | knu | 2002-01-22 15:45:20 +0900 (Tue, 22 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

Do not exit in subtask routines, but just return to main().

------------------------------------------------------------------------
r700 | knu | 2002-01-17 02:49:34 +0900 (Thu, 17 Jan 2002) | 6 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not skip a package because one of its requisites is skipped.
(Sigh, I did the same mistake before.)

FreeBSD PR:	ports/33946
Submitted by:	Vivek Khera <khera@kcilink.com>

------------------------------------------------------------------------
r699 | knu | 2002-01-16 19:25:29 +0900 (Wed, 16 Jan 2002) | 2 lines
Changed paths:
   M /trunk/misc/bash/Makefile
   M /trunk/misc/tcsh/Makefile
   M /trunk/misc/zsh/Makefile

Create FILESDIR before installing files into it.

------------------------------------------------------------------------
r698 | knu | 2002-01-16 18:22:31 +0900 (Wed, 16 Jan 2002) | 4 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb

Distinguish "ignored" from "skipped", and only report ignored packages
when -v/--verbose is specified. (This reduces loads of "No need to
upgrade ..." messages that you see when you run portupgrade -a, etc.)

------------------------------------------------------------------------
r697 | knu | 2002-01-16 15:34:28 +0900 (Wed, 16 Jan 2002) | 6 lines
Changed paths:
   M /trunk/Makefile.compat
   M /trunk/etc/Makefile
   M /trunk/lib/Makefile
   M /trunk/misc/bash/Makefile
   M /trunk/misc/tcsh/Makefile
   M /trunk/misc/zsh/Makefile

Embrace the bsd.*.mk changes in CURRENT and stop files from getting
installed into /.

Problem noted by:	Brooks Davis <brooks@FreeBSD.org>,
			Anders Andersson <anders@hack.org>

------------------------------------------------------------------------
r696 | knu | 2002-01-16 05:04:17 +0900 (Wed, 16 Jan 2002) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Fix my English.

When a sanity check fails, suggest specifying -O as the alternative to
running pkgdb -F.

------------------------------------------------------------------------
r695 | knu | 2002-01-16 04:58:23 +0900 (Wed, 16 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1

Fix my English.

------------------------------------------------------------------------
r694 | knu | 2002-01-16 04:34:17 +0900 (Wed, 16 Jan 2002) | 2 lines
Changed paths:
   M /trunk/Makefile

Make REL_DATE overridable.

------------------------------------------------------------------------
r693 | knu | 2002-01-15 13:04:00 +0900 (Tue, 15 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

-C/--workclean: Support the case where the ports directory is a symlink.

------------------------------------------------------------------------
r692 | knu | 2002-01-11 04:42:34 +0900 (Fri, 11 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Slightly fix some messages.

------------------------------------------------------------------------
r691 | knu | 2002-01-04 08:01:58 +0900 (Fri, 04 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Alter the "skip" message for originless packages.

------------------------------------------------------------------------
r690 | knu | 2002-01-03 23:30:45 +0900 (Thu, 03 Jan 2002) | 4 lines
Changed paths:
   M /trunk/bin/portversion.1

Apply English grammar fixes.

Submitted by:	David Bogen <db@bogen.org>

------------------------------------------------------------------------
r689 | knu | 2002-01-03 23:22:07 +0900 (Thu, 03 Jan 2002) | 4 lines
Changed paths:
   M /trunk/bin/portsclean.1

Apply English grammar fixes.

Submitted by:	David Bogen <db@bogen.org>

------------------------------------------------------------------------
r688 | knu | 2002-01-03 22:57:41 +0900 (Thu, 03 Jan 2002) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

pkg_site_* is now under the PkgConfig module.

Reported by:	roberto@FreeBSD.org

------------------------------------------------------------------------
r687 | knu | 2002-01-03 08:39:40 +0900 (Thu, 03 Jan 2002) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

A Happy New Year, 2002! (Copyright notice updated)

------------------------------------------------------------------------
r686 | knu | 2002-01-03 08:35:27 +0900 (Thu, 03 Jan 2002) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

You must be informed of an origin before using it.

Submitted by:	jan grant <jan.grant@bristol.ac.uk>
FreeBSD PR:	ports/33478

------------------------------------------------------------------------
r685 | knu | 2002-01-03 08:21:38 +0900 (Thu, 03 Jan 2002) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Apply English grammar fixes.

Submitted by:	David Bogen <db@bogen.org>

------------------------------------------------------------------------
r684 | knu | 2001-12-31 07:17:19 +0900 (Mon, 31 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Add some progress messages.

------------------------------------------------------------------------
r683 | knu | 2001-12-31 07:09:24 +0900 (Mon, 31 Dec 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

- Introduce new configuration variables: BEFOREBUILD and AFTERINSTALL.
  [Requested by: Gabriel Ambuehl <gabriel_ambuehl@buz.ch>]

------------------------------------------------------------------------
r682 | knu | 2001-12-31 07:09:08 +0900 (Mon, 31 Dec 2001) | 6 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

- Introduce new configuration variables: BEFOREBUILD and AFTERINSTALL.
  [Requested by: Gabriel Ambuehl <gabriel_ambuehl@buz.ch>]

- New utility functions localbase() and x11base() are now available in
  pkgtools.conf.

------------------------------------------------------------------------
r681 | knu | 2001-12-31 07:08:21 +0900 (Mon, 31 Dec 2001) | 7 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

- Introduce new configuration variables: BEFOREBUILD and AFTERINSTALL.
  [Requested by: Gabriel Ambuehl <gabriel_ambuehl@buz.ch>]

- Always run afterinstall commands as root.

- Show beforebuild/afterinstall commands to run.

------------------------------------------------------------------------
r680 | knu | 2001-12-31 03:54:18 +0900 (Mon, 31 Dec 2001) | 7 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

- Do not call stty(1) if stdin is not a terminal.

- Provide localbase() and x11base() for pkgtools.conf.

- Put all the utility functions for pkgtools.conf under the PkgConfig
module.

------------------------------------------------------------------------
r679 | knu | 2001-12-30 23:40:49 +0900 (Sun, 30 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

There is no need to restore +REQUIRED_BY that's empty.

------------------------------------------------------------------------
r678 | knu | 2001-12-30 23:40:07 +0900 (Sun, 30 Dec 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Perl 5.00503 doesn't understand /[[:space:]]/.  Change it back to /\s/.

------------------------------------------------------------------------
r677 | knu | 2001-12-26 16:46:42 +0900 (Wed, 26 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob

There is no need to restore a nonexistent file.

------------------------------------------------------------------------
r676 | knu | 2001-12-18 00:41:59 +0900 (Tue, 18 Dec 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Properly quote @ and % in regexp for Perl.

------------------------------------------------------------------------
r675 | knu | 2001-12-18 00:31:24 +0900 (Tue, 18 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Speed up file operations.

------------------------------------------------------------------------
r674 | knu | 2001-12-18 00:03:06 +0900 (Tue, 18 Dec 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_glob

Change [[:digit:]] back to \d, since Perl 5.005* doesn't support the
former.

------------------------------------------------------------------------
r673 | knu | 2001-12-18 00:01:29 +0900 (Tue, 18 Dec 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Use perl(1) instead of sed(1). :P

------------------------------------------------------------------------
r672 | knu | 2001-12-17 00:03:50 +0900 (Mon, 17 Dec 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

subst_file*(): Do not return nil when no lines are changed, but return
an empty array instead.

------------------------------------------------------------------------
r671 | knu | 2001-12-16 09:59:54 +0900 (Sun, 16 Dec 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Use `[[:space:]]' instead of `\s' for sed(1).

Do not let subst_file fail when a file does not exist.

------------------------------------------------------------------------
r670 | knu | 2001-12-16 09:37:17 +0900 (Sun, 16 Dec 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/lib/pkgtools.rb

sed(1) doesn't grok the regexp `\d', so call sed(1) with -E and use
`[[:digit:]]' instead.

------------------------------------------------------------------------
r669 | knu | 2001-12-16 08:41:07 +0900 (Sun, 16 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/lib/pkgtools.rb

Change "io.print lines" to "io.print *lines" for the recent Ruby 1.7.

------------------------------------------------------------------------
r668 | knu | 2001-12-16 08:21:12 +0900 (Sun, 16 Dec 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Speed up string substitution against a big file.

------------------------------------------------------------------------
r667 | knu | 2001-12-16 06:25:10 +0900 (Sun, 16 Dec 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb

Ignore any empty lines in +REQUIRED_BY.

Speed up reading though +CONTENTS.

------------------------------------------------------------------------
r666 | knu | 2001-12-16 06:02:50 +0900 (Sun, 16 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_sort

Make pkg_sort(1) actually work.

------------------------------------------------------------------------
r665 | knu | 2001-12-14 20:41:16 +0900 (Fri, 14 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Add a note that ^Z doesn't work to the BUGS section.

------------------------------------------------------------------------
r664 | knu | 2001-12-14 02:05:34 +0900 (Fri, 14 Dec 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix a bug where the port that's built first is built with wrong make
arguments.
[Reported by: Ollivier Robert <roberto@eurocontrol.fr>]

------------------------------------------------------------------------
r663 | knu | 2001-12-13 15:03:02 +0900 (Thu, 13 Dec 2001) | 4 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Fix a typo in comment.

Submitted by:	Gregory Neil Shapiro <gshapiro@gshapiro.net>

------------------------------------------------------------------------
r662 | knu | 2001-12-11 22:11:30 +0900 (Tue, 11 Dec 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Do not invoke sudo if a command is already run as root.

Suggested by:	Will Andrews <will@csociety.org>

------------------------------------------------------------------------
r661 | knu | 2001-12-11 22:10:39 +0900 (Tue, 11 Dec 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Partly back out the previous overkill changes; I made it too verbose
by default.

------------------------------------------------------------------------
r660 | knu | 2001-12-11 02:34:55 +0900 (Tue, 11 Dec 2001) | 5 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/portupgrade

Make these commands more verbose even if -v/--verbose is not given, so
that one can see what is going on.

Requested by:	 Alfred Perlstein <bright@mu.org>

------------------------------------------------------------------------
r659 | knu | 2001-12-11 02:34:17 +0900 (Tue, 11 Dec 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

show_results: accept a verbose flag as the third argument.

------------------------------------------------------------------------
r658 | knu | 2001-12-10 11:11:31 +0900 (Mon, 10 Dec 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/tcsh/complete.sample
   M /trunk/misc/zsh/Makefile
   A /trunk/misc/zsh/_pkg_tarup

Add shell compdefs for pkg_tarup(1).

------------------------------------------------------------------------
r657 | knu | 2001-12-10 10:35:07 +0900 (Mon, 10 Dec 2001) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Make -p/--package build packages for those which requisite packages
are upgraded as well, when they are given from the command line or -r
is specified.

Requested by:	Vivek Khera <khera@kcilink.com>,
		Lev Serebryakov <lev@serebryakov.spb.ru>

Remove a redundant message.

------------------------------------------------------------------------
r656 | knu | 2001-12-10 05:30:47 +0900 (Mon, 10 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/etc/pkgtools.conf

Properly quote the fetch command line arguments.

------------------------------------------------------------------------
r655 | knu | 2001-12-10 05:09:51 +0900 (Mon, 10 Dec 2001) | 2 lines
Changed paths:
   M /trunk/etc/Makefile
   A /trunk/etc/status-pkg.sh

Add status-pkg.sh, a replacement of the weekly status-pkg report script.

------------------------------------------------------------------------
r654 | knu | 2001-12-03 04:12:58 +0900 (Mon, 03 Dec 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not regard a packaging error as an installation error.

------------------------------------------------------------------------
r653 | knu | 2001-12-01 23:59:44 +0900 (Sat, 01 Dec 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

portinstall: Only upgrade required packages of a newly installed port
when -R is specified.

------------------------------------------------------------------------
r652 | knu | 2001-12-01 05:03:28 +0900 (Sat, 01 Dec 2001) | 5 lines
Changed paths:
   M /trunk/bin/pkg_fetch

Dig the temporary directory and the packages directory before
fetching.

Requested by:	Chris Dillon <cdillon@wolves.k12.mo.us>

------------------------------------------------------------------------
r651 | knu | 2001-11-30 12:36:04 +0900 (Fri, 30 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade.1

Fix a couple of typos.

Submitted by:	Dan Langille <dan@langille.org>

------------------------------------------------------------------------
r650 | knu | 2001-11-29 02:04:16 +0900 (Thu, 29 Nov 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

When -p is specified, build packages for ports that are installed as
dependency as well.

Requested by:	Vivek Khera <khera@kcilink.com>

------------------------------------------------------------------------
r649 | knu | 2001-11-27 19:22:25 +0900 (Tue, 27 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Turn HOLD_PORTS into HOLD_PKGS, and make -Nf properly override it.

Suggest specifying -f when skipping.

------------------------------------------------------------------------
r648 | knu | 2001-11-27 19:20:06 +0900 (Tue, 27 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Fix overkill.

------------------------------------------------------------------------
r647 | knu | 2001-11-27 19:15:40 +0900 (Tue, 27 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion

Support HOLD_PKGS.

------------------------------------------------------------------------
r646 | knu | 2001-11-27 19:13:59 +0900 (Tue, 27 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1

Support HOLD_PKGS and make -f/--force overrite the setting.

------------------------------------------------------------------------
r645 | knu | 2001-11-27 19:03:16 +0900 (Tue, 27 Nov 2001) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Turn HOLD_PORTS into HOLD_PKGS.

List `bsdpan-*' by default.
Requested by:	Anton Berezin <tobez@tobez.org>

------------------------------------------------------------------------
r644 | knu | 2001-11-27 18:50:43 +0900 (Tue, 27 Nov 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

- Turn HOLD_PORTS into HOLD_PKGS.

- Intoduce lazy initialization for config variables.

------------------------------------------------------------------------
r643 | knu | 2001-11-26 06:44:54 +0900 (Mon, 26 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix unneeded escapes in guess_reason().

------------------------------------------------------------------------
r642 | knu | 2001-11-23 18:50:31 +0900 (Fri, 23 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb.1

Fix commas in the SEE ALSO section.

Submitted by:	kuriyama@FreeBSD.org

------------------------------------------------------------------------
r641 | knu | 2001-11-22 17:44:25 +0900 (Thu, 22 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a bug that -Pf did not properly work.

Reported by:	The Anarcat <anarcat@anarcat.dyndns.org>

------------------------------------------------------------------------
r640 | knu | 2001-11-18 04:36:17 +0900 (Sun, 18 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean

pkgclean(): Oops, fix symlink cleaning.

------------------------------------------------------------------------
r639 | knu | 2001-11-17 06:10:07 +0900 (Sat, 17 Nov 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb

Deprecate the use of PKGREPOSITORY and PKGREPOSITORYSUBDIR.  Use
PACKAGES for PKGREPOSITORY and hardcode 'All'.

------------------------------------------------------------------------
r638 | knu | 2001-11-17 03:23:24 +0900 (Sat, 17 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1

pkgclean(): Clean dead symlinks as well.

------------------------------------------------------------------------
r637 | knu | 2001-11-17 03:21:06 +0900 (Sat, 17 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkgdb
   M /trunk/bin/portcvsweb
   M /trunk/bin/portsclean
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/portinfo.rb
   M /trunk/lib/portsdb.rb

Standardize: exists? -> exist?

------------------------------------------------------------------------
r636 | knu | 2001-11-16 03:55:06 +0900 (Fri, 16 Nov 2001) | 5 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob

Only preserve shared libraries with version numbers.  Keeping *.so
files may be harmful because it allows producing new binaries linked
with the libraries of removed packages.  It is just enough to only
preserve *.so.* files to retain compatibility.

------------------------------------------------------------------------
r635 | knu | 2001-11-16 03:09:37 +0900 (Fri, 16 Nov 2001) | 2 lines
Changed paths:
   A /trunk/etc/.cvsignore

Add .cvsignore.

------------------------------------------------------------------------
r634 | knu | 2001-11-16 01:59:40 +0900 (Fri, 16 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Improve the score computer.

------------------------------------------------------------------------
r633 | knu | 2001-11-16 01:29:12 +0900 (Fri, 16 Nov 2001) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb

Perform better checks on pkgname and origin.

------------------------------------------------------------------------
r632 | knu | 2001-11-12 23:07:34 +0900 (Mon, 12 Nov 2001) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Explain how to use EXTRA_CATEGORIES.

------------------------------------------------------------------------
r631 | knu | 2001-11-11 19:04:12 +0900 (Sun, 11 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkgdb
   M /trunk/bin/portsdb
   M /trunk/bin/portversion

Do not show help twice when -h/--help is given.

Reported by:	Masami Kobayashi <masami@tncc.jp>

------------------------------------------------------------------------
r630 | knu | 2001-11-11 03:55:43 +0900 (Sun, 11 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1

Supply missing words.

------------------------------------------------------------------------
r629 | knu | 2001-11-08 04:18:20 +0900 (Thu, 08 Nov 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade

Detect NO_LATEST_LINK and LATEST_LINK and use them to determine the
name of the latest package to fetch.

------------------------------------------------------------------------
r628 | knu | 2001-11-08 04:16:29 +0900 (Thu, 08 Nov 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Add each_category() and latest_link().

Add some comments.

------------------------------------------------------------------------
r627 | knu | 2001-11-07 16:37:07 +0900 (Wed, 07 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb

Fix a regexp problem when it meets a pkgname that ends with a `+'.

Reported by:	Albert Kinderman <albert.kinderman@csun.edu>

------------------------------------------------------------------------
r626 | knu | 2001-11-07 16:10:45 +0900 (Wed, 07 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_sort
   M /trunk/bin/pkgdb
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade

Get to properly work on Ruby 1.7. (puts array -> puts *array)

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r625 | knu | 2001-11-07 16:02:33 +0900 (Wed, 07 Nov 2001) | 2 lines
Changed paths:
   M /trunk/lib/tsort.rb

Fix tests.

------------------------------------------------------------------------
r624 | knu | 2001-11-06 22:45:20 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion

Fix the portversion -c output again.

------------------------------------------------------------------------
r623 | knu | 2001-11-06 18:27:31 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_sort

Oops, finish it.

------------------------------------------------------------------------
r622 | knu | 2001-11-06 18:24:14 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/Makefile
   A /trunk/misc/zsh/_pkg_sort

Add pkg_sort(1) completion definitions.

------------------------------------------------------------------------
r621 | knu | 2001-11-06 18:16:33 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1

Reword a bit and add pkg_sort(1) cross reference.

------------------------------------------------------------------------
r620 | knu | 2001-11-06 18:15:23 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob.1

Fix a markup.

------------------------------------------------------------------------
r619 | knu | 2001-11-06 18:13:27 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/Makefile

Add pkg_sort.

------------------------------------------------------------------------
r618 | knu | 2001-11-06 18:13:04 +0900 (Tue, 06 Nov 2001) | 6 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   A /trunk/bin/pkg_sort
   A /trunk/bin/pkg_sort.1

pkg_glob: Do not sort package names in dependency order but in
alphabetical order.

pkg_sort: A new command to sort lines of package names in dependency
order.

------------------------------------------------------------------------
r617 | knu | 2001-11-06 17:24:13 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Make the dependency guesser even more smart.

------------------------------------------------------------------------
r616 | knu | 2001-11-06 16:42:12 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob

If none matches given patterns, emit a warning and exit.

------------------------------------------------------------------------
r615 | knu | 2001-11-06 16:41:32 +0900 (Tue, 06 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Check for the pkgdb directory ownership before starting to fix it.

------------------------------------------------------------------------
r614 | knu | 2001-11-06 05:00:12 +0900 (Tue, 06 Nov 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb

Make the dependency guesser rather more intelligent and show a score
when suggesting a candidate to the user.

------------------------------------------------------------------------
r613 | knu | 2001-11-05 22:27:45 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_fetch
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_pkgdb
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion

Fix typos: PKGDBDIR -> PKG_DBDIR.

------------------------------------------------------------------------
r612 | knu | 2001-11-05 06:23:54 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Make sure to update ChangeLog before a release.

------------------------------------------------------------------------
r611 | knu | 2001-11-05 06:22:07 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix the logic of fetching packages.

------------------------------------------------------------------------
r610 | knu | 2001-11-05 05:25:59 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portcvsweb.1
   M /trunk/bin/portsclean.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1

Make massive rewording of manual pages.

------------------------------------------------------------------------
r609 | knu | 2001-11-05 05:25:19 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/README

Reword a bit more.

------------------------------------------------------------------------
r608 | knu | 2001-11-05 05:25:19 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/Makefile.inc

Define DOCSDIR.

------------------------------------------------------------------------
r607 | knu | 2001-11-05 05:25:19 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Add "install-doc" target.

------------------------------------------------------------------------
r606 | knu | 2001-11-05 04:47:59 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/README

Reword.

------------------------------------------------------------------------
r605 | knu | 2001-11-05 04:41:51 +0900 (Mon, 05 Nov 2001) | 2 lines
Changed paths:
   M /trunk/README

Update and reword a lot.

------------------------------------------------------------------------
r604 | knu | 2001-11-04 22:35:41 +0900 (Sun, 04 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Go fetch "Latest" packages only if -P is given twice.

------------------------------------------------------------------------
r603 | knu | 2001-11-04 21:21:36 +0900 (Sun, 04 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsclean.1

Fix the description of -D and -DD.

Pointed out by:	"Li-lun Wang (Leland Wang)" <llwang@infor.org>

------------------------------------------------------------------------
r602 | knu | 2001-11-04 05:47:56 +0900 (Sun, 04 Nov 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Make sure to pack and release the latest ChangeLog and tarball.

------------------------------------------------------------------------
r601 | knu | 2001-11-04 04:18:18 +0900 (Sun, 04 Nov 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix a bug where portupgrade fails in error if -f is given and it tries
to reinstall the same version of a package.

Reported by:	Yoshiaki Kasahara <kasahara@nc.kyushu-u.ac.jp>
FreeBSD PR:	31730

------------------------------------------------------------------------
r600 | knu | 2001-11-04 04:14:19 +0900 (Sun, 04 Nov 2001) | 5 lines
Changed paths:
   M /trunk/bin/portversion

Fix a bug where portversion reports results all reversed. ;(

Reported by:	Yoshiaki Kasahara <kasahara@nc.kyushu-u.ac.jp>
FreeBSD PR:	31731

------------------------------------------------------------------------
r599 | knu | 2001-11-03 19:20:07 +0900 (Sat, 03 Nov 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

Fix a problem where it fails to parse uname(1)'s output when it has a
release suffix; e.g. `4.4-STABLE-20011103-JPSNAP i386'.

Reported by:	Mark Russell <mark@mark.net.au>

------------------------------------------------------------------------
r598 | knu | 2001-11-03 04:47:17 +0900 (Sat, 03 Nov 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portcvsweb.1
   M /trunk/bin/portsclean.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1

Add more cross references and sort entries in the SEE ALSO section.

------------------------------------------------------------------------
r597 | knu | 2001-11-03 04:42:16 +0900 (Sat, 03 Nov 2001) | 2 lines
Changed paths:
   M /trunk/etc/Makefile
   A /trunk/etc/pkgtools.conf.5

Add a minimal manual page for pkgtools.conf(5).

------------------------------------------------------------------------
r596 | knu | 2001-11-02 23:51:46 +0900 (Fri, 02 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion

Fix a typo: errir -> error.

Reported by:	TOGAWA Satoshi <toga@puyo.org>

------------------------------------------------------------------------
r595 | knu | 2001-11-02 21:56:36 +0900 (Fri, 02 Nov 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade

Fix a recently caused problem where portupgrade raises an error during
detecting obsoleted dependencies.

Reported by:	Fritz Heinrichmeyer <jfh@jfh00.fernuni-hagen.de>

------------------------------------------------------------------------
r594 | knu | 2001-11-02 20:13:59 +0900 (Fri, 02 Nov 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Fix a typo. (REL_SUFFIX -> REL_MINOR)

------------------------------------------------------------------------
r593 | knu | 2001-11-02 19:38:04 +0900 (Fri, 02 Nov 2001) | 2 lines
Changed paths:
   M /trunk/etc/Makefile
   M /trunk/etc/pkgtools.sh

Properly replace PREFIX.

------------------------------------------------------------------------
r592 | knu | 2001-11-02 16:10:26 +0900 (Fri, 02 Nov 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion

Fix a typo and unbreak portversion -c/-v.

Reported by:	Masahide -mac- NODA <mac@clave.gr.jp>

------------------------------------------------------------------------
r591 | knu | 2001-11-01 05:31:31 +0900 (Thu, 01 Nov 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1

Properly remove obsoleted dependencies in an upgrade.  This reduces
pkgdb(1)'s turn.

------------------------------------------------------------------------
r590 | knu | 2001-11-01 05:20:42 +0900 (Thu, 01 Nov 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb

update_pkgdep: Return two lists; a list of pkgnames that +REQUIRED_BY
files are modified, and a list of pkgnames that +CONTENTS files are
modified.

subst_file: Return nil instead of [] if unmodified.

------------------------------------------------------------------------
r589 | knu | 2001-11-01 00:44:24 +0900 (Thu, 01 Nov 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb

Call make_describe_pass[12] with the full paths.

------------------------------------------------------------------------
r588 | knu | 2001-11-01 00:42:37 +0900 (Thu, 01 Nov 2001) | 6 lines
Changed paths:
   A /trunk/Makefile.compat
   M /trunk/bin/Makefile
   M /trunk/etc/Makefile
   M /trunk/lib/Makefile
   M /trunk/lib/pkgdb.rb

Improve the build process:
  - Adjust shebang lines of installed scripts.
  - Replace /usr/local in installed library files with ${PREFIX}.
  - Add Makefile.compat in order to support old systems which doesn't
    have the SCRIPTS framework.

------------------------------------------------------------------------
r587 | knu | 2001-11-01 00:37:41 +0900 (Thu, 01 Nov 2001) | 2 lines
Changed paths:
   A /trunk/.cvsignore
   A /trunk/bin/.cvsignore
   A /trunk/lib/.cvsignore

Add .cvsignore.

------------------------------------------------------------------------
r586 | knu | 2001-10-31 21:56:20 +0900 (Wed, 31 Oct 2001) | 13 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1

Inspect the origin port to get the latest version if a package's
origin is not found in the ports database.

Distinguish between `origin is not recorded' and `origin port is not
found'.  Now the flag `#' represents the former and the flag `?'
represents the latter.

Resurrect the flag `!', which means `port Makefile broken'.

Yes, the meanings of `#' and `!' have been reversed.  Because we would
hardly see ports missing origins any longer, I decided to assign `!'
to the one we see more often.

------------------------------------------------------------------------
r585 | knu | 2001-10-30 07:06:20 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade

Do not ask whether to install a port twice.

------------------------------------------------------------------------
r584 | knu | 2001-10-30 06:58:00 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb

Comment out deleted pkgdeps properly.

------------------------------------------------------------------------
r583 | knu | 2001-10-30 03:57:52 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/Makefile

Create script links properly.

------------------------------------------------------------------------
r582 | knu | 2001-10-30 03:44:49 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/Makefile

MANDIR must be set with = instead of ?=.

------------------------------------------------------------------------
r581 | knu | 2001-10-30 03:38:22 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Hide unneeded command lines.

------------------------------------------------------------------------
r580 | knu | 2001-10-30 03:33:08 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/Makefile.inc

Fix EXAMPLESDIR.

------------------------------------------------------------------------
r579 | knu | 2001-10-30 03:30:48 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/Makefile
   M /trunk/Makefile.inc
   A /trunk/misc/Makefile
   A /trunk/misc/Makefile.inc
   A /trunk/misc/bash/Makefile
   A /trunk/misc/tcsh/Makefile
   A /trunk/misc/zsh/Makefile

Install misc files too.

------------------------------------------------------------------------
r578 | knu | 2001-10-30 03:16:28 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   M /trunk/Makefile

Fix the load path for the tests.

------------------------------------------------------------------------
r577 | knu | 2001-10-30 03:03:43 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   A /trunk/Makefile
   A /trunk/Makefile.inc
   A /trunk/bin/Makefile
   A /trunk/etc/Makefile
   D /trunk/install.rb
   A /trunk/lib/Makefile
   D /trunk/runtest.sh

Convert install/test/release scripts to Makefile's.

------------------------------------------------------------------------
r576 | knu | 2001-10-30 01:08:56 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   D /trunk/000.pkgtools.sh

Move the startup script to etc/ with a repocopy.

------------------------------------------------------------------------
r575 | knu | 2001-10-30 01:08:19 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   D /trunk/make_describe_pass1
   D /trunk/make_describe_pass2
   D /trunk/pkg_deinstall.1
   D /trunk/pkg_fetch
   D /trunk/pkg_fetch.1
   D /trunk/pkg_glob
   D /trunk/pkg_glob.1
   D /trunk/pkgdb
   D /trunk/pkgdb.1
   D /trunk/portcvsweb
   D /trunk/portcvsweb.1
   D /trunk/portsclean
   D /trunk/portsclean.1
   D /trunk/portsdb
   D /trunk/portsdb.1
   D /trunk/portupgrade
   D /trunk/portupgrade.1
   D /trunk/portversion
   D /trunk/portversion.1

Move scripts and manpages to bin/ with a repocopy.

------------------------------------------------------------------------
r574 | knu | 2001-10-30 01:07:24 +0900 (Tue, 30 Oct 2001) | 2 lines
Changed paths:
   D /trunk/pkg.rb
   D /trunk/pkgdb.rb
   D /trunk/pkginfo.rb
   D /trunk/pkgmisc.rb
   D /trunk/pkgtools.rb
   D /trunk/pkgversion.rb
   D /trunk/portinfo.rb
   D /trunk/ports.rb
   D /trunk/portsdb.rb
   D /trunk/tsort.rb

Move library files to lib/ with a repocopy.

------------------------------------------------------------------------
r573 | knu | 2001-10-30 00:59:13 +0900 (Tue, 30 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix quotes.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r572 | knu | 2001-10-29 21:53:37 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Complete missing words.

------------------------------------------------------------------------
r571 | knu | 2001-10-29 17:12:43 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1
   M /trunk/portsclean.1

Add a new feature: -P/--pkgclean.

------------------------------------------------------------------------
r570 | knu | 2001-10-29 17:04:10 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_portsclean

Support portsclean -P/-PP.

------------------------------------------------------------------------
r569 | knu | 2001-10-29 17:02:08 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Add a new feature: -P/--pkgclean.

------------------------------------------------------------------------
r568 | knu | 2001-10-29 17:01:33 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/pkg_fetch

Update the usage.

------------------------------------------------------------------------
r567 | knu | 2001-10-29 06:38:16 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Improve the new installation (-N) procedure as well.

------------------------------------------------------------------------
r566 | knu | 2001-10-29 06:27:41 +0900 (Mon, 29 Oct 2001) | 27 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb
   M /trunk/pkg_fetch
   M /trunk/pkg_fetch.1
   M /trunk/pkgtools.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1

portupgrade: Greatly improve the procedure of binary upgrading (-P/-PP):
  When a fetched package is not of the latest version:
    1) If -PP is given and the package is at least newer than the current
       installation, put up with it and do an upgrade.
    2) If -PP is given and the package is now newer than the current
       installation, give up.
    3) Else, fall back to the port.

If a port/package matches multiple entries of MAKE_ARGS, join all the
arguments using the space as separator.

Introduce a new {environment,configuration} variable PKG_SITES to allow
specifying multiple package sites.

pkg_fetch: When a URI is given, check for the last path component and if it
is not "Latest" or "All", fetch the dependent ports from the same directory.
(-R)

pkg_fetch: Do not repeat same error messages.

pkg_fetch: Properly reflect the environment variables defined in pkgtools.conf.

pkg_deinstall: Add a timestamp hack as well as portupgrade to let the pkgdb
engine properly detect an update of PKG_DBDIR.

Discourage the use of PACKAGESITE.

------------------------------------------------------------------------
r565 | knu | 2001-10-29 05:58:15 +0900 (Mon, 29 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

When the user chooses to delete a dependency, comment it out instead of
deleting it.

------------------------------------------------------------------------
r564 | knu | 2001-10-29 00:09:45 +0900 (Mon, 29 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add some utility functions: pkg_site_{mirror,primary,builder}.

------------------------------------------------------------------------
r563 | knu | 2001-10-28 17:42:49 +0900 (Sun, 28 Oct 2001) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Allow using ports globs in HOLD_PORTS and MAKE_ARGS.

Prepare some useful constants to use in such as ENV['PACKAGESITE']:
OS_RELEASE, OS_REVISION, OS_MAJOR, OS_BRANCH, and OS_PLATFORM.

------------------------------------------------------------------------
r562 | knu | 2001-10-27 20:56:17 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Add a timestamp hack here as well as portupgrade.

------------------------------------------------------------------------
r561 | knu | 2001-10-27 04:09:16 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Oops, fix a stupid fat-fingered bug.

------------------------------------------------------------------------
r560 | knu | 2001-10-27 03:11:03 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Fix the incorrect descriptions regarding -P and -PP.

------------------------------------------------------------------------
r559 | knu | 2001-10-27 02:33:06 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Oops, it was too verbose.

------------------------------------------------------------------------
r558 | knu | 2001-10-27 02:25:46 +0900 (Sat, 27 Oct 2001) | 8 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add a delay between deinstallation and installation to let pkgdb
properly detect the update of PKG_DBDIR entries.

Since pkg_add(1) is mute, always show a progress message when invoking
it no matter whether -v is given or not.

Make -P really work.

------------------------------------------------------------------------
r557 | knu | 2001-10-27 02:21:36 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Simplify an assignment.

------------------------------------------------------------------------
r556 | knu | 2001-10-27 01:36:39 +0900 (Sat, 27 Oct 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

D'oh!!  Fix a stupid bug where portupgrade didn't modify dependencies
when upgrading a package.  The bug was exposed by the newly introduced
dependency sanity checks.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r555 | knu | 2001-10-27 01:27:19 +0900 (Sat, 27 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/lib/pkgdb.rb
   M /trunk/pkg_fetch
   M /trunk/pkgdb.rb

Standardize the @pkgdep regexp.

------------------------------------------------------------------------
r554 | knu | 2001-10-26 22:39:53 +0900 (Fri, 26 Oct 2001) | 11 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Make portupgrade download packages from a remote site if -P is
specified.  Now one can do binary upgrading in a handy way:

	portupgrade -P foo bar

Instead of:

	portupgrade -FP foo bar && portupgrade -PP foo bar

(Although the latter is friendlier to dialup users)

------------------------------------------------------------------------
r553 | knu | 2001-10-26 22:36:23 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Add examples for PKG_FETCH, PACKAGEROOT and PACKAGESITE.

------------------------------------------------------------------------
r552 | knu | 2001-10-26 05:29:22 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Explain -F better.

------------------------------------------------------------------------
r551 | knu | 2001-10-26 05:13:58 +0900 (Fri, 26 Oct 2001) | 5 lines
Changed paths:
   M /trunk/etc/pkgtools.conf
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Introduce new configuration variables: IGNORE_CATEGORIES and
EXTRA_CATEGORIES.

Enhance the configuration examples and descriptions.

------------------------------------------------------------------------
r550 | knu | 2001-10-26 05:12:07 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Introduce ignore_categories and extra_categories.

------------------------------------------------------------------------
r549 | knu | 2001-10-26 05:08:53 +0900 (Fri, 26 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Recommend setting PORTS_INDEX to something other than the default
value.

------------------------------------------------------------------------
r548 | knu | 2001-10-26 02:44:02 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/etc/pkgtools.conf

Now one can set environment variables in pkgtools.conf.

------------------------------------------------------------------------
r547 | knu | 2001-10-26 02:33:04 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkg_fetch
   M /trunk/misc/zsh/_pkgdb
   M /trunk/misc/zsh/_portsclean
   M /trunk/misc/zsh/_portsdb

Add the -q option.

------------------------------------------------------------------------
r546 | knu | 2001-10-26 02:31:27 +0900 (Fri, 26 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsclean.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_fetch.1
   M /trunk/pkg_glob.1
   M /trunk/pkgdb.1
   M /trunk/portsclean.1
   M /trunk/portsdb.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Mention the -q/--no-config option, the $PREFIX/etc/pkgtools.conf file,
the PKGTOOLS_CONF variable, fix widths, et al.

------------------------------------------------------------------------
r545 | knu | 2001-10-26 02:19:55 +0900 (Fri, 26 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/portsdb.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Clarify the explanation about dependency.

Submitted by:	Jos Backus <josb@cncdsl.com> (Thanks a lot!)

------------------------------------------------------------------------
r544 | knu | 2001-10-26 02:13:16 +0900 (Fri, 26 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkgdb
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkg_fetch
   M /trunk/pkg_glob
   M /trunk/pkgdb
   M /trunk/portsclean
   M /trunk/portsdb
   M /trunk/portupgrade
   M /trunk/portversion

Sort the environment variables in the help screen in alphabetical
order.

------------------------------------------------------------------------
r543 | knu | 2001-10-26 02:09:04 +0900 (Fri, 26 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkgdb
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/pkg_fetch
   M /trunk/pkgdb
   M /trunk/portsclean
   M /trunk/portsdb

Make all the rest tools except for portcvsweb read the configuration
file and add the -q/--no-config option.

------------------------------------------------------------------------
r542 | knu | 2001-10-26 01:48:04 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkg_glob
   M /trunk/portupgrade
   M /trunk/portversion

There is no need to call init_pkgtools_global() here any more.

------------------------------------------------------------------------
r541 | knu | 2001-10-26 01:47:14 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Make this read pkgtools.conf, and add -q/--no-config at the same time.

------------------------------------------------------------------------
r540 | knu | 2001-10-26 01:46:01 +0900 (Fri, 26 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Call init_pkgtools_global() in load_config().

------------------------------------------------------------------------
r539 | knu | 2001-10-25 19:55:35 +0900 (Thu, 25 Oct 2001) | 9 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Since the dbm routines in libc seem to dead lock, slightly change the
DB format; record installed_{pkg,ports} as join'ed strings instead of
marshalled strings.  This is space saving and hopefully brings more
stability.

Bump the DB version accordingly.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r538 | knu | 2001-10-25 19:29:11 +0900 (Thu, 25 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Make -f override "hold" marks.

------------------------------------------------------------------------
r537 | knu | 2001-10-25 19:27:56 +0900 (Thu, 25 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Make sure to check DB version when updating the DB. (-u)

------------------------------------------------------------------------
r536 | knu | 2001-10-25 06:23:44 +0900 (Thu, 25 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Remove duplicates from dependency lists.

Suggested by:	Dave Cornejo <dave@dogwood.com>

------------------------------------------------------------------------
r535 | knu | 2001-10-25 06:16:54 +0900 (Thu, 25 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Exclude duplicates from a dependency list. (pkgdep & required_by)

------------------------------------------------------------------------
r534 | knu | 2001-10-24 21:35:55 +0900 (Wed, 24 Oct 2001) | 13 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/lib/pkgtools.rb
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob
   M /trunk/pkg_glob.1
   M /trunk/pkgtools.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1
   M /trunk/portversion
   M /trunk/portversion.1

Introduce the configuration file for the pkgtools suite.

Currently portupgrade(1), portversion(1), pkg_deinstall(1) and
pkg_glob(1) use it.

Add a new option -q/--no-config to avoid reading the configuration
file.

Introduce dependency sanity checks.  If an inconsistency is detected,
immediately abort a process suggesting the user should run `pkgdb -F'.

Add a new option -O/--omit-check to omit the sanity checks.

------------------------------------------------------------------------
r533 | knu | 2001-10-24 21:23:44 +0900 (Wed, 24 Oct 2001) | 2 lines
Changed paths:
   A /trunk/etc/pkgtools.conf
   M /trunk/install.rb

Add the configuration file for the pkgtools suite.

------------------------------------------------------------------------
r532 | knu | 2001-10-24 21:17:46 +0900 (Wed, 24 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Fix the origin guesser's minor bug.  PortsDB#exists? now returns false
instead of nil if a given port does not exist.

------------------------------------------------------------------------
r531 | knu | 2001-10-24 21:15:36 +0900 (Wed, 24 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb.1
   M /trunk/pkgdb.1

Add a useful example of pkg_which(1) usage.

Remove the useless BUG section.

------------------------------------------------------------------------
r530 | knu | 2001-10-24 16:25:19 +0900 (Wed, 24 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch.1
   M /trunk/bin/portsclean.1
   M /trunk/pkg_fetch.1
   M /trunk/portsclean.1

Remove the useless BUGS section.

------------------------------------------------------------------------
r529 | knu | 2001-10-24 06:40:12 +0900 (Wed, 24 Oct 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Never use the method in portupgrade.

Make all_depends_list! accept extra arguments for make(1).

------------------------------------------------------------------------
r528 | knu | 2001-10-24 01:25:04 +0900 (Wed, 24 Oct 2001) | 7 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/pkgdb.rb
   M /trunk/pkg_glob
   M /trunk/pkgdb.rb
   M /trunk/portupgrade
   M /trunk/portversion

- Emit a warning when pkgdb cannot be updated though it is not
  up-to-date.

- Introduce a simple dependency sanity check. (turned off for now)

- Reword: s/package database/pkgdb/.a

------------------------------------------------------------------------
r527 | knu | 2001-10-23 17:59:44 +0900 (Tue, 23 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Rephrase the descriptions of -f/--force and -g/--go-on.

------------------------------------------------------------------------
r526 | knu | 2001-10-23 17:40:21 +0900 (Tue, 23 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_portsdb
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion
   M /trunk/pkg_glob
   M /trunk/portsdb
   M /trunk/portupgrade
   M /trunk/portversion

Finally remove -E/--regex.  Use the ':RE' glob pattern instead.

------------------------------------------------------------------------
r525 | knu | 2001-10-23 06:17:57 +0900 (Tue, 23 Oct 2001) | 5 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Add a new option -y/--yes, which lets portupgrade assume user answers
yes to all the questions.

Make -n and -y exclusive.

------------------------------------------------------------------------
r524 | knu | 2001-10-23 06:17:45 +0900 (Tue, 23 Oct 2001) | 3 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Add a new option -y/--yes, which lets portupgrade assume user answers
yes to all the questions.

------------------------------------------------------------------------
r523 | knu | 2001-10-23 06:17:32 +0900 (Tue, 23 Oct 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Add a new option -y/--yes, which lets portupgrade assume user answers
yes to all the questions.

Make sure to ask user where it should. (Get -N and -i right)

------------------------------------------------------------------------
r522 | knu | 2001-10-22 16:14:31 +0900 (Mon, 22 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug where portinstall -i didn't work interactively.

Submitted by:	Gregory Neil Shapiro <gshapiro@gshapiro.net>

------------------------------------------------------------------------
r521 | knu | 2001-10-22 07:25:10 +0900 (Mon, 22 Oct 2001) | 7 lines
Changed paths:
   A /trunk/bin/make_describe_pass1
   A /trunk/bin/make_describe_pass2
   M /trunk/install.rb
   M /trunk/lib/portsdb.rb
   A /trunk/make_describe_pass1
   A /trunk/make_describe_pass2
   M /trunk/portsdb.rb

- Add more utility methods to PortsDB.

- Attempt to offer fast INDEX generation.  Now it generates an INDEX
  file more than a few minutes faster.

- Add and install make_describe_pass[12].

------------------------------------------------------------------------
r520 | knu | 2001-10-15 03:51:01 +0900 (Mon, 15 Oct 2001) | 7 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug where `portupgrade -h' shows the usage twice.

Reported by:	Gregory Neil Shapiro <gshapiro@gshapiro.net>

Do not run `stty sane' needlessly.  This fixes `portupgrade -h |
less'.

------------------------------------------------------------------------
r519 | knu | 2001-10-13 23:07:16 +0900 (Sat, 13 Oct 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_pkginfo.rb

Fix a test as originally intended.

------------------------------------------------------------------------
r518 | knu | 2001-10-13 02:49:21 +0900 (Sat, 13 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Make good use of portsdb and pkgdb, and get distclean much
faster. (both -D and -DD)

------------------------------------------------------------------------
r517 | knu | 2001-10-13 02:01:12 +0900 (Sat, 13 Oct 2001) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

PortsDB#{each,each_origin}: Do not fail even if a nonexistent category
is given.

Reported and tested by:	Jos Backus <josb@cncdsl.com>

------------------------------------------------------------------------
r516 | knu | 2001-10-13 01:43:13 +0900 (Sat, 13 Oct 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

A zero-sized +REQUIRED_BY file means the package is not required by
any other package.

------------------------------------------------------------------------
r515 | knu | 2001-10-12 04:41:48 +0900 (Fri, 12 Oct 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Rebuild pkgdb if it looks like broken, instead of resulting in
failure.

Unbreak regexp match. ;)

------------------------------------------------------------------------
r514 | knu | 2001-10-11 04:26:05 +0900 (Thu, 11 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Fix a typo of a variable name in an error message.

Reported by:	Stijn Hoop <stijn@win.tue.nl>

------------------------------------------------------------------------
r513 | knu | 2001-10-11 02:48:34 +0900 (Thu, 11 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Allow a port dir to be a symlink to a directory.

------------------------------------------------------------------------
r512 | knu | 2001-10-10 20:33:04 +0900 (Wed, 10 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Delete an unneeded exception snatcher.  This fixes a bug where ports
marked as IGNORE are not properly skipped.

------------------------------------------------------------------------
r511 | knu | 2001-10-10 20:29:37 +0900 (Wed, 10 Oct 2001) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Add support for the case where some catetories are missing in a ports
tree.

Submitted by:	Jos Backus <josb@cncdsl.com>

------------------------------------------------------------------------
r510 | knu | 2001-10-10 05:18:43 +0900 (Wed, 10 Oct 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Fix a type error and unbreak date-based pkg glob.

Reported by:	Ollivier Robert <roberto@keltia.freenix.fr>

------------------------------------------------------------------------
r509 | knu | 2001-10-10 05:14:31 +0900 (Wed, 10 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Make PortsDB#strip suppress sequent occurrences of the slash.

------------------------------------------------------------------------
r508 | knu | 2001-10-10 05:13:17 +0900 (Wed, 10 Oct 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_portsdb.rb

PortsDB#strip now only accepts regularized paths.

------------------------------------------------------------------------
r507 | knu | 2001-10-10 03:29:55 +0900 (Wed, 10 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Silence pkg_info when it does not find a package.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r506 | knu | 2001-10-10 01:51:21 +0900 (Wed, 10 Oct 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/pkgdb

Make pkgdb fixer's dependency guesser aware of language specific
categories.  Now it suggests ja-qt-2.3.1 for qt-2.3.1, instead of
qt-1.45_1.

------------------------------------------------------------------------
r505 | knu | 2001-10-10 01:49:13 +0900 (Wed, 10 Oct 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Make date_installed() support a package entry that has no +COMMENT
file, like an XFree86 package entry faked by a FreeBSD installation.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r504 | knu | 2001-10-10 01:46:01 +0900 (Wed, 10 Oct 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Define a table of the language specific categories.

Add a quick check mode to exists?().

------------------------------------------------------------------------
r503 | knu | 2001-10-09 19:31:14 +0900 (Tue, 09 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Describe how to use portsdb(1) better.

------------------------------------------------------------------------
r502 | knu | 2001-10-08 16:09:40 +0900 (Mon, 08 Oct 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Do not allow specifying a ports glob using a relative path to the
current directory.  This prevents the tools from confusing when the
current directory is under PORTS_DIR.

------------------------------------------------------------------------
r501 | knu | 2001-10-07 17:46:02 +0900 (Sun, 07 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Give a better progress display.

------------------------------------------------------------------------
r500 | knu | 2001-10-07 06:02:29 +0900 (Sun, 07 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

There's no need to specify a file mode when you open an existing database.

------------------------------------------------------------------------
r499 | knu | 2001-10-07 05:29:32 +0900 (Sun, 07 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Fix date_db_file not to create an empty db file just to get mtime.

------------------------------------------------------------------------
r498 | knu | 2001-10-06 23:53:26 +0900 (Sat, 06 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Update the documentation.

------------------------------------------------------------------------
r497 | knu | 2001-10-06 23:14:53 +0900 (Sat, 06 Oct 2001) | 7 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

- Detect added/deleted/reinstalled packages more strictly so pkgdb
  can keep being sane and consistent.

- Do not fail over a small conflict found during updating pkgdb;
  portupgrade should not be aborted because of such a minor problem.
  The user will need to do a "pkgdb -fu" later anyway, though.

------------------------------------------------------------------------
r496 | knu | 2001-10-06 21:28:41 +0900 (Sat, 06 Oct 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Revert the SIGINT inhibition because it seems to have bad side
effects.  To be fixed later.

------------------------------------------------------------------------
r495 | knu | 2001-10-06 20:03:59 +0900 (Sat, 06 Oct 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Create a backup package registry in tmpdir instead of pkgdbdir, in
order not to update pkgdbdir's mtime.

Give a message when a package upgrade is demanded by a new port.

------------------------------------------------------------------------
r494 | knu | 2001-10-06 18:59:23 +0900 (Sat, 06 Oct 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Inhibit user interrupt (^C) while updating pkgdb.

Emit a warning when a deleted package is not recorded as installed.

------------------------------------------------------------------------
r493 | knu | 2001-10-06 05:49:15 +0900 (Sat, 06 Oct 2001) | 11 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Commit major changes and improvements over portinstall.

- Now it warns and asks the user for confirmation if a port is being installed
  when a package of the same origin is already installed.

- Upgrade all the required packages before installing a new port.
  [Requested by: Hajimu UMEMOTO <ume@mahoroba.org>]

- Do not install ports immediately but queue them up, then install them after
  upgrading all the specified and required packages.

------------------------------------------------------------------------
r492 | knu | 2001-10-06 05:42:11 +0900 (Sat, 06 Oct 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Record the last-modified date within the pkgdb.

Fix all the bugs introduced in the previous changes.

Simplify date comparison routines.

------------------------------------------------------------------------
r491 | knu | 2001-10-05 07:10:38 +0900 (Fri, 05 Oct 2001) | 9 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Record origin to pkgname mapping and a list of installed ports too.

Bump DB_VERSION accordingly.

Add these new methods: deorigin, installed_pkg?, installed_port?,
installed_pkgs_ and installed_ports/installed_ports_/installed_ports!.

Optimize sort() and glob() a bit.

------------------------------------------------------------------------
r490 | knu | 2001-10-05 07:05:36 +0900 (Fri, 05 Oct 2001) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Add these new methods: category?, virtual_category?, ports/indices and
all_depends_list/all_depends_list!.

Optimize sort() a bit.

------------------------------------------------------------------------
r489 | knu | 2001-10-05 07:02:27 +0900 (Fri, 05 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Optimize for match?('*'), and define match(true) as true.

------------------------------------------------------------------------
r488 | knu | 2001-10-05 07:00:12 +0900 (Fri, 05 Oct 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Dir.chdir_do() has been renamed to Dir.chdir().  (now pkgmisc.rb
overrides the method)

------------------------------------------------------------------------
r487 | knu | 2001-10-05 06:57:41 +0900 (Fri, 05 Oct 2001) | 2 lines
Changed paths:
   M /trunk/install.rb
   A /trunk/lib/pkgmisc.rb
   M /trunk/lib/pkgtools.rb
   A /trunk/pkgmisc.rb
   M /trunk/pkgtools.rb

Move common utility functions to pkgmisc.rb.

------------------------------------------------------------------------
r486 | knu | 2001-10-03 07:59:28 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Fix the completion for pkgdb.

------------------------------------------------------------------------
r485 | knu | 2001-10-03 07:51:16 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgdb

Support pkgdb -o.

------------------------------------------------------------------------
r484 | knu | 2001-10-03 07:50:51 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/pkgdb
   M /trunk/pkgdb.1

Add -o/--origin.

------------------------------------------------------------------------
r483 | knu | 2001-10-03 07:36:22 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkgdb
   D /trunk/misc/zsh/_pkgdepfix

Reflect the pkgdepfix -> pkgdb merger.

------------------------------------------------------------------------
r482 | knu | 2001-10-03 07:35:36 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb.1
   M /trunk/pkgdb.1

Update the usage.

------------------------------------------------------------------------
r481 | knu | 2001-10-03 07:28:48 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/pkgdb
   M /trunk/bin/pkgdb.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/install.rb
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/pkgdb
   M /trunk/pkgdb.1
   D /trunk/pkgdepfix
   D /trunk/pkgdepfix.1
   M /trunk/portsdb.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Integrate pkgdepfix(1) into pkgdb(1).

------------------------------------------------------------------------
r480 | knu | 2001-10-03 06:47:51 +0900 (Wed, 03 Oct 2001) | 13 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/pkg_glob
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/portsdb.rb
   M /trunk/pkg_glob
   M /trunk/pkgdb.rb
   M /trunk/pkgdepfix
   M /trunk/pkgdepfix.1
   M /trunk/pkginfo.rb
   M /trunk/pkgtools.rb
   M /trunk/portsclean
   M /trunk/portsdb
   M /trunk/portsdb.rb
   M /trunk/portupgrade

pkgdb:
	Record a pkgname => origin table in the pkgdb and make full
	use of it instead of repeatedly calling pkg_info -o which has
	undesirable overheads.

	Make portupgrade, pkg_deinstall and pkgdepfix update the pkgdb
	after they install/deinstall packages or modify the package
	registry.

pkgdepfix:
	Obsolete -o and turn -o on by default.  Now we can look up an
	origin of a package so quickly thanks to the pkgdb.

------------------------------------------------------------------------
r479 | knu | 2001-10-03 03:29:23 +0900 (Wed, 03 Oct 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add a full path of pkgdb(1).

------------------------------------------------------------------------
r478 | knu | 2001-10-03 02:48:09 +0900 (Wed, 03 Oct 2001) | 12 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

- Rename PortNotFoundError to PortDirError, and raise it if a port
  directory cannot be chdir'ed though it does exist.

- Do not scan packages all at once when -P is given, but find one per
  request.
  [Requested by: Hideaki OKADA <hokada@isl.melco.co.jp>]

- When an upgrade is to be done using a package, inform so in a
  message.

- Rephrase some messages.

------------------------------------------------------------------------
r477 | knu | 2001-10-03 02:38:15 +0900 (Wed, 03 Oct 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

A date spec is not a valid ports glob; emit a warning if specified.
[Found by: Hajimu UMEMOTO <ume@mahoroba.org>]

------------------------------------------------------------------------
r476 | knu | 2001-09-26 20:35:37 +0900 (Wed, 26 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

$backup_packages is not supposed to be default.  D'oh!

------------------------------------------------------------------------
r475 | knu | 2001-09-24 16:21:31 +0900 (Mon, 24 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Improve the dbm key deletion routine and avoid coredump.

------------------------------------------------------------------------
r474 | knu | 2001-09-22 20:05:27 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb
   M /trunk/pkgdb.rb

Improve error handling.

------------------------------------------------------------------------
r473 | knu | 2001-09-22 07:42:24 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portupgrade.1
   M /trunk/pkg_glob.1
   M /trunk/portupgrade.1

Reword.

------------------------------------------------------------------------
r472 | knu | 2001-09-22 06:59:36 +0900 (Sat, 22 Sep 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Use a better way to prevent "can't cd" errors.

Submitted by:	Jos Backus <josb@cncdsl.com>

------------------------------------------------------------------------
r471 | knu | 2001-09-22 06:43:15 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob
   M /trunk/pkg_glob.1
   M /trunk/pkgdb.rb
   M /trunk/pkginfo.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1
   M /trunk/portversion
   M /trunk/portversion.1

Implement new glob patterns: {<|<=|>=|>}{date|pkgname_glob}.

------------------------------------------------------------------------
r470 | knu | 2001-09-22 04:38:38 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/README

Describe pkgdb, pkg_which and ports_glob.

------------------------------------------------------------------------
r469 | knu | 2001-09-22 04:37:15 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkgdb.1
   M /trunk/pkgdb.1

Rephrase.

------------------------------------------------------------------------
r468 | knu | 2001-09-22 04:21:26 +0900 (Sat, 22 Sep 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Suppress "can't cd" error messages.

Submitted by:	Jos Backus <josb@cncdsl.com>

------------------------------------------------------------------------
r467 | knu | 2001-09-22 04:17:39 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Support pkgdb(1), pkg_which(1) and ports_glob(1).

------------------------------------------------------------------------
r466 | knu | 2001-09-22 04:08:51 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/misc/tcsh/complete.sample

portsdb -> ports_glob

------------------------------------------------------------------------
r465 | knu | 2001-09-22 04:07:37 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_pkgdb

Add a compdef for pkgdb(1) and pkg_which(1).

------------------------------------------------------------------------
r464 | knu | 2001-09-22 04:07:17 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portsdb

This applies to ports_glob(1) as well.

------------------------------------------------------------------------
r463 | knu | 2001-09-22 03:56:17 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Reword and reflect ports_glob(1) -> portsdb(1) link.

------------------------------------------------------------------------
r462 | knu | 2001-09-22 03:55:35 +0900 (Sat, 22 Sep 2001) | 4 lines
Changed paths:
   M /trunk/install.rb

Install pkgdb(1) and pkg_which(1).

Install ports_glob(1) as a symlink to portsdb(1).

------------------------------------------------------------------------
r461 | knu | 2001-09-22 03:54:47 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1
   M /trunk/portsclean.1

Cross reference pkgdb(1).

------------------------------------------------------------------------
r460 | knu | 2001-09-22 03:53:59 +0900 (Sat, 22 Sep 2001) | 3 lines
Changed paths:
   A /trunk/bin/pkgdb
   A /trunk/bin/pkgdb.1
   A /trunk/pkgdb
   A /trunk/pkgdb.1

Add pkgdb(1) and pkg_which(1), which update or look up the packages
database.

------------------------------------------------------------------------
r459 | knu | 2001-09-22 03:52:14 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

s/a tool/tools/

------------------------------------------------------------------------
r458 | knu | 2001-09-22 01:14:49 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Fix the loop that unregisters the files of a deleted package.

------------------------------------------------------------------------
r457 | knu | 2001-09-22 00:27:48 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Utilize PkgDB#which.

------------------------------------------------------------------------
r456 | knu | 2001-09-22 00:27:23 +0900 (Sat, 22 Sep 2001) | 9 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

- Create and utilize $PKG_DBDIR/pkgdb.byfile.db, which is a hash that
  maps file paths to pkgnames.

  Inspired by:	NetBSD

- Add PkgDB#which.

- Add PkgDB#each and make PkgDB enumerable just as PortsDB.

------------------------------------------------------------------------
r455 | knu | 2001-09-22 00:23:38 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Add PkgInfo#files.

------------------------------------------------------------------------
r454 | knu | 2001-09-22 00:22:36 +0900 (Sat, 22 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Use IO#putc instead of IO#print to print a character.

------------------------------------------------------------------------
r453 | knu | 2001-09-21 18:14:35 +0900 (Fri, 21 Sep 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Skip ports that are marked as IGNORE.

Requested by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r452 | knu | 2001-09-21 17:58:10 +0900 (Fri, 21 Sep 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Stop specifying -j4 when making a ports index because it's buggy, and
sorting is not necessary any more.

------------------------------------------------------------------------
r451 | knu | 2001-09-19 01:04:44 +0900 (Wed, 19 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgversion.rb
   M /trunk/lib/portinfo.rb
   M /trunk/lib/portsdb.rb
   M /trunk/lib/tsort.rb
   M /trunk/pkgdb.rb
   M /trunk/pkgdepfix
   M /trunk/pkginfo.rb
   M /trunk/pkgversion.rb
   M /trunk/portinfo.rb
   M /trunk/portsdb
   M /trunk/portsdb.rb
   M /trunk/portupgrade
   M /trunk/tsort.rb

Minor style fixes.

------------------------------------------------------------------------
r450 | knu | 2001-09-18 19:07:19 +0900 (Tue, 18 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Apply a correct fix to work around pkg_info(1)'s evil misfeature.

------------------------------------------------------------------------
r449 | knu | 2001-09-18 17:00:22 +0900 (Tue, 18 Sep 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Pass the full path of a pkgdir to pkg_info(1), or it searches PKG_PATH
prior to PKG_DBDIR and may fail unexpectedly.

Reported by:	kuwa@flab.fujitsu.co.jp

------------------------------------------------------------------------
r448 | knu | 2001-09-18 16:53:41 +0900 (Tue, 18 Sep 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Prepare for introcuding the pkgdb file that NetBSD has.

------------------------------------------------------------------------
r447 | knu | 2001-09-18 16:52:36 +0900 (Tue, 18 Sep 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Clear the cache when (re)opening ports DB.

Introduce PortsDB#date_index and PortsDB#date_db.

------------------------------------------------------------------------
r446 | knu | 2001-09-17 16:53:38 +0900 (Mon, 17 Sep 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Do not assume a distinfo file is in each port's own directory and use
`make -V MD5_FILE', in order to support master-slave ports properly.

------------------------------------------------------------------------
r445 | knu | 2001-09-17 02:49:55 +0900 (Mon, 17 Sep 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/pkgdb.rb
   M /trunk/pkginfo.rb

Add PkgDB#date_db_dir and PkgDB#date_installed(pkgname).
Define PkgDB#[] as an alias for PkgDB#pkg(pkgname).

Add PkgInfo#date_installed.

------------------------------------------------------------------------
r444 | knu | 2001-09-16 23:53:59 +0900 (Sun, 16 Sep 2001) | 2 lines
Changed paths:
   M /trunk/README

Update requisites.

------------------------------------------------------------------------
r443 | knu | 2001-09-12 18:55:45 +0900 (Wed, 12 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Add two new sections: EXAMPLES and TIPS.

------------------------------------------------------------------------
r442 | knu | 2001-09-12 16:11:44 +0900 (Wed, 12 Sep 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Try to fetch the latest version of a package when the exactly same
version as the port is not found in the package site.

------------------------------------------------------------------------
r441 | knu | 2001-09-12 15:52:50 +0900 (Wed, 12 Sep 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Support the environment variable PKG_PATH which is supported by
pkg_add(1).

------------------------------------------------------------------------
r440 | knu | 2001-09-12 13:24:05 +0900 (Wed, 12 Sep 2001) | 11 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/misc/zsh/_pkg_fetch
   M /trunk/pkg_fetch
   M /trunk/pkg_fetch.1

- Accept a full URI as well.

- Do not try both All and Latest; now one must put an @ at the end of a
  package name if one wants to omit the version part. ("cyrus-sasl@", etc.)

- Obsolete the PACKAGEBASE environment variable.

- If -f is specified, Remove existing packages if they are corrupt.

- Do not depend on the ports database.

------------------------------------------------------------------------
r439 | knu | 2001-09-12 04:51:00 +0900 (Wed, 12 Sep 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_portsdb
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion

Fix stupid completion bugs.

------------------------------------------------------------------------
r438 | knu | 2001-09-12 03:59:20 +0900 (Wed, 12 Sep 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Add a new option -b/--backup-packages, which keeps backup packages of
the old versions'.

Requested by:	mistral@imasy.or.jp (Yoshihiko SARUMARU)

------------------------------------------------------------------------
r437 | knu | 2001-09-10 18:16:48 +0900 (Mon, 10 Sep 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/portsclean
   M /trunk/portsclean.1

Fix the command line help.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r436 | knu | 2001-09-07 04:38:28 +0900 (Fri, 07 Sep 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a misbehavior when -s is specified, where it previously built each
port twice. ;)

------------------------------------------------------------------------
r435 | knu | 2001-09-06 18:11:12 +0900 (Thu, 06 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/pkg_fetch

Be even more smart in deciding which to try first, All or Latest.

------------------------------------------------------------------------
r434 | knu | 2001-09-06 17:44:28 +0900 (Thu, 06 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Read the env variable PORTUPGRADE when called as portinstall too.

------------------------------------------------------------------------
r433 | knu | 2001-09-06 15:46:02 +0900 (Thu, 06 Sep 2001) | 6 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/lib/pkgtools.rb
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob
   M /trunk/pkg_glob.1
   M /trunk/pkgtools.rb
   M /trunk/portsdb
   M /trunk/portsdb.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1
   M /trunk/portversion
   M /trunk/portversion.1

- Allow using regexp in a glob pattern on the spot, by just putting a
  regexp preceded by a colon (:).

- Thereby deprecate -E/--regex, which is evil because it changes the
  global status. (but the option is still kept for compatibility)

------------------------------------------------------------------------
r432 | knu | 2001-09-06 01:32:40 +0900 (Thu, 06 Sep 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Return correct exit status.

Reported by:	Trevin Chow <trevin@mail.com>

------------------------------------------------------------------------
r431 | knu | 2001-09-01 03:39:49 +0900 (Sat, 01 Sep 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

D'oh, fix a typo..

------------------------------------------------------------------------
r430 | knu | 2001-08-31 16:54:15 +0900 (Fri, 31 Aug 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_portsdb.rb

Fix the test for PortsDB#strip().

------------------------------------------------------------------------
r429 | knu | 2001-08-31 16:46:27 +0900 (Fri, 31 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fake all_depends too.

------------------------------------------------------------------------
r428 | knu | 2001-08-31 16:44:09 +0900 (Fri, 31 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix PortsDB#split() to just strip PORTSDIR part and a trailing slash.

------------------------------------------------------------------------
r427 | knu | 2001-08-31 16:42:16 +0900 (Fri, 31 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgversion.rb
   M /trunk/lib/portinfo.rb
   M /trunk/pkgversion.rb
   M /trunk/portinfo.rb

Style fix.

------------------------------------------------------------------------
r426 | knu | 2001-08-30 03:20:44 +0900 (Thu, 30 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Workaround optparse' feature.  Since it treats -l= as -l "", assume an
"=" is pecified when we get an empty string.  Now -l= and -L= will
work as expected.

------------------------------------------------------------------------
r425 | knu | 2001-08-29 18:24:15 +0900 (Wed, 29 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Make portupgrade download packages when -FP is given. (also aware of
-R, -f and -v)

------------------------------------------------------------------------
r424 | knu | 2001-08-29 18:22:08 +0900 (Wed, 29 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/pkg_fetch
   M /trunk/pkg_fetch.1

Be more intelligent and try All and Latest in the proper order.

------------------------------------------------------------------------
r423 | knu | 2001-08-29 17:39:23 +0900 (Wed, 29 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/pkg_fetch

Do not try 'All/' when a package name does not contain a '-'.

------------------------------------------------------------------------
r422 | knu | 2001-08-29 17:10:37 +0900 (Wed, 29 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/pkg_fetch

Return a non-zero status value when some are failed.

------------------------------------------------------------------------
r421 | knu | 2001-08-29 16:19:55 +0900 (Wed, 29 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_fetch
   M /trunk/bin/pkg_fetch.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_pkg_fetch
   M /trunk/pkg_fetch
   M /trunk/pkg_fetch.1

pkg_fetch -r should have been -R, since it recurses upwards.

------------------------------------------------------------------------
r420 | knu | 2001-08-29 03:50:11 +0900 (Wed, 29 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Revamp build_port().  Try not to do duplicate operations.

Now -RF invokes fetch-recursive.
[Suggested by:	Jimmy Olgeni <olgeni@uli.it>]

------------------------------------------------------------------------
r419 | knu | 2001-08-29 02:54:54 +0900 (Wed, 29 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Update the usage, manpages and shell compdefs.

------------------------------------------------------------------------
r418 | knu | 2001-08-29 02:47:56 +0900 (Wed, 29 Aug 2001) | 6 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add a new option -M/--make-env, with which a user can specify
arguments to prepend to each make(1) command line.

It's a good time to remove .dup from shellwords()' arguments.  The bug
of shellwords.rb was fixed several months ago.

------------------------------------------------------------------------
r417 | knu | 2001-08-29 02:18:47 +0900 (Wed, 29 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/portsdb.rb
   M /trunk/pkg_glob
   M /trunk/pkgdb.rb
   M /trunk/portsdb
   M /trunk/portsdb.rb
   M /trunk/portupgrade

Fix glob expansion routines.  It has been broken since I hacked them
to allow rather stupid patterns.

------------------------------------------------------------------------
r416 | knu | 2001-08-27 22:43:40 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgdepfix
   M /trunk/pkgtools.rb

Fix readline nits.

------------------------------------------------------------------------
r415 | knu | 2001-08-27 21:00:51 +0900 (Mon, 27 Aug 2001) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix a bug where it causes an error when portsdb detects a DB_VERSION
bump.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r414 | knu | 2001-08-27 19:34:50 +0900 (Mon, 27 Aug 2001) | 5 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Change the #! line from "/bin/bash" to "/usr/bin/env bash". (It
doesn't matter anyway, since it is just for editors' syntax detection)

Noted by:	Anders Andersson <anders@codefactory.se>

------------------------------------------------------------------------
r413 | knu | 2001-08-27 18:56:36 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_portsdb
   M /trunk/portsdb
   M /trunk/portsdb.1

Add a new option: -f/--force.

------------------------------------------------------------------------
r412 | knu | 2001-08-27 17:01:29 +0900 (Mon, 27 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb
   M /trunk/portsclean
   M /trunk/portupgrade

Replace "ary1.push(*ary2) unless ary2.empty?" with Array#concat or
other better ways.

------------------------------------------------------------------------
r411 | knu | 2001-08-27 16:31:54 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Bump DB_VERSION, since PkgVersion was changed a bit.

Reported by:	fritz.heinrichmeyer@fernuni-hagen.de

------------------------------------------------------------------------
r410 | knu | 2001-08-27 16:24:29 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add a missing argument for Dir::chdir_do().

Reported by:	"Li-lun Wang (Leland Wang)" <llwang@infor.org>

------------------------------------------------------------------------
r409 | knu | 2001-08-27 04:46:19 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README

Mention pkg_fetch.

------------------------------------------------------------------------
r408 | knu | 2001-08-27 04:35:48 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   M /trunk/misc/tcsh/complete.sample

Add a tcsh compdef for pkg_fetch(1).

Remove redundant arguments.

------------------------------------------------------------------------
r407 | knu | 2001-08-27 04:21:57 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_pkgdepfix
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion

Fix not to complete non directories for pkgnames.

Quote colons properly.

------------------------------------------------------------------------
r406 | knu | 2001-08-27 04:21:07 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_pkg_fetch

Add a zsh compdef for pkg_fetch(1).

------------------------------------------------------------------------
r405 | knu | 2001-08-27 04:00:09 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Add a bash compdef for pkg_fetch(1).

------------------------------------------------------------------------
r404 | knu | 2001-08-27 03:46:44 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install pkg_fetch and its manpage.

------------------------------------------------------------------------
r403 | knu | 2001-08-27 03:45:21 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   A /trunk/bin/pkg_fetch
   A /trunk/bin/pkg_fetch.1
   A /trunk/pkg_fetch
   A /trunk/pkg_fetch.1

Add yet another new utility, pkg_fetch(1).  It downloads binary
packages from a remote site.  Optionally, it can also download the
required packages recursively.

------------------------------------------------------------------------
r402 | knu | 2001-08-27 03:42:18 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/pkgdepfix.1
   M /trunk/portsdb.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Describe the default values of environment variables better.

------------------------------------------------------------------------
r401 | knu | 2001-08-27 03:41:32 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb.1
   M /trunk/portcvsweb.1

Silence nroff.

------------------------------------------------------------------------
r400 | knu | 2001-08-27 03:05:22 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Reword.

------------------------------------------------------------------------
r399 | knu | 2001-08-27 02:13:35 +0900 (Mon, 27 Aug 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Avoid using Readline.completion_append_character= if not defined, so
input_line() works with Ruby 1.6.4.

Reported by:	David Wolfskill <david@catwhisker.org>

------------------------------------------------------------------------
r398 | knu | 2001-08-27 02:02:49 +0900 (Mon, 27 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Do not regard "no package found" as an error when upgrading packages
with -PP.

Change the format of the "results" array.

------------------------------------------------------------------------
r397 | knu | 2001-08-27 02:00:12 +0900 (Mon, 27 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Change the format of the "results" array.

------------------------------------------------------------------------
r396 | knu | 2001-08-27 01:59:40 +0900 (Mon, 27 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Define $packages_base and $packages_dir.

Change the format of the "results" array.

------------------------------------------------------------------------
r395 | knu | 2001-08-26 19:40:19 +0900 (Sun, 26 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/portcvsweb

Explicitly execute a browser via /bin/sh, as the specification says.

------------------------------------------------------------------------
r394 | knu | 2001-08-26 18:02:44 +0900 (Sun, 26 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgversion.rb
   M /trunk/pkgversion.rb

Fix a stupid bug when generating a pkgname as a string.

Reported by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r393 | knu | 2001-08-26 06:40:14 +0900 (Sun, 26 Aug 2001) | 4 lines
Changed paths:
   M /trunk/misc/tcsh/complete.sample

Fix a typo.  ($PORTSDIR == 0) -> ($?PORTSDIR == 0)

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r392 | knu | 2001-08-26 06:28:01 +0900 (Sun, 26 Aug 2001) | 6 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Fix a sorting bug.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

Emit an informational message when -L/--libclean finishes.

------------------------------------------------------------------------
r391 | knu | 2001-08-26 06:26:55 +0900 (Sun, 26 Aug 2001) | 4 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Supply a missing `;;'.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r390 | knu | 2001-08-26 01:36:21 +0900 (Sun, 26 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/pkgversion.rb
   M /trunk/pkgdepfix
   M /trunk/pkginfo.rb
   M /trunk/pkgtools.rb
   M /trunk/pkgversion.rb

Make ruby -v safe.

------------------------------------------------------------------------
r389 | knu | 2001-08-26 01:35:51 +0900 (Sun, 26 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/portcvsweb

Fix a retry loop.

------------------------------------------------------------------------
r388 | knu | 2001-08-26 01:34:45 +0900 (Sun, 26 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/portsdb

Output the usage to stdout instead of stderr.

------------------------------------------------------------------------
r387 | knu | 2001-08-26 00:06:26 +0900 (Sun, 26 Aug 2001) | 3 lines
Changed paths:
   M /trunk/000.pkgtools.sh
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/etc/pkgtools.sh
   M /trunk/install.rb
   M /trunk/portsclean
   M /trunk/portsclean.1

Since $PREFIX/lib/compat is alread used by misc/compatXX, use
$PREFIX/lib/compat/pkg instead.

------------------------------------------------------------------------
r386 | knu | 2001-08-26 00:03:29 +0900 (Sun, 26 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Skip shared libraries in the compatlibdir.

------------------------------------------------------------------------
r385 | knu | 2001-08-25 22:40:26 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample
   M /trunk/misc/zsh/_portsclean

Teach portsclean -DD.

------------------------------------------------------------------------
r384 | knu | 2001-08-25 22:36:14 +0900 (Sat, 25 Aug 2001) | 13 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/portsclean
   M /trunk/portsclean.1

Implement portsclean -DD, which cleans all the distfiles which are not
referenced from any port that is currently installed, which portsclean
-D only cleans the distfiles which are not referenced from any port in
the ports tree.

Note that -DD runs very fast but removes more, whereas -D runs so slow
but removes less.

Idea provided by:	Kris Kennaway <kris@obsecurity.org>

Resurrect the support for the case where DISTDIR is a symlink, which
support I removed by mistake.

------------------------------------------------------------------------
r383 | knu | 2001-08-25 21:16:42 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r382 | knu | 2001-08-25 21:16:32 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Mention pkgdepfix's -o option.

------------------------------------------------------------------------
r381 | knu | 2001-08-25 21:03:28 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portsclean.1
   M /trunk/portsclean
   M /trunk/portsclean.1

Finally implement portsclean -L/--libclean.

------------------------------------------------------------------------
r380 | knu | 2001-08-25 21:02:59 +0900 (Sat, 25 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Do not append a space after completion.

Let a user choose even if there is just one option.

------------------------------------------------------------------------
r379 | knu | 2001-08-25 21:01:44 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Dig the compat library directory and install the startup script.

------------------------------------------------------------------------
r378 | knu | 2001-08-25 21:00:56 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   A /trunk/000.pkgtools.sh
   A /trunk/etc
   A /trunk/etc/pkgtools.sh

The startup script for pkgtools.

------------------------------------------------------------------------
r377 | knu | 2001-08-25 19:30:51 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Utilize the new helper methods in pkgtools.rb.

------------------------------------------------------------------------
r376 | knu | 2001-08-25 19:29:59 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Catch PortsDB::DBError.

------------------------------------------------------------------------
r375 | knu | 2001-08-25 19:29:39 +0900 (Sat, 25 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add more new helper methods: readline(), readline_file(),
choose_from_options().

------------------------------------------------------------------------
r374 | knu | 2001-08-25 16:14:38 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_portsdb

Add a zsh compdef for portsdb(1).

------------------------------------------------------------------------
r373 | knu | 2001-08-25 16:14:12 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Do not complete installed packages for portsdb.

------------------------------------------------------------------------
r372 | knu | 2001-08-25 07:34:12 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/bash/complete.sample

Add a definition for portsclean.

------------------------------------------------------------------------
r371 | knu | 2001-08-25 07:32:44 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Reword.

------------------------------------------------------------------------
r370 | knu | 2001-08-25 07:32:24 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portsclean
   M /trunk/misc/zsh/_portupgrade

Update.

------------------------------------------------------------------------
r369 | knu | 2001-08-25 07:16:49 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   A /trunk/misc/bash
   A /trunk/misc/bash/complete.sample

Add completion definitions for bash.

------------------------------------------------------------------------
r368 | knu | 2001-08-25 07:13:11 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Sort options in SYNOPSIS.

------------------------------------------------------------------------
r367 | knu | 2001-08-25 06:54:00 +0900 (Sat, 25 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgversion.rb
   M /trunk/pkgversion.rb
   M /trunk/tests/test_pkginfo.rb
   M /trunk/tests/test_pkgversion.rb

Save PORTREVISION and PORTEPOCH as zero instead of nil, if they aren't
defined.

------------------------------------------------------------------------
r366 | knu | 2001-08-25 04:59:22 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Complete command names for -A/-B/-S.

------------------------------------------------------------------------
r365 | knu | 2001-08-25 02:53:13 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/portcvsweb

Utilize ident(1).

------------------------------------------------------------------------
r364 | knu | 2001-08-25 02:52:54 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portsclean
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/pkgversion.rb
   M /trunk/lib/portinfo.rb
   M /trunk/lib/portsdb.rb
   M /trunk/lib/tsort.rb
   M /trunk/pkg_glob
   M /trunk/pkgdb.rb
   M /trunk/pkgdepfix
   M /trunk/pkginfo.rb
   M /trunk/pkgtools.rb
   M /trunk/pkgversion.rb
   M /trunk/portinfo.rb
   M /trunk/portsclean
   M /trunk/portsdb.rb
   M /trunk/portupgrade
   M /trunk/portversion
   M /trunk/tsort.rb

Reword conjunctions for readability.

------------------------------------------------------------------------
r363 | knu | 2001-08-25 00:43:02 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Reword a message.

------------------------------------------------------------------------
r362 | knu | 2001-08-25 00:42:36 +0900 (Sat, 25 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Uncomment Enumerator#partition.

Define PREFIX.

------------------------------------------------------------------------
r361 | knu | 2001-08-25 00:41:57 +0900 (Sat, 25 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix a typo.

------------------------------------------------------------------------
r360 | knu | 2001-08-24 17:58:13 +0900 (Fri, 24 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Update.

------------------------------------------------------------------------
r359 | knu | 2001-08-24 17:54:24 +0900 (Fri, 24 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add a new option: -l/--log-results, which is used to save the results
to a file.

Properly exit when main() does not return a valid value.

------------------------------------------------------------------------
r358 | knu | 2001-08-24 17:38:52 +0900 (Fri, 24 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Make *_message accept an alternative IO to STDOUT or STDERR.

Separate write_results from show_results.

------------------------------------------------------------------------
r357 | knu | 2001-08-24 05:59:38 +0900 (Fri, 24 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/portsdb
   M /trunk/portsdb.1

Implement -r/--recursive. (a bit slow, though)

------------------------------------------------------------------------
r356 | knu | 2001-08-24 05:58:54 +0900 (Fri, 24 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/lib/pkgtools.rb
   M /trunk/pkg_glob
   M /trunk/pkgtools.rb
   M /trunk/portupgrade
   M /trunk/portversion

Replace pkg_recurse with PkgDB#recurse.

------------------------------------------------------------------------
r355 | knu | 2001-08-24 05:57:37 +0900 (Fri, 24 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Add PortsDB#recurse.

------------------------------------------------------------------------
r354 | knu | 2001-08-24 05:57:17 +0900 (Fri, 24 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add PkgDB#recurse.

------------------------------------------------------------------------
r353 | knu | 2001-08-24 00:54:18 +0900 (Fri, 24 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Do not fail in the case when INDEX.db and INDEX.rbo are not in sync
somehow.

------------------------------------------------------------------------
r352 | knu | 2001-08-23 16:47:42 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix a typo.

------------------------------------------------------------------------
r351 | knu | 2001-08-23 06:38:15 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Avoid infinite loop.

------------------------------------------------------------------------
r350 | knu | 2001-08-23 06:24:19 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/pkgtools.rb
   M /trunk/lib/portsdb.rb
   M /trunk/pkgdepfix
   M /trunk/pkginfo.rb
   M /trunk/pkgtools.rb
   M /trunk/portsdb.rb

Support statically linked ruby.

------------------------------------------------------------------------
r349 | knu | 2001-08-23 06:21:41 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

portversion doesn't require 'thread' any more.

------------------------------------------------------------------------
r348 | knu | 2001-08-23 05:40:20 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r347 | knu | 2001-08-23 03:33:07 +0900 (Thu, 23 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Fix a bug in sudo() where it destoyed $sudo_args when the arguments
include a '%s'.  This fixes portupgrade -S 'su root -c %s'.
[Submitted by: KOMATSU Shinichiro <koma2@jiro.c.u-tokyo.ac.jp>]

------------------------------------------------------------------------
r346 | knu | 2001-08-23 03:29:57 +0900 (Thu, 23 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Remove a debug code.

------------------------------------------------------------------------
r345 | knu | 2001-08-22 22:08:59 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/bin/portcvsweb.1
   M /trunk/portcvsweb
   M /trunk/portcvsweb.1

Accept a port path as well.

------------------------------------------------------------------------
r344 | knu | 2001-08-22 21:20:29 +0900 (Wed, 22 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Adopt better error handling and a better PORTS_DBDIR selection
algorithm.

------------------------------------------------------------------------
r343 | knu | 2001-08-22 21:19:28 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Introduce PkgDB::DBError.

------------------------------------------------------------------------
r342 | knu | 2001-08-22 15:52:15 +0900 (Wed, 22 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/portsdb

Update the INDEX first, and then the database even if the options are
specified in reversed order. (-uU)

------------------------------------------------------------------------
r341 | knu | 2001-08-22 15:32:16 +0900 (Wed, 22 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a misfeature where "skip" was regarded as failure, when checking
for dependent ports' build/install failure.
[Pointed out by: Jimmy Olgeni <olgeni@uli.it>, "Jose M. Alcaide"
<jose@we.lc.ehu.es>]

------------------------------------------------------------------------
r340 | knu | 2001-08-22 15:22:34 +0900 (Wed, 22 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Fix pkg_recurse()'s bug where recurse_up breaks pkgname. (D'oh!)
[Reported by: "Jose M. Alcaide" <jose@we.lc.ehu.es>]

------------------------------------------------------------------------
r339 | knu | 2001-08-22 15:08:48 +0900 (Wed, 22 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Do not move a backup package under PKG_DBDIR, but just keep it under
TMPDIR.  It should not require a large amount of free space in
PKG_DBDIR.
[Pointed out by: John Merryweather Cooper <jmcoopr@webmail.bmi.net>]

------------------------------------------------------------------------
r338 | knu | 2001-08-22 03:58:08 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix a typo.

------------------------------------------------------------------------
r337 | knu | 2001-08-22 03:55:30 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Utilize Dir::chdir_do(), and avoid unnecessary chdir's.

------------------------------------------------------------------------
r336 | knu | 2001-08-22 03:52:39 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Avoid unnecessary chdir's.

------------------------------------------------------------------------
r335 | knu | 2001-08-22 03:40:59 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Utilize PortsDB#strip, PortsDB#exists? and Dir::chdir_do().

------------------------------------------------------------------------
r334 | knu | 2001-08-22 03:38:17 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Define Dir::chdir_do().

------------------------------------------------------------------------
r333 | knu | 2001-08-22 03:37:40 +0900 (Wed, 22 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Make exists?() return pkgname if the port exists.

------------------------------------------------------------------------
r332 | knu | 2001-08-22 03:19:50 +0900 (Wed, 22 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/portsdb.rb
   M /trunk/pkgdb.rb
   M /trunk/portsdb.rb

Implement the new specification, and use File.expand_path()
effectively.

------------------------------------------------------------------------
r331 | knu | 2001-08-22 03:18:24 +0900 (Wed, 22 Aug 2001) | 5 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

Change the specification:
	- pkgname/ and category/portname/ are okay now.
	- ./pkgname and ./category/portname are not okay unless we are
	  in PKG_DBDIR or PORTSDIR, respectively.

------------------------------------------------------------------------
r330 | knu | 2001-08-21 21:24:44 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Backup +CONTENTS files before removing duplicates.

------------------------------------------------------------------------
r329 | knu | 2001-08-21 20:45:10 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Accept pkgname_glob with paths.

------------------------------------------------------------------------
r328 | knu | 2001-08-21 20:33:11 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix portinstall -i.

Fix some bugs in the previous changes.

------------------------------------------------------------------------
r327 | knu | 2001-08-21 20:14:03 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Document -g/--go-on.

------------------------------------------------------------------------
r326 | knu | 2001-08-21 20:07:13 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Update the usage.

------------------------------------------------------------------------
r325 | knu | 2001-08-21 20:06:39 +0900 (Tue, 21 Aug 2001) | 10 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Skip ports and packages that once failed, and do not try to upgrade
multiple packages of an origin.

If a port or a package failed to build or install, skip its dependents.
This behavior can be overridden by the new option -g/--go-on.

Use the new function names of optparse.

Change the format of the results hash slightly.

------------------------------------------------------------------------
r324 | knu | 2001-08-21 20:02:15 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Separate the tsort object generation from sort().

Add new methods: pkg() and origin_of() to get PkgDB closer to PortsDB.

------------------------------------------------------------------------
r323 | knu | 2001-08-21 19:58:49 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Use the new function names of optparse.

Change the format of the results hash slightly.

------------------------------------------------------------------------
r322 | knu | 2001-08-21 19:58:09 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Change the format of the results hash slightly.

------------------------------------------------------------------------
r321 | knu | 2001-08-21 19:57:26 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portsclean
   M /trunk/portsdb
   M /trunk/portversion

Use the new function names of optparse.

------------------------------------------------------------------------
r320 | knu | 2001-08-21 13:23:30 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1
   M /trunk/portsclean.1

Update.

------------------------------------------------------------------------
r319 | knu | 2001-08-21 07:51:37 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Start implementing -L/--libclean.

------------------------------------------------------------------------
r318 | knu | 2001-08-21 06:35:19 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix abs_ports_dir().

Add localbase() and x11base().

------------------------------------------------------------------------
r317 | knu | 2001-08-21 06:05:31 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Accept portorigin_glob and pkgname_glob with paths.

------------------------------------------------------------------------
r316 | knu | 2001-08-21 06:04:57 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Accept portorigin_glob and pkgname_glob with paths.

Do `stty sane' before building each port and before exit.

------------------------------------------------------------------------
r315 | knu | 2001-08-21 05:50:22 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Make strip() squeeze //'s.

------------------------------------------------------------------------
r314 | knu | 2001-08-21 04:40:19 +0900 (Tue, 21 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Enhance strip() to accept an optional second argument,
"installed_only".  Simplify it while I'm here.

------------------------------------------------------------------------
r313 | knu | 2001-08-21 04:39:20 +0900 (Tue, 21 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Enhance strip() to accept an optional second argument,
"installed_only".

------------------------------------------------------------------------
r312 | knu | 2001-08-21 04:38:15 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Run "stty sane" on interrupt, just in case.

------------------------------------------------------------------------
r311 | knu | 2001-08-21 04:37:29 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   A /trunk/tests/test_portsdb.rb

Add a test suite for portsdb.rb.

------------------------------------------------------------------------
r310 | knu | 2001-08-21 04:36:55 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

Add tests for strip().

------------------------------------------------------------------------
r309 | knu | 2001-08-21 04:36:25 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_portinfo.rb

lib_depends and run_depends now return empty arrays instead of nils.

------------------------------------------------------------------------
r308 | knu | 2001-08-21 04:35:45 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Run "stty sane" before and after using Readline.

------------------------------------------------------------------------
r307 | knu | 2001-08-21 04:35:20 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add stty_sane().

------------------------------------------------------------------------
r306 | knu | 2001-08-21 04:25:34 +0900 (Tue, 21 Aug 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Specify stty(1) in full path.

------------------------------------------------------------------------
r305 | knu | 2001-08-21 02:32:54 +0900 (Tue, 21 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add a new method: pkgdir?().

Make strip() better.

------------------------------------------------------------------------
r304 | knu | 2001-08-20 21:40:52 +0900 (Mon, 20 Aug 2001) | 4 lines
Changed paths:
   A /trunk/misc/tcsh
   A /trunk/misc/tcsh/complete.sample

Add an example tcsh completion definition.

Contributed by:	kuwa@flab.fujitsu.co.jp

------------------------------------------------------------------------
r303 | knu | 2001-08-20 16:34:33 +0900 (Mon, 20 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/portupgrade
   M /trunk/portversion

When -a is specified, there is no need to regard -r and -R.

------------------------------------------------------------------------
r302 | knu | 2001-08-20 16:34:10 +0900 (Mon, 20 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

When -a is specified, there is no need to regard -r and -R.

pkg_glob should support -a, which is not only for pkg_deinstall.

------------------------------------------------------------------------
r301 | knu | 2001-08-20 15:35:58 +0900 (Mon, 20 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Fix pkg_recurse not to try pushing an empty array to cause an error.
[Caught by: Mamoru Iwaki <iwaki@bsp.bc.niigata-u.ac.jp>]

------------------------------------------------------------------------
r300 | knu | 2001-08-20 03:48:12 +0900 (Mon, 20 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

The `BROWSER' hack is no longer needed; I've fixed netscape ports.

------------------------------------------------------------------------
r299 | knu | 2001-08-20 00:24:46 +0900 (Mon, 20 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Unbreak -A and -B.
[Submitted by: Ollivier Robert <roberto@keltia.freenix.fr>]

------------------------------------------------------------------------
r298 | knu | 2001-08-20 00:15:41 +0900 (Mon, 20 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/portsdb
   M /trunk/portsdb.1

Implement -M/--master-recursive, -R/--upward-recursive and
-x/--exclude, and sort the result in dependency order.

------------------------------------------------------------------------
r297 | knu | 2001-08-19 23:56:40 +0900 (Sun, 19 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Fix a bug in sort() where the result included dependent ports,
and it now takes just an array of Strings, not PortInfo's.

------------------------------------------------------------------------
r296 | knu | 2001-08-19 23:45:16 +0900 (Sun, 19 Aug 2001) | 4 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Add a utility method origin_of().

Implement sort()/sort!().

------------------------------------------------------------------------
r295 | knu | 2001-08-19 23:44:21 +0900 (Sun, 19 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb
   M /trunk/portinfo.rb

When a list field is empty the value should be an array rather than nil.

------------------------------------------------------------------------
r294 | knu | 2001-08-19 23:32:46 +0900 (Sun, 19 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb
   M /trunk/portinfo.rb

Add a new method all_depends().

------------------------------------------------------------------------
r293 | knu | 2001-08-19 23:31:56 +0900 (Sun, 19 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Simplify sort().

------------------------------------------------------------------------
r292 | knu | 2001-08-19 23:20:04 +0900 (Sun, 19 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/tsort.rb
   M /trunk/tsort.rb

Exclude nil.

------------------------------------------------------------------------
r291 | knu | 2001-08-19 18:13:12 +0900 (Sun, 19 Aug 2001) | 11 lines
Changed paths:
   M /trunk/lib/portinfo.rb
   M /trunk/lib/portsdb.rb
   M /trunk/portinfo.rb
   M /trunk/portsdb.rb

Add some new utility methods:
  PortsDB#abs_ports_dir
  PortsDB#portdir
  PortsDB#exists?
  PortsDB#strip
  PortsDB#masters

  PortInfo#portdir
  PortInfo#exists?
  PortInfo#masters

------------------------------------------------------------------------
r290 | knu | 2001-08-19 08:52:03 +0900 (Sun, 19 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Do not clobber the INDEX file until the new one is ready.

------------------------------------------------------------------------
r289 | knu | 2001-08-19 06:26:29 +0900 (Sun, 19 Aug 2001) | 7 lines
Changed paths:
   M /trunk/pkgdepfix

Implement an origin duplicates fixer (only invoked when -o is
specified), and when it fixes one restart the whole session.

Split the huge loop block into procedures.

Make the cyclic dependencies fixer a bit more intelligent.

------------------------------------------------------------------------
r288 | knu | 2001-08-18 22:54:37 +0900 (Sat, 18 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Fix a typo.
[Submitted by: Dirk Froemberg <dirk@freebsd.org>]

------------------------------------------------------------------------
r287 | knu | 2001-08-18 22:43:21 +0900 (Sat, 18 Aug 2001) | 6 lines
Changed paths:
   M /trunk/bin/portcvsweb
   M /trunk/portcvsweb

Conform to the Secure BROWSER (SB) Specification proposed by David
A. Wheeler.

cf.	http://www.dwheeler.com/browse/secure_browser.html
	http://www.tuxedo.org/~esr/BROWSER/

------------------------------------------------------------------------
r286 | knu | 2001-08-18 18:55:21 +0900 (Sat, 18 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgtools.rb
   M /trunk/pkg_glob
   M /trunk/pkgtools.rb
   M /trunk/portupgrade

Change the report format.

Always show Makefile errors, regardless of -v.

------------------------------------------------------------------------
r285 | knu | 2001-08-18 18:10:48 +0900 (Sat, 18 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Refix the -N fix.

------------------------------------------------------------------------
r284 | knu | 2001-08-18 17:56:58 +0900 (Sat, 18 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Add back the -j4 which removal I committed by mistake.

------------------------------------------------------------------------
r283 | knu | 2001-08-18 17:54:07 +0900 (Sat, 18 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Listing successfully done packages is not a warning.

------------------------------------------------------------------------
r282 | knu | 2001-08-18 17:22:01 +0900 (Sat, 18 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Unbreak portinstall (portupgrade -N).

Mention PORTS_INDEX in the help screen.

------------------------------------------------------------------------
r281 | knu | 2001-08-18 17:21:31 +0900 (Sat, 18 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portsdb
   M /trunk/portversion

Mention environment variables in the help screens.

------------------------------------------------------------------------
r280 | knu | 2001-08-18 17:20:47 +0900 (Sat, 18 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/lib/portsdb.rb
   M /trunk/pkgdepfix.1
   M /trunk/portsdb.1
   M /trunk/portsdb.rb
   M /trunk/portupgrade.1

Make the location of the INDEX file configurable via the environment
variable PORTS_INDEX.

------------------------------------------------------------------------
r279 | knu | 2001-08-18 03:50:33 +0900 (Sat, 18 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Unbreak `portversion -t'.

------------------------------------------------------------------------
r278 | knu | 2001-08-17 20:30:26 +0900 (Fri, 17 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Fix a bug introced in the last version - check if dep is empty before
pushing it into an array.

------------------------------------------------------------------------
r277 | knu | 2001-08-17 16:26:30 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Complete a file for -L.

------------------------------------------------------------------------
r276 | knu | 2001-08-17 16:25:18 +0900 (Fri, 17 Aug 2001) | 7 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug where it didn't show build error description properly.

Update error messages and add `interrupted by user' and `permission
denied'.

Do not save zero-sized log files.

------------------------------------------------------------------------
r275 | knu | 2001-08-17 15:38:05 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkg_glob
   M /trunk/portupgrade
   M /trunk/portversion

Properly handle regular expression errors.

------------------------------------------------------------------------
r274 | knu | 2001-08-17 15:26:00 +0900 (Fri, 17 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix the glob expander to exclude not installed packages recorded in
+CONTENTS and +REQUIRED_BY files.

Fix a bug where 'portupgrade -aE' raises an error.

------------------------------------------------------------------------
r273 | knu | 2001-08-17 15:24:27 +0900 (Fri, 17 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Fix the glob expander to exclude not installed packages recorded in
+CONTENTS and +REQUIRED_BY files.

Fix a bug where `portversion -E' raises an error.

------------------------------------------------------------------------
r272 | knu | 2001-08-17 15:20:59 +0900 (Fri, 17 Aug 2001) | 7 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Fix the glob expander to exclude not installed packages recorded in
+CONTENTS and +REQUIRED_BY files.

Properly define a signal handler.

Show a better report.

------------------------------------------------------------------------
r271 | knu | 2001-08-17 15:17:51 +0900 (Fri, 17 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Tru doing make INDEX when no INDEX file is present.  If it fails,
raise an exception.

------------------------------------------------------------------------
r270 | knu | 2001-08-17 15:13:55 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

New common routines: pkg_recurse() and show_results().

------------------------------------------------------------------------
r269 | knu | 2001-08-17 08:08:11 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/misc/zsh/_portversion
   M /trunk/portversion
   M /trunk/portversion.1

Support -r/-R/-x as other tools do.

------------------------------------------------------------------------
r268 | knu | 2001-08-17 08:07:34 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Remove unnecessary lines.

------------------------------------------------------------------------
r267 | knu | 2001-08-17 08:06:45 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_portupgrade

Sort, fix a typo.

------------------------------------------------------------------------
r266 | knu | 2001-08-17 07:23:14 +0900 (Fri, 17 Aug 2001) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Add a new option: -L/--log-prefix, with which a user can save a build
& installation log file for each port/package.

Introduce the exception-based error handling method.

Show a concise and helpful message for each upgrading error.  It now
autoatically guesses the reason of each failure using the same
algorithm that Ports Wraith's processlogs script uses.

------------------------------------------------------------------------
r265 | knu | 2001-08-17 06:25:59 +0900 (Fri, 17 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add more utility methods.

------------------------------------------------------------------------
r264 | knu | 2001-08-16 04:28:29 +0900 (Thu, 16 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

This library shouldn't emit messages to stdout, since it is annoying
to see the messages in the output of `portversion -c > script', etc.

------------------------------------------------------------------------
r263 | knu | 2001-08-16 04:26:02 +0900 (Thu, 16 Aug 2001) | 2 lines
Changed paths:
   D /trunk/pkg_glob.sh
   D /trunk/portsdb_bdb.rb
   D /trunk/portsdb_dbm.rb

Delete obsolete files.

------------------------------------------------------------------------
r262 | knu | 2001-08-16 02:29:57 +0900 (Thu, 16 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

portupgrade no longer needs -cC.

------------------------------------------------------------------------
r261 | knu | 2001-08-16 02:08:53 +0900 (Thu, 16 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Mention --use-packages-only.

------------------------------------------------------------------------
r260 | knu | 2001-08-16 02:00:54 +0900 (Thu, 16 Aug 2001) | 11 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Turn -c/--clean and -C/--cleanup on by default.
[Suggested by: Ian Dowse <iedowse@maths.tcd.ie>}

Now that -c/--clean is on by default, -Fc no longer means fetch-only +
do distclean before each fetch.  Instead, a new option -D/--distclean
is added which can be used with or without -F/--fetch.

Add new options -w/--noclean and -W/--nocleanup.

Always do `make clean-depends' before building dependent ports.

------------------------------------------------------------------------
r259 | knu | 2001-08-15 22:47:02 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/misc/zsh/_pkg_glob
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion

Add -E.

------------------------------------------------------------------------
r258 | knu | 2001-08-15 20:38:28 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Standardize the terms: "pkgname glob" "portorigin glob"

------------------------------------------------------------------------
r257 | knu | 2001-08-15 20:35:43 +0900 (Wed, 15 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/portsdb
   M /trunk/portsdb.1

Add -E/--regex, which makes the command treat globs as extended
regular expressions.

------------------------------------------------------------------------
r256 | knu | 2001-08-15 20:30:29 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Put -h at the top of the help screen.

------------------------------------------------------------------------
r255 | knu | 2001-08-15 20:29:31 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Update.

------------------------------------------------------------------------
r254 | knu | 2001-08-15 20:23:36 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Oops, the last commit was made too early.  Really implement -E.

------------------------------------------------------------------------
r253 | knu | 2001-08-15 20:19:18 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1

Update.

------------------------------------------------------------------------
r252 | knu | 2001-08-15 20:01:03 +0900 (Wed, 15 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion
   M /trunk/bin/portversion.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1
   M /trunk/portversion
   M /trunk/portversion.1

Add -E/--regex which makes the command treat glob patterns as extended
regular expressions.

------------------------------------------------------------------------
r251 | knu | 2001-08-15 19:53:58 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Readd long options.

------------------------------------------------------------------------
r250 | knu | 2001-08-15 19:35:24 +0900 (Wed, 15 Aug 2001) | 5 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/pkg_glob

Add a new option -E/--regex that makes pkg_glob/pkg_deinstall
interpret given globs as extended regular expressions.

Fix usage and help.

------------------------------------------------------------------------
r249 | knu | 2001-08-15 19:33:04 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Enhance glob() to accept a regexp.

------------------------------------------------------------------------
r248 | knu | 2001-08-15 06:51:27 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb
   M /trunk/tests/test_pkginfo.rb

Make PkgInfo#match?() accept a Regexp.

------------------------------------------------------------------------
r247 | knu | 2001-08-15 06:50:45 +0900 (Wed, 15 Aug 2001) | 2 lines
Changed paths:
   M /trunk/runtest.sh

Set PORTSDIR=/usr/ports.

------------------------------------------------------------------------
r246 | knu | 2001-08-15 06:45:21 +0900 (Wed, 15 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/portversion.1

Show some concrete examples of pkg_glob patterns in the pkg_glob(1)
manpage.

------------------------------------------------------------------------
r245 | knu | 2001-08-15 06:14:48 +0900 (Wed, 15 Aug 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Rewrite the WARNING section and mention pkgdepfix(1) in it.
[Suggested by:	Ian Dowse <iedowse@maths.tcd.ie>]

------------------------------------------------------------------------
r244 | knu | 2001-08-14 05:28:56 +0900 (Tue, 14 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/pkgdepfix.1

Update for pkgdepfix(1).

------------------------------------------------------------------------
r243 | knu | 2001-08-14 05:27:02 +0900 (Tue, 14 Aug 2001) | 2 lines
Changed paths:
   M /trunk/runtest.sh

Invoke runtest with `ruby -I.'.

------------------------------------------------------------------------
r242 | knu | 2001-08-14 05:26:15 +0900 (Tue, 14 Aug 2001) | 2 lines
Changed paths:
   A /trunk/tests/test_tsort.rb

Add a basic test suite for tsort.rb.

------------------------------------------------------------------------
r241 | knu | 2001-08-14 05:05:13 +0900 (Tue, 14 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portcvsweb
   M /trunk/bin/portsclean
   M /trunk/bin/portsdb
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkg_glob
   M /trunk/portcvsweb
   M /trunk/portsclean
   M /trunk/portsdb
   M /trunk/portupgrade
   M /trunk/portversion

Add `-*- ruby -*-' keywords for enscript.

------------------------------------------------------------------------
r240 | knu | 2001-08-14 05:04:27 +0900 (Tue, 14 Aug 2001) | 4 lines
Changed paths:
   M /trunk/pkgdepfix

Enhance input_* functions to accept some arguments.

Implement the cyclic dependencies fixer.

------------------------------------------------------------------------
r239 | knu | 2001-08-14 03:54:45 +0900 (Tue, 14 Aug 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Don't emit a confusing message "Cannot update the ports DB!" on a
recoverable error.

------------------------------------------------------------------------
r238 | knu | 2001-08-14 03:53:15 +0900 (Tue, 14 Aug 2001) | 9 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/tsort.rb
   M /trunk/pkgdb.rb
   M /trunk/tsort.rb

* Reverse the meaning/order of the arguments of TSort#add() to
  coincide the implementation with the document.

* Fix a bug where it cannot always cope with a cyclic dependency.
  [Reported by: Fritz Heinrichmeyer <jfh@jfh00.fernuni-hagen.de>]

* Allow the block given to tsort!() to specify an index to indicate
  where to unlink the cycle.

------------------------------------------------------------------------
r237 | knu | 2001-08-12 04:49:09 +0900 (Sun, 12 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean.1
   M /trunk/portsclean.1

Reword.

------------------------------------------------------------------------
r236 | knu | 2001-08-12 04:48:52 +0900 (Sun, 12 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r235 | knu | 2001-08-12 04:38:55 +0900 (Sun, 12 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portcvsweb.1
   M /trunk/portcvsweb.1

Reword.

------------------------------------------------------------------------
r234 | knu | 2001-08-12 02:17:11 +0900 (Sun, 12 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Update.

------------------------------------------------------------------------
r233 | knu | 2001-08-12 01:24:10 +0900 (Sun, 12 Aug 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Do not call update_db() from update() explicitly.

------------------------------------------------------------------------
r232 | knu | 2001-08-11 19:09:57 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Rescue File.unlink failure.

------------------------------------------------------------------------
r231 | knu | 2001-08-11 19:07:37 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Support the "MD5 (file) = IGNORE" case.

------------------------------------------------------------------------
r230 | knu | 2001-08-11 18:15:22 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_portsclean

Add a zsh compdef for portsclean(1).

------------------------------------------------------------------------
r229 | knu | 2001-08-11 18:12:34 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install new files.

------------------------------------------------------------------------
r228 | knu | 2001-08-11 18:12:15 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   A /trunk/bin/portcvsweb
   A /trunk/bin/portcvsweb.1
   A /trunk/portcvsweb
   A /trunk/portcvsweb.1

Add a new tool: portcvsweb(1).

------------------------------------------------------------------------
r227 | knu | 2001-08-11 17:50:18 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   A /trunk/bin/portsclean.1
   A /trunk/portsclean.1

Add the portsclean(1) manpage.

------------------------------------------------------------------------
r226 | knu | 2001-08-11 17:46:55 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob.1
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/bin/portversion.1
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob.1
   M /trunk/portsdb.1
   M /trunk/portupgrade.1
   M /trunk/portversion.1

Add a cross reference to ports(7).

------------------------------------------------------------------------
r225 | knu | 2001-08-11 17:32:19 +0900 (Sat, 11 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Rewrite in Ruby and implement the distfiles cleaner.

------------------------------------------------------------------------
r224 | knu | 2001-08-11 17:31:31 +0900 (Sat, 11 Aug 2001) | 12 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Show a progress message while updating INDEX.*.

Record version information into INDEX.rdo.

Record category information into INDEX.rdo and enhance the API
accordingly.

Introduce the automatic PORTS_DBDIR selector.  Now it will use
whichever writable directory in the following ones: $PORTS_DBDIR,
$PORTS_DIR, /usr/ports, $PKG_DBDIR, /var/db/pkg, $TMPDIR, /var/tmp,
/tmp (checked in the order named)

------------------------------------------------------------------------
r223 | knu | 2001-08-10 00:12:46 +0900 (Fri, 10 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Mention PORTS_DBDIR in the help screen.

------------------------------------------------------------------------
r222 | knu | 2001-08-09 07:19:03 +0900 (Thu, 09 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Utilize $tmpdir properly for pkg_tarup.

Add a notice regarding the disk space for backup files.

------------------------------------------------------------------------
r221 | knu | 2001-08-09 06:48:49 +0900 (Thu, 09 Aug 2001) | 13 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/lib/pkgdb.rb
   M /trunk/misc/zsh/_portupgrade
   M /trunk/pkgdb.rb
   M /trunk/portupgrade
   M /trunk/portupgrade.1

Make portupgrade use pkg_deinstall instead of pkg_delete, to utilize
its -P option.

Now portupgrade always uninstalls old packages, but preserves shared
libraries by default.  The -u option has been changed to mean "Do not
preserve old shared libraries".  Note, however, that its behavior is
the same as before, it is just the default behavior that has been
changed.

With this change, portupgrade no longer leaves extra garbage even if
you don't specify -u, but only old versions of shared libraries for
safety. :)

------------------------------------------------------------------------
r220 | knu | 2001-08-09 06:29:09 +0900 (Thu, 09 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/pkg_deinstall.1

Mention -P.

------------------------------------------------------------------------
r219 | knu | 2001-08-09 06:11:33 +0900 (Thu, 09 Aug 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkg_deinstall

Fix typoes.

------------------------------------------------------------------------
r218 | knu | 2001-08-09 05:43:30 +0900 (Thu, 09 Aug 2001) | 9 lines
Changed paths:
   M /trunk/bin/pkg_deinstall.1
   M /trunk/bin/pkg_glob
   M /trunk/misc/zsh/_pkg_deinstall
   M /trunk/pkg_deinstall.1
   M /trunk/pkg_glob

Bring in most of the options of pkg_delete(1) to pkg_deinstall.

New option: `-P', which preserves shared libraries.

List failed packages if any.

Obsolete GNU style long options, which take space and would only
rarely be used.

------------------------------------------------------------------------
r217 | knu | 2001-08-09 05:13:00 +0900 (Thu, 09 Aug 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Enhance subst_file():
  - Take an optional argument `backup_file' and back up if specified.
  - Return an array of changed lines instead of returning the number
    of changed lines.
  - Invoke /bin/cp and /bin/mv commands with the `-f' option.

------------------------------------------------------------------------
r216 | knu | 2001-08-02 17:05:10 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Show errors properly.

------------------------------------------------------------------------
r215 | knu | 2001-08-02 17:01:01 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/pkg_glob
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/pkg_glob
   M /trunk/pkgdb.rb
   M /trunk/pkginfo.rb
   M /trunk/portupgrade

Call pkg_* commands in fullpaths.

------------------------------------------------------------------------
r214 | knu | 2001-08-02 14:12:20 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Put better comments.

------------------------------------------------------------------------
r213 | knu | 2001-08-02 14:05:59 +0900 (Thu, 02 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb
   M /trunk/portsclean

Show the least message of what is going on.

Use $(..) instead of `..` for better readability.

------------------------------------------------------------------------
r212 | knu | 2001-08-02 13:58:07 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsclean
   M /trunk/portsclean

Make more fail-safe.

------------------------------------------------------------------------
r211 | knu | 2001-08-02 03:58:01 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/README

Mention portsclean.

------------------------------------------------------------------------
r210 | knu | 2001-08-02 03:56:50 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install portsclean too.

------------------------------------------------------------------------
r209 | knu | 2001-08-02 03:56:27 +0900 (Thu, 02 Aug 2001) | 2 lines
Changed paths:
   A /trunk/bin/portsclean
   A /trunk/portsclean

Add portsclean command which cleans all the ports working directories.

------------------------------------------------------------------------
r208 | knu | 2001-08-01 04:38:22 +0900 (Wed, 01 Aug 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/portupgrade
   M /trunk/portversion

When -s is specified, build and install FETCH_DEPENDS, BUILD_DEPENDS
and LIB_DEPENDS ports with sudo. (or only FETCH_DEPENDS if -F is
specified)

------------------------------------------------------------------------
r207 | knu | 2001-07-31 00:28:36 +0900 (Tue, 31 Jul 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Don't let prompt_yesno() and prompt_yesno die even if a user inputs an
EOF (^D).

------------------------------------------------------------------------
r206 | knu | 2001-07-30 19:59:06 +0900 (Mon, 30 Jul 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portversion

Synchronize.

------------------------------------------------------------------------
r205 | knu | 2001-07-30 19:56:56 +0900 (Mon, 30 Jul 2001) | 3 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Do not immediately fail in error when it finds an error in the INDEX
file, but skip the line and continue.

------------------------------------------------------------------------
r204 | knu | 2001-07-30 19:55:28 +0900 (Mon, 30 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/portsdb

Sort options in usage.

------------------------------------------------------------------------
r203 | knu | 2001-07-30 18:38:57 +0900 (Mon, 30 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion.1
   M /trunk/portversion.1

Update.

------------------------------------------------------------------------
r202 | knu | 2001-07-30 18:36:02 +0900 (Mon, 30 Jul 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Now that we have portsdb(1) and pkgdepfix(1) with -o option, give up
running `make -V PKGNAME' for each pkg's origin and just utilize the
portsdb.  This makes it run several times faster!

------------------------------------------------------------------------
r201 | knu | 2001-07-30 18:33:21 +0900 (Mon, 30 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Update.

------------------------------------------------------------------------
r200 | knu | 2001-07-29 21:53:09 +0900 (Sun, 29 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Update.

------------------------------------------------------------------------
r199 | knu | 2001-07-29 21:50:37 +0900 (Sun, 29 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

On an installation failure, restore the rewritten dependencies too.

------------------------------------------------------------------------
r198 | knu | 2001-07-27 23:50:49 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Fix more.

------------------------------------------------------------------------
r197 | knu | 2001-07-27 21:07:25 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Fix TECHNICAL DETAILS a bit.

------------------------------------------------------------------------
r196 | knu | 2001-07-27 15:35:28 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/portsdb.1

Remove a nonexistent option from SYNOPSIS.

------------------------------------------------------------------------
r195 | knu | 2001-07-27 04:15:24 +0900 (Fri, 27 Jul 2001) | 3 lines
Changed paths:
   M /trunk/bin/pkg_glob.1
   M /trunk/pkg_glob.1

Mention that the output list is automatically sorted in dependency
order.

------------------------------------------------------------------------
r194 | knu | 2001-07-27 04:10:15 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Fix a bogon.

------------------------------------------------------------------------
r193 | knu | 2001-07-27 04:06:12 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install the pkg_deinstall(1) manpage, really.

------------------------------------------------------------------------
r192 | knu | 2001-07-27 03:55:46 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/README

Mention pkg_glob and pkg_deinstall.

------------------------------------------------------------------------
r191 | knu | 2001-07-27 03:49:23 +0900 (Fri, 27 Jul 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Move the PORTUPGRADE paragraph from FILES to ENVIRONMENT.

Add pkg_deinstall(1), pkg_glob(1) and pkg_update(1) to SEE ALSO.

------------------------------------------------------------------------
r190 | knu | 2001-07-27 03:47:41 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install pkg_glob, pkg_deinstall and their manpages.

------------------------------------------------------------------------
r189 | knu | 2001-07-27 03:46:22 +0900 (Fri, 27 Jul 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Utilize optparse's automatic type conversion.

Rescue ArgumentError properly.

------------------------------------------------------------------------
r188 | knu | 2001-07-27 03:38:49 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   A /trunk/bin/pkg_deinstall.1
   A /trunk/bin/pkg_glob.1
   A /trunk/pkg_deinstall.1
   A /trunk/pkg_glob.1

Add manpages for pkg_glob and pkg_deinstall.

------------------------------------------------------------------------
r187 | knu | 2001-07-27 03:38:14 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_pkg_deinstall
   A /trunk/misc/zsh/_pkg_glob

Add zsh compdef's for pkg_glob and pkg_deinstall.

------------------------------------------------------------------------
r186 | knu | 2001-07-27 03:35:58 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   A /trunk/bin/pkg_glob
   A /trunk/pkg_glob

New commands: pkg_glob and pkg_deinstall. (in one file)

------------------------------------------------------------------------
r185 | knu | 2001-07-27 03:34:44 +0900 (Fri, 27 Jul 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

-a and -r/-R are exclusive.

------------------------------------------------------------------------
r184 | knu | 2001-07-14 17:05:14 +0900 (Sat, 14 Jul 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgdepfix
   M /trunk/misc/zsh/_portupgrade
   M /trunk/misc/zsh/_portversion

Improve zsh compdefs.

------------------------------------------------------------------------
r183 | knu | 2001-07-14 16:40:26 +0900 (Sat, 14 Jul 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Fix manpage.
[Submitted by: Sean Chittenden <sean@chittenden.org>]

------------------------------------------------------------------------
r182 | knu | 2001-07-03 14:26:33 +0900 (Tue, 03 Jul 2001) | 8 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/bin/portsdb.1
   M /trunk/bin/portupgrade.1
   M /trunk/lib/portsdb.rb
   M /trunk/pkgdepfix.1
   M /trunk/portsdb
   M /trunk/portsdb.1
   M /trunk/portsdb.rb
   M /trunk/portupgrade.1

Introduce a new environment variable PORTS_DBDIR, which specifies an
alternative ports database directory.  This is useful if /usr/ports is
on a readonly filesystem.
[Requirested by: Makoto MATSUSHITA <matusita@jp.freebsd.org>]

Warn and abort the update if PORTS_DBDIR is not writable instead of
fail in error.

------------------------------------------------------------------------
r181 | knu | 2001-07-03 14:22:52 +0900 (Tue, 03 Jul 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Compress manpages.

------------------------------------------------------------------------
r180 | knu | 2001-06-27 01:51:43 +0900 (Wed, 27 Jun 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_pkgdepfix
   M /trunk/misc/zsh/_portversion

Make these zsh compdefs aware of environment variables.

------------------------------------------------------------------------
r179 | knu | 2001-06-27 01:49:16 +0900 (Wed, 27 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb.1
   M /trunk/bin/portversion.1
   M /trunk/pkgdepfix.1
   M /trunk/portsdb.1
   M /trunk/portversion.1

Supply missing .El's.

------------------------------------------------------------------------
r178 | knu | 2001-06-27 00:04:29 +0900 (Wed, 27 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade.1
   M /trunk/portupgrade.1

Update & supply missing .El's.

------------------------------------------------------------------------
r177 | knu | 2001-06-26 22:00:52 +0900 (Tue, 26 Jun 2001) | 19 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Slightly enhance the behaviors of some options:

  -x/--exclude:

    When -r or -R is specified, exclude the matching packages _after_
    expanding dependent packages.  Now one can upgrade all the
    packages depending on `foo', not including `foo' by the following
    command:

	portupgrade -x foo -r foo

  -B/--beforebuild:

    If the given command exits in failure, then the port/package is
    skipped.  For instance, one can upgrade all the packages except
    IS_INTERACTIVE ones by the following command:

	portupgrade -aB 'test ! `make -V IS_INTERACTIVE`'

------------------------------------------------------------------------
r176 | knu | 2001-06-22 22:58:57 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/portupgrade
   M /trunk/portversion

More fixes against messages.

------------------------------------------------------------------------
r175 | knu | 2001-06-22 22:39:45 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portupgrade
   M /trunk/portversion

Usages are not warnings.

------------------------------------------------------------------------
r174 | knu | 2001-06-22 21:21:55 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb
   M /trunk/portupgrade

Move the dependency sorter to the PkgDB class. (PkgDB#sort)

------------------------------------------------------------------------
r173 | knu | 2001-06-22 21:21:20 +0900 (Fri, 22 Jun 2001) | 3 lines
Changed paths:
   A /trunk/pkg_glob.sh

Add pkg_glob.sh, an experimental Bourne shell implementation of
pkg_glob.

------------------------------------------------------------------------
r172 | knu | 2001-06-22 19:35:54 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Emit better messages.

------------------------------------------------------------------------
r171 | knu | 2001-06-22 19:34:09 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portversion

Use warning_message().

------------------------------------------------------------------------
r170 | knu | 2001-06-22 19:25:43 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portversion

Cosmetic. (pkg.to_s -> pkg.fullname)

------------------------------------------------------------------------
r169 | knu | 2001-06-22 19:24:54 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Add warning_message().

------------------------------------------------------------------------
r168 | knu | 2001-06-22 02:41:10 +0900 (Fri, 22 Jun 2001) | 4 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Respect PORTSDIR/PKG_DBDIR.

Complete port origins for portinstall and portupgrade -N.

------------------------------------------------------------------------
r167 | knu | 2001-06-22 01:50:09 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Detect package name change and emit a warning.

------------------------------------------------------------------------
r166 | knu | 2001-06-22 01:48:24 +0900 (Fri, 22 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/portsdb.rb
   M /trunk/pkginfo.rb
   M /trunk/portsdb.rb

Now Ruby 1.7 has fnmatch out-of-the-box.

------------------------------------------------------------------------
r165 | knu | 2001-06-20 01:31:42 +0900 (Wed, 20 Jun 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

D'oh, fix a wrong message. ("#{newpkgname} is already installed" =>
"#{oldpkgname} is already installed")

------------------------------------------------------------------------
r164 | knu | 2001-06-17 20:40:05 +0900 (Sun, 17 Jun 2001) | 4 lines
Changed paths:
   M /trunk/install.rb

Fix an installation problem.

Submitted by:	Jimmy Olgeni <olgeni@FreeBSD.org>

------------------------------------------------------------------------
r163 | knu | 2001-06-17 19:12:59 +0900 (Sun, 17 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Reword.

------------------------------------------------------------------------
r162 | knu | 2001-06-17 15:50:01 +0900 (Sun, 17 Jun 2001) | 8 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/bin/portupgrade.1
   M /trunk/install.rb
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade
   M /trunk/portupgrade.1

portupgrade: Add a new option: -N/--new.  If it is specified,
portupgrade installs a new one when a specified package is not
installed.

portinstall: New command equivalent to `portupgrade -N'.  You can
specify a port origin to name the one you want to install, too:
e.g. `portinstall shells/zsh'

------------------------------------------------------------------------
r161 | knu | 2001-06-17 15:38:50 +0900 (Sun, 17 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

s/Ok/OK/

------------------------------------------------------------------------
r160 | knu | 2001-06-15 18:22:40 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   D /trunk/tests/test_pkgname.rb

Obsoleted.

------------------------------------------------------------------------
r159 | knu | 2001-06-15 18:22:06 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install manpages.

------------------------------------------------------------------------
r158 | knu | 2001-06-15 18:21:55 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Now that there are manpages, remove detailed usages from README.

------------------------------------------------------------------------
r157 | knu | 2001-06-15 18:21:00 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Update the usage instruction.

------------------------------------------------------------------------
r156 | knu | 2001-06-15 18:20:31 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   A /trunk/bin/portversion.1
   A /trunk/portversion.1

Add portversion(1) manpage.

------------------------------------------------------------------------
r155 | knu | 2001-06-15 17:31:42 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   A /trunk/bin/portupgrade.1
   A /trunk/portupgrade.1

Add portupgrade(1) manpage.

------------------------------------------------------------------------
r154 | knu | 2001-06-15 17:31:19 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   A /trunk/bin/portsdb.1
   A /trunk/portsdb.1

Add portsdb(1) manpage.

------------------------------------------------------------------------
r153 | knu | 2001-06-15 17:26:02 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Check for PKG_TMPDIR prior to TMPDIR.

------------------------------------------------------------------------
r152 | knu | 2001-06-15 17:25:17 +0900 (Fri, 15 Jun 2001) | 4 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/portsdb

Rename --update to --updateindex, --updatedb to --update.

Implement a simple lookup feature: glob expansion.

------------------------------------------------------------------------
r151 | knu | 2001-06-15 17:24:02 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Update the usage instruction.

------------------------------------------------------------------------
r150 | knu | 2001-06-15 17:21:13 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   A /trunk/pkgdepfix.1

Add pkgdepfix(1) manpage.

------------------------------------------------------------------------
r149 | knu | 2001-06-15 17:19:05 +0900 (Fri, 15 Jun 2001) | 4 lines
Changed paths:
   M /trunk/pkgdepfix

Correct the usage instruction.

Introduce -s option instead of barely putting two arguments.

------------------------------------------------------------------------
r148 | knu | 2001-06-15 12:29:57 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb
   M /trunk/portinfo.rb

Make it comparable.

------------------------------------------------------------------------
r147 | knu | 2001-06-15 03:43:40 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   D /trunk/pkgname.rb

This is no longer needed.  Use PkgInfo instead.

------------------------------------------------------------------------
r146 | knu | 2001-06-15 03:37:43 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/lib/portinfo.rb
   M /trunk/pkginfo.rb
   M /trunk/portinfo.rb

Properly require DB modules.

------------------------------------------------------------------------
r145 | knu | 2001-06-15 03:34:29 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Use singleton objects.

------------------------------------------------------------------------
r144 | knu | 2001-06-15 03:34:11 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Utilize PortsDB#glob.

------------------------------------------------------------------------
r143 | knu | 2001-06-15 03:33:40 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Use PkgInfo methods instead of PkgDB methods.

------------------------------------------------------------------------
r142 | knu | 2001-06-15 03:31:29 +0900 (Fri, 15 Jun 2001) | 5 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb

Make it singleton.

Create an indices file in addition to a DBM table file for faster
search, and make yet more improvements to get it faster.

------------------------------------------------------------------------
r141 | knu | 2001-06-15 03:28:22 +0900 (Fri, 15 Jun 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Provide some useful methods with the help of the singleton PkgDB
object.

------------------------------------------------------------------------
r140 | knu | 2001-06-15 03:20:01 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Make it singleton.

------------------------------------------------------------------------
r139 | knu | 2001-06-15 03:19:22 +0900 (Fri, 15 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Cleanup.

------------------------------------------------------------------------
r138 | knu | 2001-06-14 16:13:39 +0900 (Thu, 14 Jun 2001) | 2 lines
Changed paths:
   M /trunk/portsdb_bdb.rb

Make it a subclass of PortsDBM.

------------------------------------------------------------------------
r137 | knu | 2001-06-14 16:12:54 +0900 (Thu, 14 Jun 2001) | 2 lines
Changed paths:
   M /trunk/portsdb_dbm.rb

Copy portsdb.rb to portsdb_dbm.rb.

------------------------------------------------------------------------
r136 | knu | 2001-06-14 15:58:58 +0900 (Thu, 14 Jun 2001) | 6 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb
   M /trunk/portsdb_dbm.rb

Show a line number on error.

Add new methods: each_origin(), each_pkgname(), and glob().

Obsolete each_port().

------------------------------------------------------------------------
r135 | knu | 2001-06-14 15:56:54 +0900 (Thu, 14 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/portinfo.rb
   M /trunk/portinfo.rb

Add a new method: match?().

------------------------------------------------------------------------
r134 | knu | 2001-06-14 15:56:29 +0900 (Thu, 14 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add a shortcut to glob().

------------------------------------------------------------------------
r133 | knu | 2001-06-11 06:05:09 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portversion
   M /trunk/portversion

Remvoe -s from portupgrade options in the portversion -c output.

------------------------------------------------------------------------
r132 | knu | 2001-06-11 05:34:15 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Oops.

------------------------------------------------------------------------
r131 | knu | 2001-06-11 05:21:36 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Describe a bit about portsdb.

------------------------------------------------------------------------
r130 | knu | 2001-06-11 05:14:26 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/misc/zsh/_pkgdepfix
   M /trunk/misc/zsh/_portupgrade

Update.

------------------------------------------------------------------------
r129 | knu | 2001-06-11 05:12:34 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install portsdb as well.

------------------------------------------------------------------------
r128 | knu | 2001-06-11 05:12:03 +0900 (Mon, 11 Jun 2001) | 10 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Sort packages by default and remove -s/--sort.

Rename -y/--yield/-Y/--yield-command to -s/--sudo/-S/--sudo-command.

Implement -a/--all.

Implement -x/--exclude=GLOB.

Exit on OptionParser::ParseError immediately.

------------------------------------------------------------------------
r127 | knu | 2001-06-11 05:09:49 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Exit on OptionParser::ParseError immediately.

------------------------------------------------------------------------
r126 | knu | 2001-06-11 05:09:07 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portsdb
   M /trunk/portsdb

Rescue OptionParser::ParseError.

------------------------------------------------------------------------
r125 | knu | 2001-06-11 05:07:56 +0900 (Mon, 11 Jun 2001) | 4 lines
Changed paths:
   M /trunk/pkgdepfix

Implement origin fixer, with intelligent guessing. (-o/--fix-origin)

Make pkgdep guessing more intelligent.

------------------------------------------------------------------------
r124 | knu | 2001-06-11 04:41:24 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb
   M /trunk/portsdb_dbm.rb

Make each iterate a block for each PortInfo.

------------------------------------------------------------------------
r123 | knu | 2001-06-11 03:35:55 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Omit an unnecessary error check.

------------------------------------------------------------------------
r122 | knu | 2001-06-11 03:11:44 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Compare arg with dummy using equal?, not ==.

------------------------------------------------------------------------
r121 | knu | 2001-06-11 03:01:11 +0900 (Mon, 11 Jun 2001) | 6 lines
Changed paths:
   M /trunk/lib/pkgtools.rb
   M /trunk/pkgtools.rb

Rename $yield to $sudo and $yield_args to $sudo_args.

Utilize PkgDB#glob('*', false).

Define matchlen().

------------------------------------------------------------------------
r120 | knu | 2001-06-11 02:58:22 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Use PkgInfo#match? .

------------------------------------------------------------------------
r119 | knu | 2001-06-11 02:57:33 +0900 (Mon, 11 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Add PkgInfo#match?

------------------------------------------------------------------------
r118 | knu | 2001-06-10 16:39:17 +0900 (Sun, 10 Jun 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add an option to glob() that makes it return package names instead of
PkgInfo objects.

------------------------------------------------------------------------
r117 | knu | 2001-06-10 01:52:57 +0900 (Sun, 10 Jun 2001) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Improve -F.

- Now that portupgrade supported -r/-R, we don't need to call make
  fetch-recursive instead of make fetch.

- Specify -DPACKAGE_BUILDING for ports with IS_INTERACTIVE=yes.

  Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r116 | knu | 2001-06-07 12:10:04 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/pkgdepfix
   M /trunk/portupgrade
   M /trunk/portversion

Print the usage to stdout instead of stderr.

------------------------------------------------------------------------
r115 | knu | 2001-06-07 12:05:20 +0900 (Thu, 07 Jun 2001) | 7 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade

Change the meaning of -P/--use-packages.  If specified once, it uses
packages whenever available or uses ports.  If specified twice, it
never try to use ports but only uses packages.

The package directory is now specified via the environment variable,
PKGREPOSITORY and PKGREPOSITORYSUBDIR.

------------------------------------------------------------------------
r114 | knu | 2001-06-07 04:55:47 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   A /trunk/misc/zsh/_pkgdepfix

Add a zsh compdef for pkgdepfix

------------------------------------------------------------------------
r113 | knu | 2001-06-07 04:52:31 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade

Implement -P/--use-packages.

------------------------------------------------------------------------
r112 | knu | 2001-06-07 03:48:10 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Functionalize.

------------------------------------------------------------------------
r111 | knu | 2001-06-07 03:06:58 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Update

------------------------------------------------------------------------
r110 | knu | 2001-06-07 03:06:42 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Complete the prompt message.

------------------------------------------------------------------------
r109 | knu | 2001-06-07 03:02:27 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Add "delete" to the choices as to how to deal with a stale dependency.

------------------------------------------------------------------------
r108 | knu | 2001-06-07 02:12:43 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/install.rb
   A /trunk/lib/pkgtools.rb
   M /trunk/pkgdepfix
   A /trunk/pkgtools.rb
   M /trunk/portupgrade

Move common functions and global variables to pkgtools.rb.

------------------------------------------------------------------------
r107 | knu | 2001-06-07 00:46:51 +0900 (Thu, 07 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Optimize.

------------------------------------------------------------------------
r106 | knu | 2001-06-06 23:45:17 +0900 (Wed, 06 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Restructure a bit.

------------------------------------------------------------------------
r105 | knu | 2001-06-06 22:20:11 +0900 (Wed, 06 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/tsort.rb
   M /trunk/tsort.rb

Avoid using = in a conditional.

------------------------------------------------------------------------
r104 | knu | 2001-06-06 22:14:20 +0900 (Wed, 06 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb

Complete PkgFileInfo.

------------------------------------------------------------------------
r103 | knu | 2001-06-06 16:43:37 +0900 (Wed, 06 Jun 2001) | 4 lines
Changed paths:
   M /trunk/pkgdepfix

Implement automatic guessing.

Add yes-to-all to the choices of yes/no prompt.

------------------------------------------------------------------------
r102 | knu | 2001-06-06 13:19:02 +0900 (Wed, 06 Jun 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Uh oh, backing up +REQUIRED_BY must have been done before pkg_delete.
[Submitted by: SASAKI Katuhiro <sahiro@vanilla.freemail.ne.jp>]

------------------------------------------------------------------------
r101 | knu | 2001-06-06 04:59:13 +0900 (Wed, 06 Jun 2001) | 2 lines
Changed paths:
   M /trunk/pkgdepfix

Do "stty sane" on interrupt.

------------------------------------------------------------------------
r100 | knu | 2001-06-06 02:28:04 +0900 (Wed, 06 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/install.rb

pkgdepfix is added.

------------------------------------------------------------------------
r99 | knu | 2001-06-06 02:18:09 +0900 (Wed, 06 Jun 2001) | 3 lines
Changed paths:
   A /trunk/pkgdepfix

Add pkgdepfix, a tool for fixing /var/db/pkg's @pkgdep / +REQUIRED_BY
discrepancies.

------------------------------------------------------------------------
r98 | knu | 2001-06-02 14:13:54 +0900 (Sat, 02 Jun 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug that $make_args and $install_target are destroyed during
shellwords(). [Reported by: Tadayuki OKADA <tadayuki@mediaone.net>]

Show privileged commands when portupgrade is invoked by root as well.

------------------------------------------------------------------------
r97 | knu | 2001-06-02 00:11:56 +0900 (Sat, 02 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade

s/priviledge/privilege/g

------------------------------------------------------------------------
r96 | knu | 2001-06-01 21:01:46 +0900 (Fri, 01 Jun 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Replace pkgdep! with pkgdep.

Check for pkgdep's emptiness.

------------------------------------------------------------------------
r95 | knu | 2001-06-01 20:59:23 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Obsolete unneeded pkgdep!.

------------------------------------------------------------------------
r94 | knu | 2001-06-01 20:16:02 +0900 (Fri, 01 Jun 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Use cp instead of mv -f not to preserve the temporary file's owner and
group.

------------------------------------------------------------------------
r93 | knu | 2001-06-01 20:00:56 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Remove version numbers.

------------------------------------------------------------------------
r92 | knu | 2001-06-01 19:59:50 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix Perlism and stop raising a false alarm.  Zero is NOT false, of course!

------------------------------------------------------------------------
r91 | knu | 2001-06-01 18:53:35 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r90 | knu | 2001-06-01 18:51:59 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Make sure to make replaced files world readable.

------------------------------------------------------------------------
r89 | knu | 2001-06-01 12:17:53 +0900 (Fri, 01 Jun 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r88 | knu | 2001-06-01 12:14:50 +0900 (Fri, 01 Jun 2001) | 7 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Properly detect where pkg_tarup has created a tarball.

Backup +REQUIRED_BY a bit earlier, just in case.

If it fails to copy the new +REQUIRED_BY to the package's dbdir, emit
a message and save the file in TMPDIR.

------------------------------------------------------------------------
r87 | knu | 2001-06-01 12:10:19 +0900 (Fri, 01 Jun 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

No need to recurse @pkgdep search, really.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r86 | knu | 2001-06-01 00:22:27 +0900 (Fri, 01 Jun 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a critical bug that +CONTENTS are lost when you do upgrade as root
and TMPDIR and /var/db/pkg are on different filesystems.  Sigh...

------------------------------------------------------------------------
r85 | knu | 2001-05-31 14:18:20 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r84 | knu | 2001-05-31 14:18:06 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Never yield root priviledges unless -y is specified.

------------------------------------------------------------------------
r83 | knu | 2001-05-31 14:10:48 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Sync.

------------------------------------------------------------------------
r82 | knu | 2001-05-31 13:56:11 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update the version number.

------------------------------------------------------------------------
r81 | knu | 2001-05-31 13:55:38 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a typo.

------------------------------------------------------------------------
r80 | knu | 2001-05-31 13:50:58 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update the version number.

------------------------------------------------------------------------
r79 | knu | 2001-05-31 13:49:36 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

More operations need root priviledges.

------------------------------------------------------------------------
r78 | knu | 2001-05-31 12:25:31 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Revise.

------------------------------------------------------------------------
r77 | knu | 2001-05-31 12:16:24 +0900 (Thu, 31 May 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/portupgrade
   M /trunk/portversion

Fix the Makefile/PKGNAME error detection.

Reported by:	Tadayuki OKADA <tadayuki@mediaone.net>

------------------------------------------------------------------------
r76 | knu | 2001-05-31 11:52:06 +0900 (Thu, 31 May 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Implement -y/--yield which yields root priledges where needed.

Implement -Y/--yield-command which specifies the command to yield root
priledges. (default: sudo)

------------------------------------------------------------------------
r75 | knu | 2001-05-31 11:50:10 +0900 (Thu, 31 May 2001) | 2 lines
Changed paths:
   M /trunk/lib/tsort.rb
   M /trunk/tsort.rb

Bring in tsort.rb rev.1.3.

------------------------------------------------------------------------
r74 | knu | 2001-05-30 15:53:53 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update.

------------------------------------------------------------------------
r73 | knu | 2001-05-30 15:53:14 +0900 (Wed, 30 May 2001) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug that -s/--sort didn't work.  D'oh!

Make -u/--uninstall fail-safe.  It backs up old installations with the
help of pkg_tarup and restores on installation failure.

Show option errors more gracefully.

Die on signals more gracefully.

------------------------------------------------------------------------
r72 | knu | 2001-05-30 15:51:19 +0900 (Wed, 30 May 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Show option errors more gracefully.

Die on signals more gracefully.

------------------------------------------------------------------------
r71 | knu | 2001-05-30 07:59:28 +0900 (Wed, 30 May 2001) | 4 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug when a package does not have @pkgdep or +REQUIRED_BY.

Reported by:	Jimmy Olgeni <olgeni@uli.it>

------------------------------------------------------------------------
r70 | knu | 2001-05-30 07:15:51 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update versions.

------------------------------------------------------------------------
r69 | knu | 2001-05-30 07:13:02 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/bin/portversion
   M /trunk/portupgrade
   M /trunk/portversion

Redo the possible Makefile breakage report.

------------------------------------------------------------------------
r68 | knu | 2001-05-30 06:48:28 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Get glob(PORTNAME) to work again.

------------------------------------------------------------------------
r67 | knu | 2001-05-30 05:48:01 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/portsdb_bdb.rb

Add an experimental BDB version of portsdb.rb.

------------------------------------------------------------------------
r66 | knu | 2001-05-30 05:45:59 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   A /trunk/bin/portsdb
   A /trunk/portsdb

Add portsdb. (not to be used yet)

------------------------------------------------------------------------
r65 | knu | 2001-05-30 05:42:46 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/README

Update the usage.

------------------------------------------------------------------------
r64 | knu | 2001-05-30 05:38:32 +0900 (Wed, 30 May 2001) | 6 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Make cosmetic changes in the usage output.

Make command output optimal by using portupgrade's -s option.

Report possible ports' Makefile breakage.

------------------------------------------------------------------------
r63 | knu | 2001-05-30 04:36:32 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Add -s and -R, and update -r.

------------------------------------------------------------------------
r62 | knu | 2001-05-30 04:35:39 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   M /trunk/install.rb

Install tsort.rb too.

------------------------------------------------------------------------
r61 | knu | 2001-05-30 04:35:12 +0900 (Wed, 30 May 2001) | 10 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Make cosmetic changes in the usage output.

Add -DBATCH to the `make fetch' commandline to prevent ports from
dumbly waiting for user input.  [Suggestion by: Jimmy Olgeni
<olgeni@uli.it>]

Implement -s/--sort and -R/--upward-recursive, and get -r/--recursive
working for upgrading as well. (Finally I did it!)  [Greatly inspired
by and partly obtained from: Jimmy Olgeni <olgeni@uli.it>]

------------------------------------------------------------------------
r60 | knu | 2001-05-30 04:33:11 +0900 (Wed, 30 May 2001) | 2 lines
Changed paths:
   A /trunk/lib/tsort.rb
   A /trunk/tsort.rb

Bring in tsort.rb, a topological sorter class.

------------------------------------------------------------------------
r59 | knu | 2001-05-30 04:12:44 +0900 (Wed, 30 May 2001) | 4 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Implement pkgdep() and pkgdep!().

Use Dir::glob() rather than an ugly hack.

------------------------------------------------------------------------
r58 | knu | 2001-05-18 03:15:36 +0900 (Fri, 18 May 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Support -r.

------------------------------------------------------------------------
r57 | knu | 2001-05-18 01:24:46 +0900 (Fri, 18 May 2001) | 3 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add -r/--recursive which lets --fetch and --package work recursively.
[Inspired by: Jimmy Olgeni <olgeni@uli.it>]

------------------------------------------------------------------------
r56 | knu | 2001-04-21 05:16:08 +0900 (Sat, 21 Apr 2001) | 2 lines
Changed paths:
   M /trunk/README

Update usages.

------------------------------------------------------------------------
r55 | knu | 2001-04-21 05:14:50 +0900 (Sat, 21 Apr 2001) | 6 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Implement -t/--test.

Add BSD-style license notice.

Adjust blank lines in help.

------------------------------------------------------------------------
r54 | knu | 2001-04-21 05:05:14 +0900 (Sat, 21 Apr 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Define and use MYNAME.

------------------------------------------------------------------------
r53 | knu | 2001-04-19 04:38:46 +0900 (Thu, 19 Apr 2001) | 2 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Adjust blank lines in help.

------------------------------------------------------------------------
r52 | knu | 2001-04-19 04:34:42 +0900 (Thu, 19 Apr 2001) | 2 lines
Changed paths:
   M /trunk/README

Update portupgrade usage.

------------------------------------------------------------------------
r51 | knu | 2001-04-19 04:34:12 +0900 (Thu, 19 Apr 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

[Forced commit] Show the revision on help (-h).

------------------------------------------------------------------------
r50 | knu | 2001-04-19 04:32:13 +0900 (Thu, 19 Apr 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add BSD-style license notice.

Do distclean before each fetch if -c is specified with -F.

------------------------------------------------------------------------
r49 | knu | 2001-04-19 01:14:30 +0900 (Thu, 19 Apr 2001) | 2 lines
Changed paths:
   M /trunk/README

Update portupgrade's usage.

------------------------------------------------------------------------
r48 | knu | 2001-04-18 03:36:37 +0900 (Wed, 18 Apr 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Add -F.

------------------------------------------------------------------------
r47 | knu | 2001-04-18 03:35:33 +0900 (Wed, 18 Apr 2001) | 10 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add -F/--fetch option to make dial-up users happy.

Submitted by:	Jimmy Olgeni <olgeni@uli.it>
		(He suggested -e, but I prefered -F)

Show what version a package is upgraded to to help a user decide
whether to upgrade or not.

Submitted by:	Timothy Smith <tim@mysql.com>

------------------------------------------------------------------------
r46 | knu | 2001-03-24 05:23:06 +0900 (Sat, 24 Mar 2001) | 4 lines
Changed paths:
   M /trunk/README

Reword to make it clearer.

Submitted by:	David O'Brien <obrien@FreeBSD.org>

------------------------------------------------------------------------
r45 | knu | 2001-03-23 04:08:33 +0900 (Fri, 23 Mar 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Change the timing of the invocation of the beforebuild command so that
"portupgrade -B'cvs update' foo" works.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r44 | knu | 2001-03-23 04:06:06 +0900 (Fri, 23 Mar 2001) | 4 lines
Changed paths:
   M /trunk/bin/portversion
   M /trunk/portversion

Fix the implication of a '*'. (portversion -v did nothing ;)

Reported by:	Tadayuki OKADA <tadayuki.okada@windriver.com>

------------------------------------------------------------------------
r43 | knu | 2001-03-23 04:04:36 +0900 (Fri, 23 Mar 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Skip packages with illegal names showing an informative message rather
than dying of an error.

Reported by:	Ollivier Robert <roberto@eurocontrol.fr>

------------------------------------------------------------------------
r42 | knu | 2001-03-22 06:13:46 +0900 (Thu, 22 Mar 2001) | 4 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade

Add a couple of new options:
  -A [command to run after each installation]
  -B [command to run before each build]

------------------------------------------------------------------------
r41 | knu | 2001-03-22 05:49:31 +0900 (Thu, 22 Mar 2001) | 2 lines
Changed paths:
   M /trunk/README
   A /trunk/bin/portversion
   M /trunk/install.rb
   A /trunk/misc/zsh/_portversion
   A /trunk/portversion

Add portversion.

------------------------------------------------------------------------
r40 | knu | 2001-03-22 05:43:13 +0900 (Thu, 22 Mar 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Use make(1) arguments specified with -m for "make -V PKGNAME" too.

Ignore the difference of the name parts when it compares the package
versions.

------------------------------------------------------------------------
r39 | knu | 2001-03-22 05:36:24 +0900 (Thu, 22 Mar 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Add a missing closing bracket.

------------------------------------------------------------------------
r38 | knu | 2001-03-21 20:51:25 +0900 (Wed, 21 Mar 2001) | 4 lines
Changed paths:
   M /trunk/README
   M /trunk/bin/portupgrade
   M /trunk/misc/zsh/_portupgrade
   M /trunk/portupgrade

Add -p option. [make package as well when each port is installed]

Sort options in alphabetical order.

------------------------------------------------------------------------
r37 | knu | 2001-03-21 20:50:13 +0900 (Wed, 21 Mar 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Use Dir.entries(dir).each instead of Dir.glob(dir) so it does not hit
the just installed packages.

------------------------------------------------------------------------
r36 | knu | 2001-03-18 22:45:36 +0900 (Sun, 18 Mar 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix a bug when the origin of a package is not found.

Submitted by:	Leif Neland <leifn@neland.dk>

------------------------------------------------------------------------
r35 | knu | 2001-03-18 07:56:10 +0900 (Sun, 18 Mar 2001) | 2 lines
Changed paths:
   M /trunk/README

Describe portupgrade.

------------------------------------------------------------------------
r34 | knu | 2001-03-18 07:22:41 +0900 (Sun, 18 Mar 2001) | 2 lines
Changed paths:
   M /trunk/misc/zsh/_portupgrade

Match with reality. (-d -> -C)

------------------------------------------------------------------------
r33 | knu | 2001-03-18 06:53:14 +0900 (Sun, 18 Mar 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb
   M /trunk/portupgrade

Fix a bogus bug.  D'oh!  +REQUIRED_BY must be read before it is removed!

------------------------------------------------------------------------
r32 | knu | 2001-02-17 02:00:14 +0900 (Sat, 17 Feb 2001) | 2 lines
Changed paths:
   M /trunk/pkgname.rb
   M /trunk/tests/test_pkgname.rb

Add PkgName class, which was repocopied from PkgInfo.

------------------------------------------------------------------------
r31 | knu | 2001-02-15 01:38:12 +0900 (Thu, 15 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Show a proper message when the origin for a port is unknown.

------------------------------------------------------------------------
r30 | knu | 2001-02-14 21:24:30 +0900 (Wed, 14 Feb 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Change -d to -C. (--cleanup)

List failed ports when finished.

------------------------------------------------------------------------
r29 | knu | 2001-02-14 05:18:27 +0900 (Wed, 14 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/portsdb.rb
   M /trunk/portsdb.rb
   M /trunk/portsdb_bdb.rb
   M /trunk/portsdb_dbm.rb

Make PortsDB Enumerable.

------------------------------------------------------------------------
r28 | knu | 2001-02-13 21:53:46 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/tests/test_pkgdb.rb

I'll have to write tests for pkgdb.rb in the future...

------------------------------------------------------------------------
r27 | knu | 2001-02-13 21:51:43 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   A /trunk/misc
   A /trunk/misc/zsh
   A /trunk/misc/zsh/_portupgrade

Add zsh's compdef file for the portupgrade command.

------------------------------------------------------------------------
r26 | knu | 2001-02-13 21:51:16 +0900 (Tue, 13 Feb 2001) | 6 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add -v (be verbose) and -n (no execute) options.

Show more infomational messages.

Touch only +REQUIRED_BY and +CONTENTS files when fixing the dependency.

------------------------------------------------------------------------
r25 | knu | 2001-02-13 21:48:42 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/install.rb
   A /trunk/lib/portinfo.rb
   A /trunk/lib/ports.rb
   A /trunk/lib/portsdb.rb
   A /trunk/portinfo.rb
   A /trunk/ports.rb
   A /trunk/portsdb.rb
   A /trunk/portsdb_bdb.rb
   A /trunk/portsdb_dbm.rb
   A /trunk/tests/test_portinfo.rb

Add modules that deal with the Ports Collection.

------------------------------------------------------------------------
r24 | knu | 2001-02-13 18:12:25 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/lib/pkginfo.rb
   M /trunk/pkgdb.rb
   M /trunk/pkginfo.rb
   M /trunk/pkgname.rb

Make some class variables constants.

------------------------------------------------------------------------
r23 | knu | 2001-02-13 04:58:10 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb
   M /trunk/pkgname.rb

Make it a point to use backquotes for %[qrx] notations.

------------------------------------------------------------------------
r22 | knu | 2001-02-13 04:47:17 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Define PkgDB::DB_DIR.

------------------------------------------------------------------------
r21 | knu | 2001-02-13 04:31:44 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

PkgDB#dbdir -> PkgDB#db_dir

------------------------------------------------------------------------
r20 | knu | 2001-02-13 04:30:18 +0900 (Tue, 13 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

dbdir -> db_dir

------------------------------------------------------------------------
r19 | knu | 2001-02-10 01:11:44 +0900 (Sat, 10 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Whoops.  Fix a bogon introduced in the previous commit.

------------------------------------------------------------------------
r18 | knu | 2001-02-09 12:42:04 +0900 (Fri, 09 Feb 2001) | 2 lines
Changed paths:
   A /trunk/COPYING
   A /trunk/README

Add COPYING and README.

------------------------------------------------------------------------
r17 | knu | 2001-02-09 12:41:41 +0900 (Fri, 09 Feb 2001) | 4 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Do not (re)generate "+REQUIRED_BY" if it's empty.

Submitted by:	Takanori Saneto <sanewo@ba2.so-net.ne.jp>

------------------------------------------------------------------------
r16 | knu | 2001-02-09 12:39:45 +0900 (Fri, 09 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Optimize a bit.

------------------------------------------------------------------------
r15 | knu | 2001-02-08 15:55:13 +0900 (Thu, 08 Feb 2001) | 2 lines
Changed paths:
   A /trunk/runtest.sh

Add the runtest.sh script which runs unit tests.

------------------------------------------------------------------------
r14 | knu | 2001-02-08 01:15:38 +0900 (Thu, 08 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Do not exit when a port fails to build or install.

------------------------------------------------------------------------
r13 | knu | 2001-02-06 07:21:30 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   A /trunk/install.rb

Add the installer script.

------------------------------------------------------------------------
r12 | knu | 2001-02-06 07:05:39 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Fix help.

------------------------------------------------------------------------
r11 | knu | 2001-02-06 05:13:56 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add a note about the pkgname glob to the help message.

------------------------------------------------------------------------
r10 | knu | 2001-02-06 04:37:38 +0900 (Tue, 06 Feb 2001) | 5 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Add a new flag -u/--uninstall, which makes it do uninstall before
doing install.

Do "make reinstall" rather than just "make install".

------------------------------------------------------------------------
r9 | knu | 2001-02-06 04:36:43 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Add an instance method required_by().

------------------------------------------------------------------------
r8 | knu | 2001-02-06 03:36:27 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Use File.*? instead of including FileTest to use *?.

------------------------------------------------------------------------
r7 | knu | 2001-02-06 03:33:29 +0900 (Tue, 06 Feb 2001) | 3 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Implement instance methods glob(), pkgdir(), pkgfiles(), and
pkg_*() that correspond to pkgfiles.

------------------------------------------------------------------------
r6 | knu | 2001-02-06 03:33:29 +0900 (Tue, 06 Feb 2001) | 9 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Clean up (remove) the old pkg's pkgdir when the upgrade is
successfully done. (Do nothing when the old pkg's pkgdir and
the new pkg's are the same)

Add a new flag -c/--cleanbuild, which makes it do clean build
for each port.

Make the help screen look better.

------------------------------------------------------------------------
r5 | knu | 2001-02-06 02:33:57 +0900 (Tue, 06 Feb 2001) | 8 lines
Changed paths:
   M /trunk/bin/portupgrade
   M /trunk/portupgrade

Allow to specify pkgnames using globs.

Add a new flag -d/--clean, which lets portupgrade clean after each
installation.

Make -i/--interactive act more interactively. (Confirm upon each
upgrade, etc.)

------------------------------------------------------------------------
r4 | knu | 2001-02-06 02:23:17 +0900 (Tue, 06 Feb 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkginfo.rb
   M /trunk/pkginfo.rb
   M /trunk/pkgname.rb

Obsolete the manual supply of an origin.

Add methods that correspond to pkg_info flags. (plist(), origin(),
etc.)

------------------------------------------------------------------------
r3 | knu | 2001-02-06 02:10:19 +0900 (Tue, 06 Feb 2001) | 5 lines
Changed paths:
   M /trunk/lib/pkgdb.rb
   M /trunk/pkgdb.rb

Define constants COMMENT, DESC, CONTENTS, and REQUIRED_BY.

Implement instance methods strip(), installed?(), required?(),
and glob().

------------------------------------------------------------------------
r2 | knu | 2001-02-06 01:07:15 +0900 (Tue, 06 Feb 2001) | 2 lines
Changed paths:
   A /trunk/bin
   A /trunk/bin/portupgrade
   A /trunk/lib
   A /trunk/lib/pkg.rb
   A /trunk/lib/pkgdb.rb
   A /trunk/lib/pkginfo.rb
   A /trunk/lib/pkgversion.rb
   A /trunk/pkg.rb
   A /trunk/pkgdb.rb
   A /trunk/pkginfo.rb
   A /trunk/pkgname.rb
   A /trunk/pkgversion.rb
   A /trunk/portupgrade
   A /trunk/tests
   A /trunk/tests/test_pkgdb.rb
   A /trunk/tests/test_pkginfo.rb
   A /trunk/tests/test_pkgname.rb
   A /trunk/tests/test_pkgversion.rb

Initial revision

------------------------------------------------------------------------
r1 | (no author) | 2001-02-06 01:07:15 +0900 (Tue, 06 Feb 2001) | 1 line
Changed paths:
   A /trunk

New repository initialized by cvs2svn.
------------------------------------------------------------------------
